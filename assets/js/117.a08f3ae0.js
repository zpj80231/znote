(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{595:function(t,s,a){"use strict";a.r(s);var n=a(4),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("Boxx"),t._v(" "),s("p"),s("div",{staticClass:"table-of-contents"},[s("ul",[s("li",[s("a",{attrs:{href:"#简介"}},[t._v("简介")])]),s("li",[s("a",{attrs:{href:"#搭建"}},[t._v("搭建")])]),s("li",[s("a",{attrs:{href:"#基础组件"}},[t._v("基础组件")]),s("ul",[s("li",[s("a",{attrs:{href:"#添加数据源"}},[t._v("添加数据源")])]),s("li",[s("a",{attrs:{href:"#权限配置"}},[t._v("权限配置")])]),s("li",[s("a",{attrs:{href:"#告警通知"}},[t._v("告警通知")])]),s("li",[s("a",{attrs:{href:"#告警管理"}},[t._v("告警管理")])])])]),s("li",[s("a",{attrs:{href:"#飞书告警通知配置"}},[t._v("飞书告警通知配置")]),s("ul",[s("li",[s("a",{attrs:{href:"#通知媒介"}},[t._v("通知媒介")])]),s("li",[s("a",{attrs:{href:"#消息模版"}},[t._v("消息模版")])]),s("li",[s("a",{attrs:{href:"#通知规则"}},[t._v("通知规则")])])])]),s("li",[s("a",{attrs:{href:"#告警规则配置"}},[t._v("告警规则配置")]),s("ul",[s("li",[s("a",{attrs:{href:"#基础配置"}},[t._v("基础配置")])]),s("li",[s("a",{attrs:{href:"#规则配置"}},[t._v("规则配置")])]),s("li",[s("a",{attrs:{href:"#生效配置"}},[t._v("生效配置")])]),s("li",[s("a",{attrs:{href:"#通知配置"}},[t._v("通知配置")])])])]),s("li",[s("a",{attrs:{href:"#prometheus-告警规则导入"}},[t._v("Prometheus 告警规则导入")])]),s("li",[s("a",{attrs:{href:"#配置测试"}},[t._v("配置测试")]),s("ul",[s("li",[s("a",{attrs:{href:"#触发告警"}},[t._v("触发告警")])]),s("li",[s("a",{attrs:{href:"#查看飞书通知"}},[t._v("查看飞书通知")])]),s("li",[s("a",{attrs:{href:"#事件详情"}},[t._v("事件详情")])]),s("li",[s("a",{attrs:{href:"#查看曲线"}},[t._v("查看曲线")])])])])])]),s("p"),t._v(" "),s("h2",{attrs:{id:"简介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[t._v("#")]),t._v(" 简介")]),t._v(" "),s("p",[s("strong",[t._v("环境：")]),t._v(" 在现有监控基础上，添加 Nightingale 告警集成 和 飞书告警")]),t._v(" "),s("p",[s("strong",[t._v("版本：")]),t._v(" 最新版。官网：https://n9e.github.io/。")]),t._v(" "),s("p",[t._v("夜莺监控（Nightingale）是一款侧重告警的监控类开源项目。类似 Grafana 的数据源集成方式，夜莺也是对接多种既有的数据源，不过 Grafana 侧重在可视化，夜莺是侧重在告警引擎、告警事件的处理和分发。")]),t._v(" "),s("blockquote",[s("p",[t._v("夜莺监控项目，最初由滴滴开发和开源，并于 2022 年 5 月 11 日，捐赠予中国计算机学会开源发展委员会（CCF ODC），为 CCF ODC 成立后接受捐赠的第一个开源项目。")])]),t._v(" "),s("p",[s("strong",[t._v("监控：")])]),t._v(" "),s("ul",[s("li",[t._v("监控，页面地址：http://124.70.95.70/grafana/d/sbapmwalker/springboot-apm-dashboard?orgId=1&from=now-30m&to=now")])]),t._v(" "),s("p",[s("strong",[t._v("告警：")])]),t._v(" "),s("ul",[s("li",[t._v("告警，Nightingale 控制台：http://120.46.29.140:17000/metric/explorer")])]),t._v(" "),s("p",[t._v("夜莺的侧重点是做告警引擎，即负责产生告警事件，并根据规则做灵活派发，内置支持 20 种通知媒介（电话、短信、邮件、钉钉、飞书、企微、Slack 等）。")]),t._v(" "),s("h2",{attrs:{id:"搭建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#搭建"}},[t._v("#")]),t._v(" 搭建")]),t._v(" "),s("div",{staticClass:"language-yaml line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-yaml"}},[s("code",[s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nightingale")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("driver")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" bridge\n\n"),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("services")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mysql")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mysql:8"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MYSQL_ROOT_PASSWORD")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1234")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./mysqldata"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/var/lib/mysql/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ../initsql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/docker"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("entrypoint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("initdb.d/\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./etc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("mysql/my.cnf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/my.cnf\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"3306:3306"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("redis")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"redis:6.2"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" redis\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"6379:6379"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# prometheus:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   image: prom/prometheus")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   container_name: prometheus")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   hostname: prometheus")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   restart: always")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   environment:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     TZ: Asia/Shanghai")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   volumes:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     - ./etc-prometheus:/etc/prometheus")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   command:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "--config.file=/etc/prometheus/prometheus.yml"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "--storage.tsdb.path=/prometheus"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "--web.console.libraries=/usr/share/prometheus/console_libraries"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "--web.console.templates=/usr/share/prometheus/consoles"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "--enable-feature=remote-write-receiver"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "--query.lookback-delta=2m"')]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   networks:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#     - nightingale")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#   ports:")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#     - "9090:9090"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("victoriametrics")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" victoriametrics/victoria"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("metrics"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("v1.79.12\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" victoriametrics\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" victoriametrics\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"8428:8428"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"--loggerTimezone=Asia/Shanghai"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nightingale")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" flashcatcloud/nightingale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("GIN_MODE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" release\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("WAIT_HOSTS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" mysql"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3306")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" redis"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6379")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./etc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("nightingale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/app/etc\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ports")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"17000:17000"')]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"20090:20090"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" mysql\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" redis\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" victoriametrics\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("command")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),s("span",{pre:!0,attrs:{class:"token scalar string"}},[t._v('\n      sh -c "/app/n9e"')]),t._v("\n\n  "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("categraf")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"flashcatcloud/categraf:latest"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("container_name")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"categraf"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hostname")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"categraf01"')]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("restart")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" always\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("TZ")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Asia/Shanghai\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HOST_PROC")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /hostfs/proc\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HOST_SYS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /hostfs/sys\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("HOST_MOUNT_PREFIX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /hostfs\n      "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("WAIT_HOSTS")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nightingale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17000")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" nightingale"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20090")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("volumes")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" ./etc"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("categraf"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/etc/categraf/conf\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" /"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("/hostfs\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("networks")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nightingale\n    "),s("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("depends_on")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" nightingale\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br"),s("span",{staticClass:"line-number"},[t._v("21")]),s("br"),s("span",{staticClass:"line-number"},[t._v("22")]),s("br"),s("span",{staticClass:"line-number"},[t._v("23")]),s("br"),s("span",{staticClass:"line-number"},[t._v("24")]),s("br"),s("span",{staticClass:"line-number"},[t._v("25")]),s("br"),s("span",{staticClass:"line-number"},[t._v("26")]),s("br"),s("span",{staticClass:"line-number"},[t._v("27")]),s("br"),s("span",{staticClass:"line-number"},[t._v("28")]),s("br"),s("span",{staticClass:"line-number"},[t._v("29")]),s("br"),s("span",{staticClass:"line-number"},[t._v("30")]),s("br"),s("span",{staticClass:"line-number"},[t._v("31")]),s("br"),s("span",{staticClass:"line-number"},[t._v("32")]),s("br"),s("span",{staticClass:"line-number"},[t._v("33")]),s("br"),s("span",{staticClass:"line-number"},[t._v("34")]),s("br"),s("span",{staticClass:"line-number"},[t._v("35")]),s("br"),s("span",{staticClass:"line-number"},[t._v("36")]),s("br"),s("span",{staticClass:"line-number"},[t._v("37")]),s("br"),s("span",{staticClass:"line-number"},[t._v("38")]),s("br"),s("span",{staticClass:"line-number"},[t._v("39")]),s("br"),s("span",{staticClass:"line-number"},[t._v("40")]),s("br"),s("span",{staticClass:"line-number"},[t._v("41")]),s("br"),s("span",{staticClass:"line-number"},[t._v("42")]),s("br"),s("span",{staticClass:"line-number"},[t._v("43")]),s("br"),s("span",{staticClass:"line-number"},[t._v("44")]),s("br"),s("span",{staticClass:"line-number"},[t._v("45")]),s("br"),s("span",{staticClass:"line-number"},[t._v("46")]),s("br"),s("span",{staticClass:"line-number"},[t._v("47")]),s("br"),s("span",{staticClass:"line-number"},[t._v("48")]),s("br"),s("span",{staticClass:"line-number"},[t._v("49")]),s("br"),s("span",{staticClass:"line-number"},[t._v("50")]),s("br"),s("span",{staticClass:"line-number"},[t._v("51")]),s("br"),s("span",{staticClass:"line-number"},[t._v("52")]),s("br"),s("span",{staticClass:"line-number"},[t._v("53")]),s("br"),s("span",{staticClass:"line-number"},[t._v("54")]),s("br"),s("span",{staticClass:"line-number"},[t._v("55")]),s("br"),s("span",{staticClass:"line-number"},[t._v("56")]),s("br"),s("span",{staticClass:"line-number"},[t._v("57")]),s("br"),s("span",{staticClass:"line-number"},[t._v("58")]),s("br"),s("span",{staticClass:"line-number"},[t._v("59")]),s("br"),s("span",{staticClass:"line-number"},[t._v("60")]),s("br"),s("span",{staticClass:"line-number"},[t._v("61")]),s("br"),s("span",{staticClass:"line-number"},[t._v("62")]),s("br"),s("span",{staticClass:"line-number"},[t._v("63")]),s("br"),s("span",{staticClass:"line-number"},[t._v("64")]),s("br"),s("span",{staticClass:"line-number"},[t._v("65")]),s("br"),s("span",{staticClass:"line-number"},[t._v("66")]),s("br"),s("span",{staticClass:"line-number"},[t._v("67")]),s("br"),s("span",{staticClass:"line-number"},[t._v("68")]),s("br"),s("span",{staticClass:"line-number"},[t._v("69")]),s("br"),s("span",{staticClass:"line-number"},[t._v("70")]),s("br"),s("span",{staticClass:"line-number"},[t._v("71")]),s("br"),s("span",{staticClass:"line-number"},[t._v("72")]),s("br"),s("span",{staticClass:"line-number"},[t._v("73")]),s("br"),s("span",{staticClass:"line-number"},[t._v("74")]),s("br"),s("span",{staticClass:"line-number"},[t._v("75")]),s("br"),s("span",{staticClass:"line-number"},[t._v("76")]),s("br"),s("span",{staticClass:"line-number"},[t._v("77")]),s("br"),s("span",{staticClass:"line-number"},[t._v("78")]),s("br"),s("span",{staticClass:"line-number"},[t._v("79")]),s("br"),s("span",{staticClass:"line-number"},[t._v("80")]),s("br"),s("span",{staticClass:"line-number"},[t._v("81")]),s("br"),s("span",{staticClass:"line-number"},[t._v("82")]),s("br"),s("span",{staticClass:"line-number"},[t._v("83")]),s("br"),s("span",{staticClass:"line-number"},[t._v("84")]),s("br"),s("span",{staticClass:"line-number"},[t._v("85")]),s("br"),s("span",{staticClass:"line-number"},[t._v("86")]),s("br"),s("span",{staticClass:"line-number"},[t._v("87")]),s("br"),s("span",{staticClass:"line-number"},[t._v("88")]),s("br"),s("span",{staticClass:"line-number"},[t._v("89")]),s("br"),s("span",{staticClass:"line-number"},[t._v("90")]),s("br"),s("span",{staticClass:"line-number"},[t._v("91")]),s("br"),s("span",{staticClass:"line-number"},[t._v("92")]),s("br"),s("span",{staticClass:"line-number"},[t._v("93")]),s("br"),s("span",{staticClass:"line-number"},[t._v("94")]),s("br"),s("span",{staticClass:"line-number"},[t._v("95")]),s("br"),s("span",{staticClass:"line-number"},[t._v("96")]),s("br"),s("span",{staticClass:"line-number"},[t._v("97")]),s("br"),s("span",{staticClass:"line-number"},[t._v("98")]),s("br"),s("span",{staticClass:"line-number"},[t._v("99")]),s("br"),s("span",{staticClass:"line-number"},[t._v("100")]),s("br"),s("span",{staticClass:"line-number"},[t._v("101")]),s("br"),s("span",{staticClass:"line-number"},[t._v("102")]),s("br"),s("span",{staticClass:"line-number"},[t._v("103")]),s("br"),s("span",{staticClass:"line-number"},[t._v("104")]),s("br"),s("span",{staticClass:"line-number"},[t._v("105")]),s("br"),s("span",{staticClass:"line-number"},[t._v("106")]),s("br"),s("span",{staticClass:"line-number"},[t._v("107")]),s("br"),s("span",{staticClass:"line-number"},[t._v("108")]),s("br"),s("span",{staticClass:"line-number"},[t._v("109")]),s("br"),s("span",{staticClass:"line-number"},[t._v("110")]),s("br")])]),s("p",[t._v("执行命令 `docker-compose up -d`，启动夜莺。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"基础组件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础组件"}},[t._v("#")]),t._v(" 基础组件")]),t._v(" "),s("p",[t._v("介绍一下夜莺的基础组件，介绍一下用夜莺告警的基本流程是怎么样的。")]),t._v(" "),s("h3",{attrs:{id:"添加数据源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加数据源"}},[t._v("#")]),t._v(" 添加数据源")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-1.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"权限配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#权限配置"}},[t._v("#")]),t._v(" 权限配置")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-2.png",alt:""}})]),t._v(" "),s("p",[t._v("基本规则是：")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("用户绑定权限")])]),t._v(" "),s("li",[s("p",[t._v("团队绑定用户")])]),t._v(" "),s("li",[s("p",[t._v("业务组绑定团队")])])]),t._v(" "),s("h3",{attrs:{id:"告警通知"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#告警通知"}},[t._v("#")]),t._v(" 告警通知")]),t._v(" "),s("p",[t._v("主要是各种消息通知的配置，如邮件告警、企微告警、钉钉告警、飞书告警等。")]),t._v(" "),s("p",[t._v("这里简单了解下。后续我们会详细配置一个飞书告警通知。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-3.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"告警管理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#告警管理"}},[t._v("#")]),t._v(" 告警管理")]),t._v(" "),s("p",[t._v("主要是配置告警规则，然后跟配置的告警渠道进行绑定。")]),t._v(" "),s("p",[t._v("详细的规则配置我们下面再介绍。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-4.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"飞书告警通知配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#飞书告警通知配置"}},[t._v("#")]),t._v(" 飞书告警通知配置")]),t._v(" "),s("p",[t._v("主要分为通知媒介、消息模板、通知规则 3 块。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("通知媒介：定义通知是飞书、企微还是钉钉等，做一些简单的通用配置")])]),t._v(" "),s("li",[s("p",[t._v("消息模版：方便添加不同样式或不同格式的告警内容模版")])]),t._v(" "),s("li",[s("p",[t._v("通知规则：绑定通知媒介和消息模版")])])]),t._v(" "),s("h3",{attrs:{id:"通知媒介"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通知媒介"}},[t._v("#")]),t._v(" 通知媒介")]),t._v(" "),s("p",[t._v("定义飞书的基本通知定义：主要就是定义固定的模板、占位符等。")]),t._v(" "),s("p",[t._v("如将 飞书token 作为变量配置，方便后续不同通知规则配置不同的token，进行多个飞书群的通知。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-5.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-6.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"消息模版"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#消息模版"}},[t._v("#")]),t._v(" 消息模版")]),t._v(" "),s("p",[t._v("方便添加不同样式或不同格式的告警内容模版。")]),t._v(" "),s("p",[t._v("如飞书支持 文本类消息 和 html类消息。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-7.png",alt:""}})]),t._v(" "),s("p",[t._v("这里我们新增一个专属于 cloud 的飞书卡片类消息模板：")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-8.png",alt:""}})]),t._v(" "),s("p",[t._v("模版内容：")]),t._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("S"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".Severity"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("if "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".IsRecovered"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("✅【告警恢复】"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("else"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("⚠️【触发告警】"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".IsRecovered -"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ne "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".Cate "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),t._v(" -"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("if "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".project "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("**平台信息:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".project "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n**服务信息:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".job "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".instance "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n**恢复时间:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("timeformat "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".LastEvalTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n**告警描述:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".RuleName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" 已恢复   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("- "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" ne "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".Cate "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"host"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("if "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".project "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("**平台信息:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".project "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".env "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n**服务信息:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".job "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(", "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$labels")]),t._v(".instance "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n**触发时间:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("timeformat "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".TriggerTime"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("    \n**触发时值:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".TriggerValue"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("if "),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".RuleName "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("**告警描述:** "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".RuleName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("end"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("- end -"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$domain")]),t._v(" :"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://120.46.29.140:17000"')]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("   \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("事件详情"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/alert-his-events/"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".Id"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("｜"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("查看曲线"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$domain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("/metric/explorer?data_source_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".DatasourceId"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("data_source_name")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("mode")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("graph"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),s("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("prom_ql")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$event")]),t._v(".PromQl"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v("escape"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br"),s("span",{staticClass:"line-number"},[t._v("12")]),s("br"),s("span",{staticClass:"line-number"},[t._v("13")]),s("br"),s("span",{staticClass:"line-number"},[t._v("14")]),s("br"),s("span",{staticClass:"line-number"},[t._v("15")]),s("br"),s("span",{staticClass:"line-number"},[t._v("16")]),s("br"),s("span",{staticClass:"line-number"},[t._v("17")]),s("br"),s("span",{staticClass:"line-number"},[t._v("18")]),s("br"),s("span",{staticClass:"line-number"},[t._v("19")]),s("br"),s("span",{staticClass:"line-number"},[t._v("20")]),s("br")])]),s("h3",{attrs:{id:"通知规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通知规则"}},[t._v("#")]),t._v(" 通知规则")]),t._v(" "),s("p",[t._v("主要用于绑定通知媒介和消息模板。")]),t._v(" "),s("p",[t._v("这样我们可以创建多个通知规则，方面后面配置告警规则的时候进行绑定，触发告警时可以有多种通知或不同的通知效果。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-9.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"告警规则配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#告警规则配置"}},[t._v("#")]),t._v(" 告警规则配置")]),t._v(" "),s("p",[t._v("这里我们新增一个 服务宕机 规则为例。")]),t._v(" "),s("p",[t._v("主要分为：基础配置、规则配置、生效配置、通知配置这几步。")]),t._v(" "),s("h3",{attrs:{id:"基础配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#基础配置"}},[t._v("#")]),t._v(" 基础配置")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-10.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"规则配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#规则配置"}},[t._v("#")]),t._v(" 规则配置")]),t._v(" "),s("p",[t._v("数据源选择 Prometheus，告警条件为 dky 模块，每 15 秒执行一次，如果持续时长超过 30 秒，那么就触发告警。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-11.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"生效配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生效配置"}},[t._v("#")]),t._v(" 生效配置")]),t._v(" "),s("p",[t._v("配置生效时间为：周一到周日，每天的 07:00 到 20:59。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-12.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"通知配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#通知配置"}},[t._v("#")]),t._v(" 通知配置")]),t._v(" "),s("p",[t._v("通知规则选择我们之前创建的飞书告警。")]),t._v(" "),s("p",[t._v("启用恢复通知：告警恢复时是否也发送通知")]),t._v(" "),s("p",[t._v("留观时长（秒）：60。持续 60 秒没有再次触发阈值才发送恢复通知")]),t._v(" "),s("p",[t._v("重复通知间隔（分钟）：60。如果告警持续未恢复，间隔 60 分钟之后重复提醒告警接收组的成员")]),t._v(" "),s("p",[t._v("最大发送次数：0。如果值为0，则不做最大发送次数的限制")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-13.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"prometheus-告警规则导入"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prometheus-告警规则导入"}},[t._v("#")]),t._v(" Prometheus 告警规则导入")]),t._v(" "),s("p",[t._v("当然除了自定义告警规则外，也可以从 Prometheus 导入。直接导入即可，这里不多做介绍。")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-14.png",alt:""}})]),t._v(" "),s("h2",{attrs:{id:"配置测试"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#配置测试"}},[t._v("#")]),t._v(" 配置测试")]),t._v(" "),s("h3",{attrs:{id:"触发告警"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#触发告警"}},[t._v("#")]),t._v(" 触发告警")]),t._v(" "),s("p",[t._v("重启 java 服务，查看是否会触发通知。（当然前提是 java 服务已被 Prometheus 监控）")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-15.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"查看飞书通知"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看飞书通知"}},[t._v("#")]),t._v(" 查看飞书通知")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-16.png",alt:""}})]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-17.png",alt:""}})]),t._v(" "),s("p",[t._v("可以看到，哪个平台、什么环境、哪个模块、什么时间。触发告警、告警恢复已经成功进行飞书通知。")]),t._v(" "),s("h3",{attrs:{id:"事件详情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#事件详情"}},[t._v("#")]),t._v(" 事件详情")]),t._v(" "),s("p",[t._v("点击 "),s("strong",[t._v("事件详情")]),t._v("，会直接跳转到浏览器，显示详细的告警信息：")]),t._v(" "),s("p",[t._v("http://120.46.29.140:17000/alert-his-events/2758")]),t._v(" "),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-18.png",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"查看曲线"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看曲线"}},[t._v("#")]),t._v(" 查看曲线")]),t._v(" "),s("p",[t._v("点击 "),s("strong",[t._v("查看曲线")]),t._v("，也会直接跳转到浏览器，显示历史告警曲线：")]),t._v(" "),s("div",{staticClass:"language-java line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-java"}},[s("code",[t._v("http"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("120.46")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".29")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v(".140")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("17000")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("metric"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("explorer"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("data\\_source\\_id"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("data\\_source\\_name"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("prometheus\\"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("mode"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("graph\\"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("prom\\_ql"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("up"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),t._v("Bjob"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\\"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22d")]),t._v("ky"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("%"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("A"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("22")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("7D")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("%")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("200")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"/znote/img/devops/nightingale/image-19.png",alt:""}})]),t._v(" "),s("Reward")],1)}),[],!1,null,null,null);s.default=e.exports}}]);