(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{597:function(s,a,t){"use strict";t.r(a);var n=t(4),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("Boxx"),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#简介"}},[s._v("简介")]),a("ul",[a("li",[a("a",{attrs:{href:"#对接服务列表"}},[s._v("对接服务列表")])]),a("li",[a("a",{attrs:{href:"#服务调用链路-主要"}},[s._v("服务调用链路（主要）")])])])]),a("li",[a("a",{attrs:{href:"#skywalking-搭建"}},[s._v("Skywalking 搭建")]),a("ul",[a("li",[a("a",{attrs:{href:"#部署文件"}},[s._v("部署文件")])])])]),a("li",[a("a",{attrs:{href:"#springboot-对接"}},[s._v("SpringBoot 对接")]),a("ul",[a("li",[a("a",{attrs:{href:"#skywalking-agent-准备"}},[s._v("Skywalking Agent 准备")])]),a("li",[a("a",{attrs:{href:"#skywalking-agent-配置文件更新"}},[s._v("Skywalking Agent 配置文件更新")])]),a("li",[a("a",{attrs:{href:"#java-配置文件更改"}},[s._v("Java 配置文件更改")])])])]),a("li",[a("a",{attrs:{href:"#遇到问题"}},[s._v("遇到问题")])]),a("li",[a("a",{attrs:{href:"#后续计划"}},[s._v("后续计划")])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("分布式系统的应用程序性能监控工具，特别为微服务、云原生和基于容器(Kubernetes)架构设计。")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("https://github.com/apache/skywalking")])]),s._v(" "),a("li",[a("p",[s._v("https://skywalking.apache.org")])])]),s._v(" "),a("p",[s._v("环境：dev，引入监控工具链，Skywalking（微服务调用链路）的构建和部署")]),s._v(" "),a("p",[s._v("版本：Skywalking 8.5.0、Skywalking 9.5.0")]),s._v(" "),a("p",[s._v("8.5 版本成品页面地址：http://120.46.29.140:8888/topology")]),s._v(" "),a("p",[s._v("9.5 版本成品页面地址：http://120.46.29.140:28080/general")]),s._v(" "),a("h3",{attrs:{id:"对接服务列表"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对接服务列表"}},[s._v("#")]),s._v(" 对接服务列表")]),s._v(" "),a("p",[a("img",{attrs:{src:"/znote/img/devops/skywalking/999E64CD-DD2C-4E22-8679-3606FE19C3DA.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"/znote/img/devops/skywalking/image-1.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"服务调用链路-主要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#服务调用链路-主要"}},[s._v("#")]),s._v(" 服务调用链路（主要）")]),s._v(" "),a("p",[a("img",{attrs:{src:"/znote/img/devops/skywalking/image-2.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"skywalking-搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#skywalking-搭建"}},[s._v("#")]),s._v(" Skywalking 搭建")]),s._v(" "),a("h3",{attrs:{id:"部署文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#部署文件"}},[s._v("#")]),s._v(" 部署文件")]),s._v(" "),a("p",[s._v("使用 docker 一键部署")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可参考 https://github.com/apache/skywalking/blob/master/docker/docker-compose.yml")]),s._v("\nversion: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3.8'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网桥 -> 方便相互通讯")]),s._v("\nnetworks:\n  skywalking:\n    ipam:\n      driver: "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v("\n      config:\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" subnet: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"192.168.100.0/24"')]),s._v("\n\nservices:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用性能分析 -- 不使用docker的话可下载 https://dlcdn.apache.org/skywalking/9.5.0/apache-skywalking-apm-9.5.0.tar.gz 进行测试")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 交互式运行容器测试能够正常启动 docker run --privileged --name oap -i -t  -p 12800:12800 -p 11800:11800 registry.cn-hangzhou.aliyuncs.com/zhengqing/skywalking-oap-server:9.5.0 /bin/bash")]),s._v("\n  oap:\n    image: apache"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("skywalking"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("oap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("server:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.5")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#registry.cn-hangzhou.aliyuncs.com/zhengqing/skywalking-oap-server:9.5.0 # 原镜像`apache/skywalking-oap-server:9.5.0`")]),s._v("\n    container_name: oap\n    restart: unless"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stopped\n    privileged: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取宿主机root权限")]),s._v("\n    environment:\n      TZ: Asia"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Shanghai\n      JAVA_OPTS: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xmx2048M -Xms2048M"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置见 https://github.com/apache/skywalking/blob/master/oap-server/server-starter/src/main/resources/application.yml")]),s._v("\n      SW_STORAGE: elasticsearch "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定es存储")]),s._v("\n      SW_STORAGE_ES_CLUSTER_NODES: elasticsearch:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9200")]),s._v("\n      SW_ES_USER: elastic\n      SW_ES_PASSWORD: elastic123456 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tips: 密码不能为纯数字，启动会出问题")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    volumes:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "./skywalking/mysql-connector-java-8.0.28.jar:/skywalking/ext-libs/mysql-connector-java-8.0.28.jar"')]),s._v("\n    ports:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"21800:11800"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# agent 上报数据的端口，这是 gRPC 端口")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"22800:12800"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ui 读取数据的端口， 这是 http 端口")]),s._v("\n    depends_on:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" elasticsearch\n    links:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" elasticsearch\n    networks:\n      skywalking:\n        ipv4_address: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".81")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可视化界面")]),s._v("\n  oap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ui:\n    image: apache"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("skywalking"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ui:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.5")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#registry.cn-hangzhou.aliyuncs.com/zhengqing/skywalking-ui:9.5.0 # 原镜像`apache/skywalking-ui:9.5.0`")]),s._v("\n    container_name: oap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ui\n    restart: unless"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stopped\n    privileged: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 获取宿主机root权限")]),s._v("\n    depends_on:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" oap\n    links:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" oap\n    ports:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"28080:8080"')]),s._v("\n    environment:\n      SW_OAP_ADDRESS: http:"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//192.168.100.81:12800")]),s._v("\n      TZ: Asia"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Shanghai\n    networks:\n      skywalking:\n        ipv4_address: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".82")]),s._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# es存储")]),s._v("\n  elasticsearch:\n    image: elasticsearch:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7.14")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#registry.cn-hangzhou.aliyuncs.com/zhengqing/elasticsearch:7.14.1      # 原镜像`elasticsearch:7.14.1`")]),s._v("\n    container_name: oap"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("es             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 容器名")]),s._v("\n    restart: unless"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stopped                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定容器退出后的重启策略为始终重启，但是不考虑在Docker守护进程启动时就已经停止了的容器")]),s._v("\n    volumes:                                  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据卷挂载路径设置,将本机目录映射到容器目录")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./elasticsearch/data:/usr/share/elasticsearch/data"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./elasticsearch/logs:/usr/share/elasticsearch/logs"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./elasticsearch/config/elasticsearch.yml:/usr/share/elasticsearch/config/elasticsearch.yml"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#      - "./elasticsearch/config/jvm.options:/usr/share/elasticsearch/config/jvm.options"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./elasticsearch/plugins/ik:/usr/share/elasticsearch/plugins/ik"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IK中文分词插件")]),s._v("\n    environment:                              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置环境变量,相当于docker run命令中的-e")]),s._v("\n      TZ: Asia"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("Shanghai\n      LANG: en_US"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("UTF"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("\n      TAKE_FILE_OWNERSHIP: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"true"')]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 权限")]),s._v("\n      discovery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("type")]),s._v(": single"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("node\n      ES_JAVA_OPTS: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-Xmx512m -Xms512m"')]),s._v("\n      ELASTIC_PASSWORD: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"elastic123456"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# elastic账号密码")]),s._v("\n    ports:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2200:9200"')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2300:9300"')]),s._v("\n    networks:\n      skywalking:\n        ipv4_address: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".100")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".83")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br")])]),a("h2",{attrs:{id:"springboot-对接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#springboot-对接"}},[s._v("#")]),s._v(" SpringBoot 对接")]),s._v(" "),a("h3",{attrs:{id:"skywalking-agent-准备"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#skywalking-agent-准备"}},[s._v("#")]),s._v(" Skywalking Agent 准备")]),s._v(" "),a("p",[s._v("https://skywalking.apache.org/downloads/")]),s._v(" "),a("h3",{attrs:{id:"skywalking-agent-配置文件更新"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#skywalking-agent-配置文件更新"}},[s._v("#")]),s._v(" Skywalking Agent 配置文件更新")]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 区分 namespace")]),s._v("\nagent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("namespace"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("${SW_AGENT_NAMESPACE:DEV}\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 上报地址")]),s._v("\ncollector"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("backend_service"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("${SW_AGENT_COLLECTOR_BACKEND_SERVICES:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".225")]),s._v(":"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21800")]),s._v("}\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("h3",{attrs:{id:"java-配置文件更改"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-配置文件更改"}},[s._v("#")]),s._v(" Java 配置文件更改")]),s._v(" "),a("p",[s._v("主要更新启动命令参数。")]),s._v(" "),a("p",[s._v("添加： "),a("code",[s._v("-javaagent:/home/dky/agent/skywalking-agent.jar -DSW\\_AGENT\\_NAME=cc-dev::dky-ws-adk-1")]),s._v("。")]),s._v(" "),a("p",[s._v("挂载代理插件目录："),a("code",[s._v("- /home/dky/agent:/home/dky/agent")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[s._v("  dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(":\n    build:\n      context: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n      dockerfile: Dockerfile\n    image: dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sdk:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),s._v("\n    container_name: dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    restart: always\n    environment:\n      JAVA_OPTS: "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Xmx512m \n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Dserver"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Dspring"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloud"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("nacos"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("discovery"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ip"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v(".10")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("javaagent:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("agent"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("skywalking"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("agent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("jar \n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("DSW_AGENT_NAME"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("cc"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dev::dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("adk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Drocketmq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("client"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("logLevel"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("\n    ports:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'8111:8111'")]),s._v("\n    volumes:\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("ws"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("sdk"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("logs\n      "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("agent:"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("dky"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("agent\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br")])]),a("h2",{attrs:{id:"遇到问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#遇到问题"}},[s._v("#")]),s._v(" 遇到问题")]),s._v(" "),a("p",[s._v(" 1. Skywalking 8.5 会有页面空白或持续很长时间没数据的问题。")]),s._v(" "),a("p",[s._v("解决方案：")]),s._v(" "),a("ul",[a("li",[s._v("那一套升级到了 9.5 版本")]),s._v(" "),a("li",[s._v("同时又发现可以在 Skywalking oap 中添加配置自动清理数据。（待观察）")])]),s._v(" "),a("div",{staticClass:"language-sql line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set a timeout on metrics data.  After the timeout has expired, the metrics data will automatically be deleted.")]),s._v("\nrecordDataTTL: ${SW_CORE_RECORD_DATA_TTL:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("} "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Unit is day")]),s._v("\nmetricsDataTTL: ${SW_CORE_METRICS_DATA_TTL:"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("} "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Unit is day")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("ol",{attrs:{start:"2"}},[a("li",[s._v("压测时，发现加入 skywalking-agent 导致 java 服务崩溃假死。具体分析及解决参考我单独开了一篇文章："),a("a",{attrs:{href:"https://zpj80231.github.io/znote/views/backend/SpringGateway%E5%AE%95%E6%9C%BA%E6%8E%92%E6%9F%A5.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("Spring Gateway 宕机排查实录：SkyWalking Agent 引发的内存泄漏深度分析"),a("OutboundLink")],1)])]),s._v(" "),a("h2",{attrs:{id:"后续计划"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#后续计划"}},[s._v("#")]),s._v(" 后续计划")]),s._v(" "),a("ol",[a("li",[s._v("观察 Skywalking 页面空白卡死的情况和数据自动清理的情况（没问题）。")])]),s._v(" "),a("Reward")],1)}),[],!1,null,null,null);a.default=e.exports}}]);