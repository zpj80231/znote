<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Zookeeper å…¨è§£ | zã®è‡ªç•™åœ°</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/znote/logo.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/znote/vuepress/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/znote/vuepress/favicon-32x32.png">
    <link rel="mask-icon" href="/znote/vuepress/safari-pinned-tab.svg">
    <link rel="manifest" href="/znote/manifest.json">
    <link rel="apple-touch-icon" sizes="57x57" href="/znote/vuepress/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/znote/vuepress/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/znote/vuepress/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/znote/vuepress/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/znote/vuepress/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/znote/vuepress/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/znote/vuepress/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/znote/vuepress/apple-touch-icon-180x180.png">
    <script>window.global = window; window.process = window.process || { env: { NODE_ENV: 'production' } };</script>
    <script language="javascript" type="text/javascript" src="/znote/js/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/znote/js/MouseClickEffect.js"></script>
    <script>
      (function() {
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker.getRegistrations && navigator.serviceWorker.getRegistrations().then(function(regs){
            regs.forEach(function(reg){ reg.unregister(); });
          });
        }
      })();
    </script>
    <meta name="description" content="å†…åœ¨ä¸°ç›ˆè€…ï¼Œç‹¬è¡Œäº¦å¦‚ä¼—">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="renderer" content="webkit">
    <meta name="referrer" content="never">
    <meta data-draft-node="block" data-draft-type="table" data-size="normal" data-row-style="normal">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/vuepress/msapplication-icon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/znote/assets/css/0.styles.40d5d060.css" as="style"><link rel="preload" href="/znote/assets/js/app.5f945c01.js" as="script"><link rel="preload" href="/znote/assets/js/4.2a25faf6.js" as="script"><link rel="preload" href="/znote/assets/js/2.946751cc.js" as="script"><link rel="preload" href="/znote/assets/js/1.ea6d4973.js" as="script"><link rel="preload" href="/znote/assets/js/99.d253ca45.js" as="script"><link rel="preload" href="/znote/assets/js/46.ea994d12.js" as="script"><link rel="prefetch" href="/znote/assets/js/10.e50e2e71.js"><link rel="prefetch" href="/znote/assets/js/100.6e840575.js"><link rel="prefetch" href="/znote/assets/js/101.bc2b9cc5.js"><link rel="prefetch" href="/znote/assets/js/102.d662a837.js"><link rel="prefetch" href="/znote/assets/js/103.e3d7a8a0.js"><link rel="prefetch" href="/znote/assets/js/104.1e7aaea5.js"><link rel="prefetch" href="/znote/assets/js/105.bb0ad827.js"><link rel="prefetch" href="/znote/assets/js/106.8742496b.js"><link rel="prefetch" href="/znote/assets/js/107.ae850f47.js"><link rel="prefetch" href="/znote/assets/js/108.9cb09edf.js"><link rel="prefetch" href="/znote/assets/js/109.5eb95a6d.js"><link rel="prefetch" href="/znote/assets/js/11.32f6c80d.js"><link rel="prefetch" href="/znote/assets/js/110.595ac908.js"><link rel="prefetch" href="/znote/assets/js/111.39d80f77.js"><link rel="prefetch" href="/znote/assets/js/112.72780b85.js"><link rel="prefetch" href="/znote/assets/js/113.17db8c53.js"><link rel="prefetch" href="/znote/assets/js/114.22d73731.js"><link rel="prefetch" href="/znote/assets/js/115.d8b86749.js"><link rel="prefetch" href="/znote/assets/js/116.75fee8f6.js"><link rel="prefetch" href="/znote/assets/js/117.a08f3ae0.js"><link rel="prefetch" href="/znote/assets/js/118.530a9bcc.js"><link rel="prefetch" href="/znote/assets/js/119.829e3547.js"><link rel="prefetch" href="/znote/assets/js/120.b8fccdc1.js"><link rel="prefetch" href="/znote/assets/js/121.71cd1896.js"><link rel="prefetch" href="/znote/assets/js/122.d31b677b.js"><link rel="prefetch" href="/znote/assets/js/123.af9b7ccb.js"><link rel="prefetch" href="/znote/assets/js/124.02824a46.js"><link rel="prefetch" href="/znote/assets/js/125.a6854e6d.js"><link rel="prefetch" href="/znote/assets/js/126.b1f2864c.js"><link rel="prefetch" href="/znote/assets/js/127.6a1bcf75.js"><link rel="prefetch" href="/znote/assets/js/128.91784faf.js"><link rel="prefetch" href="/znote/assets/js/129.ec1b9ffe.js"><link rel="prefetch" href="/znote/assets/js/130.1daf1a42.js"><link rel="prefetch" href="/znote/assets/js/131.36d5631a.js"><link rel="prefetch" href="/znote/assets/js/132.2cba18b9.js"><link rel="prefetch" href="/znote/assets/js/133.ee841c9b.js"><link rel="prefetch" href="/znote/assets/js/134.a267f964.js"><link rel="prefetch" href="/znote/assets/js/135.3c532e0e.js"><link rel="prefetch" href="/znote/assets/js/136.ed794db8.js"><link rel="prefetch" href="/znote/assets/js/137.f0fde2ec.js"><link rel="prefetch" href="/znote/assets/js/138.37931fef.js"><link rel="prefetch" href="/znote/assets/js/139.d1346e28.js"><link rel="prefetch" href="/znote/assets/js/14.2abccdd4.js"><link rel="prefetch" href="/znote/assets/js/140.bf815a60.js"><link rel="prefetch" href="/znote/assets/js/141.0085f100.js"><link rel="prefetch" href="/znote/assets/js/142.5c1da864.js"><link rel="prefetch" href="/znote/assets/js/143.97ee3762.js"><link rel="prefetch" href="/znote/assets/js/144.04898225.js"><link rel="prefetch" href="/znote/assets/js/145.c5d43153.js"><link rel="prefetch" href="/znote/assets/js/146.f9deb6e3.js"><link rel="prefetch" href="/znote/assets/js/147.78a19543.js"><link rel="prefetch" href="/znote/assets/js/148.18100e22.js"><link rel="prefetch" href="/znote/assets/js/149.5f9a13a1.js"><link rel="prefetch" href="/znote/assets/js/15.bfbdd56b.js"><link rel="prefetch" href="/znote/assets/js/150.83aae713.js"><link rel="prefetch" href="/znote/assets/js/151.2b0c6692.js"><link rel="prefetch" href="/znote/assets/js/152.9eee3176.js"><link rel="prefetch" href="/znote/assets/js/153.40f95001.js"><link rel="prefetch" href="/znote/assets/js/154.04add31f.js"><link rel="prefetch" href="/znote/assets/js/155.11520aac.js"><link rel="prefetch" href="/znote/assets/js/156.2dbcb240.js"><link rel="prefetch" href="/znote/assets/js/157.d0741902.js"><link rel="prefetch" href="/znote/assets/js/158.a73f93e4.js"><link rel="prefetch" href="/znote/assets/js/159.5186c671.js"><link rel="prefetch" href="/znote/assets/js/16.533b2a69.js"><link rel="prefetch" href="/znote/assets/js/160.64cc05bf.js"><link rel="prefetch" href="/znote/assets/js/161.dcb8383e.js"><link rel="prefetch" href="/znote/assets/js/162.961a39d4.js"><link rel="prefetch" href="/znote/assets/js/163.6fc8d6c7.js"><link rel="prefetch" href="/znote/assets/js/164.2b27ebf7.js"><link rel="prefetch" href="/znote/assets/js/165.fd9d1241.js"><link rel="prefetch" href="/znote/assets/js/166.57b8a7a1.js"><link rel="prefetch" href="/znote/assets/js/167.bbe0f828.js"><link rel="prefetch" href="/znote/assets/js/168.85860106.js"><link rel="prefetch" href="/znote/assets/js/169.315c8e8a.js"><link rel="prefetch" href="/znote/assets/js/17.3f56e9a5.js"><link rel="prefetch" href="/znote/assets/js/170.9fdc64f9.js"><link rel="prefetch" href="/znote/assets/js/171.d12fab92.js"><link rel="prefetch" href="/znote/assets/js/172.ee2e7937.js"><link rel="prefetch" href="/znote/assets/js/173.02753b70.js"><link rel="prefetch" href="/znote/assets/js/174.6c9426aa.js"><link rel="prefetch" href="/znote/assets/js/175.79705611.js"><link rel="prefetch" href="/znote/assets/js/176.64c17b32.js"><link rel="prefetch" href="/znote/assets/js/177.e815462f.js"><link rel="prefetch" href="/znote/assets/js/178.9a0d595a.js"><link rel="prefetch" href="/znote/assets/js/179.cb7e977e.js"><link rel="prefetch" href="/znote/assets/js/18.7565d38d.js"><link rel="prefetch" href="/znote/assets/js/180.99be93e0.js"><link rel="prefetch" href="/znote/assets/js/181.67e6a40d.js"><link rel="prefetch" href="/znote/assets/js/182.9ebf70d7.js"><link rel="prefetch" href="/znote/assets/js/183.dfe57e9b.js"><link rel="prefetch" href="/znote/assets/js/184.32205bac.js"><link rel="prefetch" href="/znote/assets/js/185.2baec8b6.js"><link rel="prefetch" href="/znote/assets/js/186.40927099.js"><link rel="prefetch" href="/znote/assets/js/187.16eaf9f3.js"><link rel="prefetch" href="/znote/assets/js/188.f2cc1961.js"><link rel="prefetch" href="/znote/assets/js/189.ae5cdfed.js"><link rel="prefetch" href="/znote/assets/js/19.c9de4536.js"><link rel="prefetch" href="/znote/assets/js/190.658e3a32.js"><link rel="prefetch" href="/znote/assets/js/191.175dc5bc.js"><link rel="prefetch" href="/znote/assets/js/192.e5479ced.js"><link rel="prefetch" href="/znote/assets/js/20.1e56caad.js"><link rel="prefetch" href="/znote/assets/js/21.2c5582bc.js"><link rel="prefetch" href="/znote/assets/js/22.f5d978d9.js"><link rel="prefetch" href="/znote/assets/js/23.b95efe43.js"><link rel="prefetch" href="/znote/assets/js/24.2d805bb8.js"><link rel="prefetch" href="/znote/assets/js/25.76576c96.js"><link rel="prefetch" href="/znote/assets/js/26.9a248997.js"><link rel="prefetch" href="/znote/assets/js/27.8c157f27.js"><link rel="prefetch" href="/znote/assets/js/28.3579c75a.js"><link rel="prefetch" href="/znote/assets/js/29.47f5b4be.js"><link rel="prefetch" href="/znote/assets/js/3.3a317c13.js"><link rel="prefetch" href="/znote/assets/js/30.4924ae86.js"><link rel="prefetch" href="/znote/assets/js/31.275a6ae2.js"><link rel="prefetch" href="/znote/assets/js/32.5a2e791a.js"><link rel="prefetch" href="/znote/assets/js/33.4a30a66d.js"><link rel="prefetch" href="/znote/assets/js/34.6ce84921.js"><link rel="prefetch" href="/znote/assets/js/35.e23f015c.js"><link rel="prefetch" href="/znote/assets/js/36.5aeda321.js"><link rel="prefetch" href="/znote/assets/js/37.6af846bb.js"><link rel="prefetch" href="/znote/assets/js/38.e33b89eb.js"><link rel="prefetch" href="/znote/assets/js/39.14d95cfc.js"><link rel="prefetch" href="/znote/assets/js/40.a34d57fc.js"><link rel="prefetch" href="/znote/assets/js/41.208cfdec.js"><link rel="prefetch" href="/znote/assets/js/42.3c76df1f.js"><link rel="prefetch" href="/znote/assets/js/43.eb69bf45.js"><link rel="prefetch" href="/znote/assets/js/44.5e428fdf.js"><link rel="prefetch" href="/znote/assets/js/45.68697cb6.js"><link rel="prefetch" href="/znote/assets/js/47.4e13e2e6.js"><link rel="prefetch" href="/znote/assets/js/48.f29e4fb1.js"><link rel="prefetch" href="/znote/assets/js/49.2fa32621.js"><link rel="prefetch" href="/znote/assets/js/5.fc3945a7.js"><link rel="prefetch" href="/znote/assets/js/50.f7658bf9.js"><link rel="prefetch" href="/znote/assets/js/51.2636a4c6.js"><link rel="prefetch" href="/znote/assets/js/52.9c3172b1.js"><link rel="prefetch" href="/znote/assets/js/53.145f0a1c.js"><link rel="prefetch" href="/znote/assets/js/54.69ada61f.js"><link rel="prefetch" href="/znote/assets/js/55.2e99f54e.js"><link rel="prefetch" href="/znote/assets/js/56.80581303.js"><link rel="prefetch" href="/znote/assets/js/57.cda1ace6.js"><link rel="prefetch" href="/znote/assets/js/58.b523f018.js"><link rel="prefetch" href="/znote/assets/js/59.f3bbc4ed.js"><link rel="prefetch" href="/znote/assets/js/6.6b85ac06.js"><link rel="prefetch" href="/znote/assets/js/60.5763ae12.js"><link rel="prefetch" href="/znote/assets/js/61.fa5d901a.js"><link rel="prefetch" href="/znote/assets/js/62.2ad46619.js"><link rel="prefetch" href="/znote/assets/js/63.0d286227.js"><link rel="prefetch" href="/znote/assets/js/64.c56370de.js"><link rel="prefetch" href="/znote/assets/js/65.6b225637.js"><link rel="prefetch" href="/znote/assets/js/66.3ec04f6a.js"><link rel="prefetch" href="/znote/assets/js/67.b9d2af4d.js"><link rel="prefetch" href="/znote/assets/js/68.039f0687.js"><link rel="prefetch" href="/znote/assets/js/69.81fdb76e.js"><link rel="prefetch" href="/znote/assets/js/7.e707684e.js"><link rel="prefetch" href="/znote/assets/js/70.49979b06.js"><link rel="prefetch" href="/znote/assets/js/71.97ca2a22.js"><link rel="prefetch" href="/znote/assets/js/72.e8ea93b8.js"><link rel="prefetch" href="/znote/assets/js/73.02cb5187.js"><link rel="prefetch" href="/znote/assets/js/74.0afe8eed.js"><link rel="prefetch" href="/znote/assets/js/75.95870cfc.js"><link rel="prefetch" href="/znote/assets/js/76.67d4ee6e.js"><link rel="prefetch" href="/znote/assets/js/77.ad1c485d.js"><link rel="prefetch" href="/znote/assets/js/78.401333fd.js"><link rel="prefetch" href="/znote/assets/js/79.84bc90b2.js"><link rel="prefetch" href="/znote/assets/js/8.571bc765.js"><link rel="prefetch" href="/znote/assets/js/80.29d1e80c.js"><link rel="prefetch" href="/znote/assets/js/81.62ab1e5d.js"><link rel="prefetch" href="/znote/assets/js/82.5077d499.js"><link rel="prefetch" href="/znote/assets/js/83.71263512.js"><link rel="prefetch" href="/znote/assets/js/84.d17f50d7.js"><link rel="prefetch" href="/znote/assets/js/85.d6ba3ad7.js"><link rel="prefetch" href="/znote/assets/js/86.779f8ab7.js"><link rel="prefetch" href="/znote/assets/js/87.68c776ef.js"><link rel="prefetch" href="/znote/assets/js/88.d36be080.js"><link rel="prefetch" href="/znote/assets/js/89.4a276602.js"><link rel="prefetch" href="/znote/assets/js/9.d9428a19.js"><link rel="prefetch" href="/znote/assets/js/90.1a9fffe3.js"><link rel="prefetch" href="/znote/assets/js/91.7e5abe61.js"><link rel="prefetch" href="/znote/assets/js/92.7ea99b6a.js"><link rel="prefetch" href="/znote/assets/js/93.e11cb438.js"><link rel="prefetch" href="/znote/assets/js/94.a13dff65.js"><link rel="prefetch" href="/znote/assets/js/95.96501a16.js"><link rel="prefetch" href="/znote/assets/js/96.702c2a5c.js"><link rel="prefetch" href="/znote/assets/js/97.e4f284aa.js"><link rel="prefetch" href="/znote/assets/js/98.08bc3c19.js"><link rel="prefetch" href="/znote/assets/js/vendors~docsearch.f66e9565.js">
    <link rel="stylesheet" href="/znote/assets/css/0.styles.40d5d060.css">
  <!-- Build Date: 2026-02-10 10:12:30 -->
</head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="theme-container" data-v-4c312ed8><div data-v-4c312ed8><div id="loader-wrapper" class="loading-wrapper" data-v-3f8587b4 data-v-4c312ed8 data-v-4c312ed8><h3 class="title" data-v-3f8587b4>zã®è‡ªç•™åœ°</h3> <p class="description" data-v-3f8587b4>å†…åœ¨ä¸°ç›ˆè€…ï¼Œç‹¬è¡Œäº¦å¦‚ä¼—</p> <div class="loading" data-v-3f8587b4><span style="animation-duration:2s;animation-delay:0s;" data-v-3f8587b4>
      L
    </span><span style="animation-duration:2s;animation-delay:0.2s;" data-v-3f8587b4>
      o
    </span><span style="animation-duration:2s;animation-delay:0.4s;" data-v-3f8587b4>
      a
    </span><span style="animation-duration:2s;animation-delay:0.6000000000000001s;" data-v-3f8587b4>
      d
    </span><span style="animation-duration:2s;animation-delay:0.8s;" data-v-3f8587b4>
      i
    </span><span style="animation-duration:2s;animation-delay:1s;" data-v-3f8587b4>
      n
    </span><span style="animation-duration:2s;animation-delay:1.2000000000000002s;" data-v-3f8587b4>
      g
    </span><span style="animation-duration:2s;animation-delay:1.4000000000000001s;" data-v-3f8587b4>
      .
    </span><span style="animation-duration:2s;animation-delay:1.6s;" data-v-3f8587b4>
      .
    </span><span style="animation-duration:2s;animation-delay:1.8s;" data-v-3f8587b4>
      .
    </span></div></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-73c95a87 data-v-4c312ed8 data-v-4c312ed8><h3 class="title" style="display:none;" data-v-73c95a87 data-v-73c95a87>zã®è‡ªç•™åœ°</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-73c95a87 data-v-73c95a87><input type="password" value="" data-v-73c95a87> <span data-v-73c95a87>Konck! Knock!</span> <button data-v-73c95a87>OK</button></label> <div class="footer" style="display:none;" data-v-73c95a87 data-v-73c95a87><span data-v-73c95a87><i class="iconfont reco-theme" data-v-73c95a87></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-73c95a87>vuePress-theme-reco</a></span> <span data-v-73c95a87><i class="iconfont reco-copyright" data-v-73c95a87></i> <a data-v-73c95a87><span data-v-73c95a87>z</span>
          Â Â 
          <span data-v-73c95a87>2019 - </span>
          2026
        </a></span></div></div> <div class="hide" data-v-4c312ed8><header class="navbar" data-v-4c312ed8><div title="å¯¼èˆª" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/znote/" class="home-link router-link-active"><!----> <span class="site-name">zã®è‡ªç•™åœ°</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/znote/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/znote/categories/åç«¯ Back-end/" class="nav-link"><i class="iconfont undefined"></i>
  åç«¯ Back-end
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/çŸ¥è¯†æ™¶ä½“ Q&amp;A/" class="nav-link"><i class="iconfont undefined"></i>
  çŸ¥è¯†æ™¶ä½“ Q&amp;A
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/èƒ½åŠ›æ‰©å±• DevOps/" class="nav-link"><i class="iconfont undefined"></i>
  èƒ½åŠ›æ‰©å±• DevOps
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/éšç¬” Essay/" class="nav-link"><i class="iconfont undefined"></i>
  éšç¬” Essay
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/å‰ç«¯ Front-end/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯ Front-end
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/è§„èŒƒ Standard/" class="nav-link"><i class="iconfont undefined"></i>
  è§„èŒƒ Standard
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/å‘½ç†å­¦ Numerology/" class="nav-link"><i class="iconfont undefined"></i>
  å‘½ç†å­¦ Numerology
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/æºç  Source-code/" class="nav-link"><i class="iconfont undefined"></i>
  æºç  Source-code
</a></li></ul></div></div><div class="nav-item"><a href="/znote/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      å…¶å®ƒ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ProjectsğŸˆ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/znote/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  âœ” My Project âœ¨
</a></li><li class="dropdown-subitem"><a href="/znote/other/friends.html" class="nav-link"><i class="iconfont undefined"></i>
  âœ” å‹ æƒ… é“¾ æ¥ ğŸƒ
</a></li></ul></li><li class="dropdown-item"><h4>Common sitesğŸˆ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Java SE API Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.programcreek.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Program Creek
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Spring
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Stackoverflow
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  BootCDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.linuxcool.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Linuxå‘½ä»¤å¤§å…¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/znote/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´çº¿
</a></div><div class="nav-item"><a href="/znote/about/" class="nav-link"><i class="iconfont reco-message"></i>
  å…³äºæˆ‘
</a></div> <a href="https://github.com/zpj80231/znote" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask" data-v-4c312ed8></div> <aside class="sidebar" data-v-4c312ed8><div class="personal-info-wrapper" data-v-7e653f02><img src="/znote/vuepress/head-fish.jpg" alt="author-avatar" class="personal-img" data-v-7e653f02> <h3 class="name" data-v-7e653f02>
    z
  </h3> <div class="num" data-v-7e653f02><div data-v-7e653f02><h3 data-v-7e653f02>133</h3> <h6 data-v-7e653f02>æ–‡ç« </h6></div> <div data-v-7e653f02><h3 data-v-7e653f02>43</h3> <h6 data-v-7e653f02>æ ‡ç­¾</h6></div></div> <hr data-v-7e653f02></div> <nav class="nav-links"><div class="nav-item"><a href="/znote/index.html" class="nav-link"><i class="iconfont reco-home"></i>
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      åˆ†ç±»
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/znote/categories/åç«¯ Back-end/" class="nav-link"><i class="iconfont undefined"></i>
  åç«¯ Back-end
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/çŸ¥è¯†æ™¶ä½“ Q&amp;A/" class="nav-link"><i class="iconfont undefined"></i>
  çŸ¥è¯†æ™¶ä½“ Q&amp;A
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/èƒ½åŠ›æ‰©å±• DevOps/" class="nav-link"><i class="iconfont undefined"></i>
  èƒ½åŠ›æ‰©å±• DevOps
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/éšç¬” Essay/" class="nav-link"><i class="iconfont undefined"></i>
  éšç¬” Essay
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/å‰ç«¯ Front-end/" class="nav-link"><i class="iconfont undefined"></i>
  å‰ç«¯ Front-end
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/è§„èŒƒ Standard/" class="nav-link"><i class="iconfont undefined"></i>
  è§„èŒƒ Standard
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/å‘½ç†å­¦ Numerology/" class="nav-link"><i class="iconfont undefined"></i>
  å‘½ç†å­¦ Numerology
</a></li><li class="dropdown-item"><!----> <a href="/znote/categories/æºç  Source-code/" class="nav-link"><i class="iconfont undefined"></i>
  æºç  Source-code
</a></li></ul></div></div><div class="nav-item"><a href="/znote/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  æ ‡ç­¾
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      å…¶å®ƒ
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>ProjectsğŸˆ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/znote/other/project.html" class="nav-link"><i class="iconfont undefined"></i>
  âœ” My Project âœ¨
</a></li><li class="dropdown-subitem"><a href="/znote/other/friends.html" class="nav-link"><i class="iconfont undefined"></i>
  âœ” å‹ æƒ… é“¾ æ¥ ğŸƒ
</a></li></ul></li><li class="dropdown-item"><h4>Common sitesğŸˆ</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="https://docs.oracle.com/javase/8/docs/api/index.html" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Java SE API Documentation
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.programcreek.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Program Creek
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://spring.io/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Spring
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://stackoverflow.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Stackoverflow
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://leetcode-cn.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  LeetCode
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://cn.vuejs.org/v2/guide/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Vue.js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.bootcdn.cn/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  BootCDN
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.linuxcool.com/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  Linuxå‘½ä»¤å¤§å…¨
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-subitem"><a href="https://www.tiobe.com/tiobe-index/" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont undefined"></i>
  ç¼–ç¨‹è¯­è¨€æ’è¡Œæ¦œ
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></div></div><div class="nav-item"><a href="/znote/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  æ—¶é—´çº¿
</a></div><div class="nav-item"><a href="/znote/about/" class="nav-link"><i class="iconfont reco-message"></i>
  å…³äºæˆ‘
</a></div> <a href="https://github.com/zpj80231/znote" target="_blank" rel="noopener noreferrer" class="repo-link"><i class="iconfont reco-github"></i>
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/znote/views/" aria-current="page" class="sidebar-link">æ¦‚è§ˆ</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸ• çŸ¥è¯†æ™¶ä½“ Q&amp;A</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸ¦„ è§„èŒƒ Standard</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸ¹ å‰ç«¯ Front-end</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>ğŸ”¨ åç«¯ Back-end</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/znote/views/backend/SpringGatewayå®•æœºæ’æŸ¥.html" class="sidebar-link">Spring Gateway å®•æœºæ’æŸ¥å®å½•ï¼šSkyWalking Agent å¼•å‘çš„å†…å­˜æ³„æ¼æ·±åº¦åˆ†æ</a></li><li><a href="/znote/views/backend/APIç½‘å…³æ¦‚è¿°.html" class="sidebar-link">API ç½‘å…³æ¦‚è¿°</a></li><li><a href="/znote/views/backend/SPI_JdkDubboSpring.html" class="sidebar-link">JDK/Dubbo/Spring ä¸‰ç§SPIæœºåˆ¶è§£æ</a></li><li><a href="/znote/views/backend/docker.html" class="sidebar-link">Docker åŸºæœ¬äº†è§£å’Œä½¿ç”¨</a></li><li><a href="/znote/views/backend/itext.html" class="sidebar-link">iTextï¼šPDFå¯¼å‡º</a></li><li><a href="/znote/views/backend/poi.html" class="sidebar-link">POI å¤šçº¿ç¨‹å¤šSheetå¯¼å‡ºExcel,Csv</a></li><li><a href="/znote/views/backend/quartz.html" class="sidebar-link">Quartz å®šæ—¶ä»»åŠ¡</a></li><li><a href="/znote/views/backend/dubbo.html" class="sidebar-link">Dubbo è¿ç¯é—®</a></li><li><a href="/znote/views/backend/å•å…ƒæµ‹è¯•1.html" class="sidebar-link">å•å…ƒæµ‹è¯•ï¼šå¦‚ä½•åœ¨jUnit4ä¸­åº”ç”¨ä¸¤ä¸ª@RunWithï¼Ÿ</a></li><li><a href="/znote/views/backend/å•å…ƒæµ‹è¯•2.html" class="sidebar-link">å•å…ƒæµ‹è¯•ï¼šJUnit4å’ŒJUnit5çš„ä¸»è¦åŒºåˆ«</a></li><li><a href="/znote/views/backend/å•å…ƒæµ‹è¯•3.html" class="sidebar-link">å•å…ƒæµ‹è¯•ï¼šSpringBoot Test</a></li><li><a href="/znote/views/backend/rabbitmq001.html" class="sidebar-link">RabbitMQ - åŸºç¡€</a></li><li><a href="/znote/views/backend/rabbitmq002.html" class="sidebar-link">RabbitMQ - è¿›é˜¶</a></li><li><a href="/znote/views/backend/redis01.html" class="sidebar-link">Redis - åŸºç¡€</a></li><li><a href="/znote/views/backend/redis02.html" class="sidebar-link">Redis - ç»ˆç»“</a></li><li><a href="/znote/views/backend/redisä½¿ç”¨åœºæ™¯.html" class="sidebar-link">Redis - å¸¸è§åº”ç”¨åœºæ™¯</a></li><li><a href="/znote/views/backend/SSH.html" class="sidebar-link">SSH æ¶æ„çŸ¥è¯†ç‚¹æ¦‚è§ˆ</a></li><li><a href="/znote/views/backend/jwt.html" class="sidebar-link">JWT ç™»é™†è®¤è¯</a></li><li><a href="/znote/views/backend/swagger2.html" class="sidebar-link">Swagger2 åŸºæœ¬äº†è§£å’Œä½¿ç”¨</a></li><li><a href="/znote/views/backend/thread.html" class="sidebar-link">å¤šçº¿ç¨‹å’Œçº¿ç¨‹æ± åŸºç¡€</a></li><li><a href="/znote/views/backend/ThreadLocal.html" class="sidebar-link">çº¿ç¨‹æ±  - ç®€ä»‹</a></li><li><a href="/znote/views/backend/ThreadPool.html" class="sidebar-link">çº¿ç¨‹æ±  - è¿›é˜¶</a></li><li><a href="/znote/views/backend/ThreadPool2.html" class="sidebar-link">çº¿ç¨‹æ±  - åŠ¨æ€è°ƒèŠ‚å‚æ•°</a></li><li><a href="/znote/views/backend/annotationLog.html" class="sidebar-link">æ³¨è§£+AOPå®ç°æ—¥å¿—è®°å½•</a></li><li><a href="/znote/views/backend/jvm.html" class="sidebar-link">JVM å’Œ GC</a></li><li><a href="/znote/views/backend/juc.html" class="sidebar-link">JUC å°ç»“</a></li><li><a href="/znote/views/backend/javaLock.html" class="sidebar-link">Java ä¸­çš„å„ç§é”</a></li><li><a href="/znote/views/backend/mysql_explain.html" class="sidebar-link">MySQL æ…¢æŸ¥è¯¢ä¼˜åŒ–</a></li><li><a href="/znote/views/backend/mybatisä¸€äºŒçº§ç¼“å­˜.html" class="sidebar-link">MyBatis ä¸­çš„ä¸€ã€äºŒçº§ç¼“å­˜</a></li><li><a href="/znote/views/backend/ReentrantLock.html" class="sidebar-link">ReentrantLock è¯¦è§£</a></li><li><a href="/znote/views/backend/CountDownLatch.html" class="sidebar-link">CountDownLatch è¯¦è§£</a></li><li><a href="/znote/views/backend/zookeeper.html" aria-current="page" class="active sidebar-link">Zookeeper å…¨è§£</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#ç®€ä»‹-å¿«é€Ÿå…¥é—¨" class="sidebar-link">ç®€ä»‹/å¿«é€Ÿå…¥é—¨</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åº”ç”¨åœºæ™¯" class="sidebar-link">åº”ç”¨åœºæ™¯</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#zookeeperçš„è®¾è®¡ç›®æ ‡" class="sidebar-link">Zookeeperçš„è®¾è®¡ç›®æ ‡</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#æ•°æ®æ¨¡å‹" class="sidebar-link">æ•°æ®æ¨¡å‹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#ç»“ç‚¹çŠ¶æ€statçš„å±æ€§" class="sidebar-link">ç»“ç‚¹çŠ¶æ€statçš„å±æ€§</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#å•æœºå®‰è£…" class="sidebar-link">å•æœºå®‰è£…</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#å¸¸ç”¨shellå‘½ä»¤" class="sidebar-link">å¸¸ç”¨shellå‘½ä»¤</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#zookeeperçš„aclæƒé™æ§åˆ¶" class="sidebar-link">zookeeperçš„Aclæƒé™æ§åˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#æ¡ˆä¾‹-è¿œç¨‹ç™»å½•" class="sidebar-link">æ¡ˆä¾‹/è¿œç¨‹ç™»å½•</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#acl-è¶…çº§ç®¡ç†å‘˜" class="sidebar-link">acl è¶…çº§ç®¡ç†å‘˜</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#zookeeperçš„-javaapi" class="sidebar-link">zookeeperçš„ JavaAPI</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#è¿æ¥åˆ°zookeeper" class="sidebar-link">è¿æ¥åˆ°Zookeeper</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#æ–°å¢èŠ‚ç‚¹" class="sidebar-link">æ–°å¢èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#ä¿®æ”¹èŠ‚ç‚¹" class="sidebar-link">ä¿®æ”¹èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åˆ é™¤èŠ‚ç‚¹" class="sidebar-link">åˆ é™¤èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#æŸ¥çœ‹èŠ‚ç‚¹" class="sidebar-link">æŸ¥çœ‹èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#æŸ¥çœ‹å­èŠ‚ç‚¹" class="sidebar-link">æŸ¥çœ‹å­èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="sidebar-link">æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#äº‹ä»¶ç›‘å¬æœºåˆ¶" class="sidebar-link">äº‹ä»¶ç›‘å¬æœºåˆ¶</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#watcheræ¶æ„" class="sidebar-link">watcheræ¶æ„</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#watcherç‰¹æ€§" class="sidebar-link">watcherç‰¹æ€§</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#é…ç½®ä¸­å¿ƒæ¡ˆä¾‹" class="sidebar-link">é…ç½®ä¸­å¿ƒæ¡ˆä¾‹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹" class="sidebar-link">åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åˆ†å¸ƒå¼é”æ¡ˆä¾‹" class="sidebar-link">åˆ†å¸ƒå¼é”æ¡ˆä¾‹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#é›†ç¾¤æ­å»º" class="sidebar-link">é›†ç¾¤æ­å»º</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#ä¸€è‡´æ€§åè®®-zabåè®®" class="sidebar-link">ä¸€è‡´æ€§åè®®â€”â€”zabåè®®</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#leaderé€‰ä¸¾" class="sidebar-link">leaderé€‰ä¸¾</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#observerè§’è‰²åŠå…¶é…ç½®" class="sidebar-link">observerè§’è‰²åŠå…¶é…ç½®</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#apiè¿æ¥é›†ç¾¤" class="sidebar-link">APIè¿æ¥é›†ç¾¤</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#curatorä»‹ç»" class="sidebar-link">curatorä»‹ç»</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åŸºç¡€ç”¨æ³•" class="sidebar-link">åŸºç¡€ç”¨æ³•</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åˆ›å»º-2" class="sidebar-link">åˆ›å»º</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#ä¿®æ”¹" class="sidebar-link">ä¿®æ”¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åˆ é™¤-2" class="sidebar-link">åˆ é™¤</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#è¯»å–èŠ‚ç‚¹" class="sidebar-link">è¯»å–èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#è¯»å–å­èŠ‚ç‚¹" class="sidebar-link">è¯»å–å­èŠ‚ç‚¹</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#watcher" class="sidebar-link">watcher</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#äº‹åŠ¡" class="sidebar-link">äº‹åŠ¡</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#åˆ†å¸ƒå¼é”" class="sidebar-link">åˆ†å¸ƒå¼é”</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#å››å­—ç›‘æ§å‘½ä»¤-é…ç½®å±æ€§" class="sidebar-link">å››å­—ç›‘æ§å‘½ä»¤/é…ç½®å±æ€§</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#conf" class="sidebar-link">conf</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#cons" class="sidebar-link">cons</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#crst" class="sidebar-link">crst</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#dump" class="sidebar-link">dump</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#envi" class="sidebar-link">envi</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#ruok" class="sidebar-link">ruok</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#stat" class="sidebar-link">stat</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#srst" class="sidebar-link">srst</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#wchs" class="sidebar-link">wchs</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#wchc" class="sidebar-link">wchc</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#wchp" class="sidebar-link">wchp</a></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#mntr" class="sidebar-link">mntr</a></li></ul></li><li class="sidebar-sub-header"><a href="/znote/views/backend/zookeeper.html#zooinspectorå›¾å½¢åŒ–å·¥å…·" class="sidebar-link">ZooInspectorå›¾å½¢åŒ–å·¥å…·</a></li></ul></li><li><a href="/znote/views/backend/åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°.html" class="sidebar-link">åˆ†å¸ƒå¼ç³»ç»Ÿæ¦‚è¿°</a></li><li><a href="/znote/views/backend/ArrayList.html" class="sidebar-link">ArrayList åº•å±‚å®ç°å’ŒåŸç†</a></li><li><a href="/znote/views/backend/HashMap.html" class="sidebar-link">HashMap åº•å±‚å®ç°å’ŒåŸç†</a></li><li><a href="/znote/views/backend/spring-security-01.html" class="sidebar-link">Spring Security åˆè¯†</a></li><li><a href="/znote/views/backend/spring-security-02.html" class="sidebar-link">Spring Security è®¤è¯æˆæƒ</a></li><li><a href="/znote/views/backend/SchedulingConfigurer.html" class="sidebar-link">Spring å®šæ—¶ä»»åŠ¡æ·»åŠ å¼€å…³ï¼Œä¿®æ”¹cronä¸ç”¨é‡å¯</a></li><li><a href="/znote/views/backend/ThreadTopCPU.html" class="sidebar-link">æ‰¾å‡ºæŸä¸ªJavaè¿›ç¨‹ä¸­æœ€è€—è´¹CPUçš„Javaçº¿ç¨‹</a></li><li><a href="/znote/views/backend/OOMåˆ†ç±»åŠæ’æŸ¥.html" class="sidebar-link">OOMåˆ†ç±»åŠæ’æŸ¥</a></li><li><a href="/znote/views/backend/EasyExcel.html" class="sidebar-link">EasyExcel</a></li><li><a href="/znote/views/backend/java_ioæ¨¡å‹.html" class="sidebar-link">IO æ¨¡å‹</a></li><li><a href="/znote/views/backend/spring_application_json.html" class="sidebar-link">Spring Boot é™¤ xml/yml å¤–ï¼Œåˆ©ç”¨ SPI æ”¯æŒå¯¹ json é…ç½®æ–‡ä»¶çš„è§£æ</a></li><li><a href="/znote/views/backend/springbooté…ç½®æ–‡ä»¶åŠ è½½é¡ºåº.html" class="sidebar-link">Spring Boot é…ç½®æ–‡ä»¶åŠ è½½é¡ºåº</a></li><li><a href="/znote/views/backend/åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†åŒºåˆ«.html" class="sidebar-link">åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†åŒºåˆ«</a></li><li><a href="/znote/views/backend/zké€‰ä¸¾å’Œä¸€è‡´æ€§.html" class="sidebar-link">ZooKeeper å¦‚ä½•ä¿è¯ä¸€è‡´æ€§åŠå¦‚ä½•é€‰ä¸¾</a></li><li><a href="/znote/views/backend/è¶…æ—¶å–æ¶ˆåˆ†æ.html" class="sidebar-link">è®¢å•è¶…æ—¶è‡ªåŠ¨å–æ¶ˆ/å»¶æ—¶ä»»åŠ¡ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</a></li><li><a href="/znote/views/backend/spring-mini-ioc.html" class="sidebar-link">Spring IOC åº•å±‚å®ç°åŸç†ä»‹ç»ï¼Œæ‰‹åŠ¨å®ç° IOC å®¹å™¨</a></li><li><a href="/znote/views/backend/Springçš„IOCæºç ä»¥åŠæµç¨‹åˆ†æ.html" class="sidebar-link">Springçš„ IOC æºç ä»¥åŠæµç¨‹åˆ†æ</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸŒµ èƒ½åŠ›æ‰©å±• DevOps</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸ§© æ‰‹æ’¸æºç  Source-code</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸŒ´ å‘½ç†å­¦ Numerology</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ğŸ”— éšç¬” Essay</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-73c95a87 data-v-4c312ed8><h3 class="title" style="display:none;" data-v-73c95a87 data-v-73c95a87>Zookeeper å…¨è§£</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-73c95a87 data-v-73c95a87><input type="password" value="" data-v-73c95a87> <span data-v-73c95a87>Konck! Knock!</span> <button data-v-73c95a87>OK</button></label> <div class="footer" style="display:none;" data-v-73c95a87 data-v-73c95a87><span data-v-73c95a87><i class="iconfont reco-theme" data-v-73c95a87></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-73c95a87>vuePress-theme-reco</a></span> <span data-v-73c95a87><i class="iconfont reco-copyright" data-v-73c95a87></i> <a data-v-73c95a87><span data-v-73c95a87>z</span>
          Â Â 
          <span data-v-73c95a87>2019 - </span>
          2026
        </a></span></div></div> <div data-v-4c312ed8><main class="page"><!----> <div class="page-title" style="display:none;"><h1>Zookeeper å…¨è§£</h1> <hr> <div data-v-20832e8c><i class="iconfont reco-account" data-v-20832e8c><span data-v-20832e8c>z</span></i> <i class="iconfont reco-date" data-v-20832e8c><span data-v-20832e8c>2020-12-26</span></i> <!----> <i class="iconfont reco-tag tags" data-v-20832e8c><span class="tag-item" data-v-20832e8c>
      åˆ†å¸ƒå¼
    </span><span class="tag-item" data-v-20832e8c>
      ZooKeeper
    </span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><div id="boxx"><div><p class="custom-block-title"></p> <p></p></div></div> <p>å®˜æ–¹æ–‡æ¡£ä¸Šè¿™ä¹ˆè§£é‡Šzookeeperï¼Œå®ƒæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æœåŠ¡æ¡†æ¶ï¼Œæ˜¯Apache Hadoopçš„ä¸€ä¸ªå­é¡¹ç›®ï¼Œå®ƒä¸»è¦æ˜¯ç”¨æ¥è§£å†³åˆ†å¸ƒå¼åº”ç”¨ä¸­ç»å¸¸é‡åˆ°çš„ä¸€äº›æ•°æ®ç®¡ç†é—®é¢˜ï¼Œå¦‚ï¼šç»Ÿä¸€å‘½åæœåŠ¡ã€çŠ¶æ€åŒæ­¥æœåŠ¡ã€é›†ç¾¤ç®¡ç†ã€åˆ†å¸ƒå¼åº”ç”¨é…ç½®é¡¹çš„ç®¡ç†ç­‰ã€‚</p> <p>ç®€å•æ¥è¯´zookeeper=æ–‡ä»¶ç³»ç»Ÿ+ç›‘å¬é€šçŸ¥æœºåˆ¶ã€‚</p> <p></p><div class="table-of-contents"><ul><li><a href="#ç®€ä»‹-å¿«é€Ÿå…¥é—¨">ç®€ä»‹/å¿«é€Ÿå…¥é—¨</a><ul><li><a href="#åº”ç”¨åœºæ™¯">åº”ç”¨åœºæ™¯</a></li><li><a href="#zookeeperçš„è®¾è®¡ç›®æ ‡">Zookeeperçš„è®¾è®¡ç›®æ ‡</a></li><li><a href="#æ•°æ®æ¨¡å‹">æ•°æ®æ¨¡å‹</a></li><li><a href="#ç»“ç‚¹çŠ¶æ€statçš„å±æ€§">ç»“ç‚¹çŠ¶æ€statçš„å±æ€§</a></li><li><a href="#å•æœºå®‰è£…">å•æœºå®‰è£…</a></li></ul></li><li><a href="#å¸¸ç”¨shellå‘½ä»¤">å¸¸ç”¨shellå‘½ä»¤</a></li><li><a href="#zookeeperçš„aclæƒé™æ§åˆ¶">zookeeperçš„Aclæƒé™æ§åˆ¶</a><ul><li><a href="#æ¡ˆä¾‹-è¿œç¨‹ç™»å½•">æ¡ˆä¾‹/è¿œç¨‹ç™»å½•</a></li><li><a href="#acl-è¶…çº§ç®¡ç†å‘˜">acl è¶…çº§ç®¡ç†å‘˜</a></li></ul></li><li><a href="#zookeeperçš„-javaapi">zookeeperçš„ JavaAPI</a><ul><li><a href="#è¿æ¥åˆ°zookeeper">è¿æ¥åˆ°Zookeeper</a></li><li><a href="#æ–°å¢èŠ‚ç‚¹">æ–°å¢èŠ‚ç‚¹</a></li><li><a href="#ä¿®æ”¹èŠ‚ç‚¹">ä¿®æ”¹èŠ‚ç‚¹</a></li><li><a href="#åˆ é™¤èŠ‚ç‚¹">åˆ é™¤èŠ‚ç‚¹</a></li><li><a href="#æŸ¥çœ‹èŠ‚ç‚¹">æŸ¥çœ‹èŠ‚ç‚¹</a></li><li><a href="#æŸ¥çœ‹å­èŠ‚ç‚¹">æŸ¥çœ‹å­èŠ‚ç‚¹</a></li><li><a href="#æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨">æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</a></li></ul></li><li><a href="#äº‹ä»¶ç›‘å¬æœºåˆ¶">äº‹ä»¶ç›‘å¬æœºåˆ¶</a><ul><li><a href="#watcheræ¶æ„">watcheræ¶æ„</a></li><li><a href="#watcherç‰¹æ€§">watcherç‰¹æ€§</a></li></ul></li><li><a href="#é…ç½®ä¸­å¿ƒæ¡ˆä¾‹">é…ç½®ä¸­å¿ƒæ¡ˆä¾‹</a></li><li><a href="#åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹">åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹</a></li><li><a href="#åˆ†å¸ƒå¼é”æ¡ˆä¾‹">åˆ†å¸ƒå¼é”æ¡ˆä¾‹</a></li><li><a href="#é›†ç¾¤æ­å»º">é›†ç¾¤æ­å»º</a><ul><li><a href="#ä¸€è‡´æ€§åè®®-zabåè®®">ä¸€è‡´æ€§åè®®â€”â€”zabåè®®</a></li><li><a href="#leaderé€‰ä¸¾">leaderé€‰ä¸¾</a></li><li><a href="#observerè§’è‰²åŠå…¶é…ç½®">observerè§’è‰²åŠå…¶é…ç½®</a></li><li><a href="#apiè¿æ¥é›†ç¾¤">APIè¿æ¥é›†ç¾¤</a></li></ul></li><li><a href="#curatorä»‹ç»">curatorä»‹ç»</a><ul><li><a href="#åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•</a></li><li><a href="#åˆ›å»º">åˆ›å»º</a></li><li><a href="#ä¿®æ”¹">ä¿®æ”¹</a></li><li><a href="#åˆ é™¤">åˆ é™¤</a></li><li><a href="#è¯»å–èŠ‚ç‚¹">è¯»å–èŠ‚ç‚¹</a></li><li><a href="#è¯»å–å­èŠ‚ç‚¹">è¯»å–å­èŠ‚ç‚¹</a></li><li><a href="#watcher">watcher</a></li><li><a href="#äº‹åŠ¡">äº‹åŠ¡</a></li><li><a href="#åˆ†å¸ƒå¼é”">åˆ†å¸ƒå¼é”</a></li></ul></li><li><a href="#å››å­—ç›‘æ§å‘½ä»¤-é…ç½®å±æ€§">å››å­—ç›‘æ§å‘½ä»¤/é…ç½®å±æ€§</a><ul><li><a href="#conf">conf</a></li><li><a href="#cons">cons</a></li><li><a href="#crst">crst</a></li><li><a href="#dump">dump</a></li><li><a href="#envi">envi</a></li><li><a href="#ruok">ruok</a></li><li><a href="#stat">stat</a></li><li><a href="#srst">srst</a></li><li><a href="#wchs">wchs</a></li><li><a href="#wchc">wchc</a></li><li><a href="#wchp">wchp</a></li><li><a href="#mntr">mntr</a></li></ul></li><li><a href="#zooinspectorå›¾å½¢åŒ–å·¥å…·">ZooInspectorå›¾å½¢åŒ–å·¥å…·</a></li></ul></div><p></p> <h2 id="ç®€ä»‹-å¿«é€Ÿå…¥é—¨"><a href="#ç®€ä»‹-å¿«é€Ÿå…¥é—¨" class="header-anchor">#</a> ç®€ä»‹/å¿«é€Ÿå…¥é—¨</h2> <p>å®˜ç½‘ï¼š<a href="https://zookeeper.apache.org/" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <blockquote><p>ZooKeeper is a centralized service for maintaining configuration information, naming, providing distributed synchronization, and providing group services. All of these kinds of services are used in some form or another by distributed applications. Each time they are implemented there is a lot of work that goes into fixing the bugs and race conditions that are inevitable. Because of the difficulty of implementing these kinds of services, applications initially usually skimp on them, which make them brittle in the presence of change and difficult to manage. Even when done correctly, different implementations of these services lead to management complexity when the applications are deployed.</p></blockquote> <p><code>ZooKeeper</code>æ˜¯ä¸€ä¸ªé›†ä¸­çš„æœåŠ¡ï¼Œç”¨äºç»´æŠ¤é…ç½®ä¿¡æ¯ã€å‘½åã€æä¾›åˆ†å¸ƒå¼åŒæ­¥å’Œæä¾›ç»„æœåŠ¡ã€‚æ‰€æœ‰è¿™äº›ç±»å‹çš„æœåŠ¡éƒ½ä»¥æŸç§å½¢å¼è¢«åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºä½¿ç”¨ã€‚æ¯æ¬¡å®ƒä»¬è¢«å®ç°æ—¶ï¼Œéƒ½ä¼šæœ‰å¤§é‡çš„å·¥ä½œæ¥ä¿®å¤ä¸å¯é¿å…çš„é”™è¯¯å’Œç«äº‰æ¡ä»¶ã€‚ç”±äºå®ç°è¿™äº›æœåŠ¡çš„å›°éš¾ï¼Œåº”ç”¨ç¨‹åºæœ€åˆé€šå¸¸ä¼šç•¥è¿‡è¿™äº›æœåŠ¡ï¼Œè¿™ä½¿å¾—å®ƒä»¬åœ¨å‡ºç°æ›´æ”¹æ—¶å˜å¾—è„†å¼±ï¼Œå¹¶ä¸”éš¾ä»¥ç®¡ç†ã€‚å³ä½¿æ­£ç¡®åœ°æ‰§è¡Œäº†è¿™äº›æœåŠ¡ï¼Œåœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºæ—¶ï¼Œè¿™äº›æœåŠ¡çš„ä¸åŒå®ç°ä¹Ÿä¼šå¯¼è‡´ç®¡ç†å¤æ‚æ€§</p> <p><code>zookeeper</code>ç”±é›…è™ç ”ç©¶é™¢å¼€å‘,æ˜¯<code>Google Chubby</code>çš„å¼€æºå®ç°,åæ¥æ‰˜ç®¡åˆ° <code>Apache</code>,äº<code>2010å¹´11æœˆ</code>æ­£å¼æˆä¸º<code>apache</code>çš„é¡¶çº§é¡¹ç›®</p> <p>å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿé‡Œç”±å¾ˆå¤šç»„ä»¶çš„å‘½åéƒ½æ˜¯æŸäº›åŠ¨ç‰©æˆ–è€…æ˜†è™«ï¼Œæ¯”å¦‚<code>hadoop</code>å¤§è±¡ï¼Œ<code>hive</code>å°±æ˜¯èœ‚å·¢ï¼Œ<code>zookeeper</code>å³ç®¡ç†å‘˜ï¼Œé¡¾åæ€ä¹‰å°±ç®—ç®¡ç†å¤§æ•°æ®ç”Ÿæ€ç³»ç»Ÿå„ç»„ä»¶çš„ç®¡ç†å‘˜ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <p><img src="/znote/img/backend/zk/zookeeper-1.png" alt="zookeeper-1"></p> <h4 id="åº”ç”¨åœºæ™¯"><a href="#åº”ç”¨åœºæ™¯" class="header-anchor">#</a> åº”ç”¨åœºæ™¯</h4> <p><code>zookeepepr</code>æ˜¯ä¸€ä¸ªç»å…¸çš„<strong>åˆ†å¸ƒå¼</strong>æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆï¼Œè‡´åŠ›äºä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨,ä¸”å…·æœ‰ä¸¥æ ¼é¡ºåºè®¿é—®æ§åˆ¶èƒ½åŠ›çš„åˆ†å¸ƒå¼åè°ƒå­˜å‚¨æœåŠ¡ã€‚</p> <ul><li>ç»´æŠ¤é…ç½®ä¿¡æ¯</li> <li>åˆ†å¸ƒå¼é”æœåŠ¡</li> <li>é›†ç¾¤ç®¡ç†</li> <li>ç”Ÿæˆåˆ†å¸ƒå¼å”¯ä¸€ID</li></ul> <ol><li><p><strong>ç»´æŠ¤é…ç½®ä¿¡æ¯</strong></p> <ul><li><p><code>java</code>ç¼–ç¨‹ç»å¸¸ä¼šé‡åˆ°é…ç½®é¡¹ï¼Œæ¯”å¦‚æ•°æ®åº“çš„<code>url</code>ã€ <code>schema</code>ã€<code>user</code>å’Œ <code>password</code>ç­‰ã€‚é€šå¸¸è¿™äº›é…ç½®é¡¹æˆ‘ä»¬ä¼šæ”¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œå†å°†é…ç½®æ–‡ä»¶æ”¾ç½®åœ¨æœåŠ¡å™¨ä¸Šå½“éœ€è¦æ›´æ”¹é…ç½®é¡¹æ—¶ï¼Œéœ€è¦å»æœåŠ¡å™¨ä¸Šä¿®æ”¹å¯¹åº”çš„é…ç½®æ–‡ä»¶ã€‚</p> <p>ä½†æ˜¯éšç€åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…´èµ·,ç”±äºè®¸å¤šæœåŠ¡éƒ½éœ€è¦ä½¿ç”¨åˆ°è¯¥é…ç½®æ–‡ä»¶,å› æ­¤æœ‰<strong>å¿…é¡»ä¿è¯è¯¥é…ç½®æœåŠ¡çš„é«˜å¯ç”¨æ€§</strong>(<code>highavailability</code>)å’Œå„å°æœåŠ¡å™¨ä¸Šé…ç½®æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p> <p>é€šå¸¸ä¼šå°†é…ç½®æ–‡ä»¶éƒ¨ç½²åœ¨ä¸€ä¸ªé›†ç¾¤ä¸Šï¼Œç„¶è€Œä¸€ä¸ª<strong>é›†ç¾¤åŠ¨è¾„ä¸Šåƒå°</strong>æœåŠ¡å™¨ï¼Œæ­¤æ—¶å¦‚æœå†ä¸€å°å°æœåŠ¡å™¨é€ä¸ªä¿®æ”¹é…ç½®æ–‡ä»¶é‚£å°†æ˜¯éå¸¸ç¹çä¸”å±é™©çš„çš„æ“ä½œï¼Œå› æ­¤å°±<strong>éœ€è¦ä¸€ç§æœåŠ¡</strong>ï¼Œ<strong>èƒ½å¤Ÿé«˜æ•ˆå¿«é€Ÿä¸”å¯é åœ°å®Œæˆé…ç½®é¡¹çš„æ›´æ”¹ç­‰æ“ä½œ</strong>ï¼Œå¹¶èƒ½å¤Ÿä¿è¯å„é…ç½®é¡¹åœ¨æ¯å°æœåŠ¡å™¨ä¸Šçš„æ•°æ®ä¸€è‡´æ€§ã€‚</p> <p><strong><code>zookeeper</code>å°±å¯ä»¥æä¾›è¿™æ ·ä¸€ç§æœåŠ¡</strong>ï¼Œå…¶ä½¿ç”¨<code>Zab</code>è¿™ç§ä¸€è‡´æ€§åè®®æ¥ä¿è¯ä¸€è‡´æ€§ã€‚ç°åœ¨æœ‰å¾ˆå¤šå¼€æºé¡¹ç›®ä½¿ç”¨<code>zookeeper</code>æ¥ç»´æŠ¤é…ç½®ï¼Œå¦‚åœ¨ <code>hbase</code>ä¸­ï¼Œå®¢æˆ·ç«¯å°±æ˜¯è¿æ¥ä¸€ä¸ª <code>zookeeper</code>ï¼Œè·å¾—å¿…è¦çš„ <code>hbase</code>é›†ç¾¤çš„é…ç½®ä¿¡æ¯ï¼Œç„¶åæ‰å¯ä»¥è¿›ä¸€æ­¥æ“ä½œã€‚è¿˜æœ‰åœ¨å¼€æºçš„æ¶ˆæ¯é˜Ÿåˆ— <code>kafka</code>ä¸­ï¼Œä¹Ÿä¾¿ç”¨<code>zookeeper</code>æ¥ç»´æŠ¤ <code>brokers</code>çš„ä¿¡æ¯ã€‚åœ¨ <code>alibaba</code>å¼€æºçš„<code>soa</code>æ¡†æ¶<code>dubbo</code>ä¸­ä¹Ÿå¹¿æ³›çš„ä½¿ç”¨<code>zookeeper</code>ç®¡ç†ä¸€äº›é…ç½®æ¥å®ç°æœåŠ¡æ²»ç†ã€‚</p> <p><img src="/znote/img/backend/zk/zookeeper-2.png" alt="zookeeper-2"></p></li></ul></li> <li><p>åˆ†å¸ƒå¼é”æœåŠ¡</p> <ul><li>ä¸€ä¸ªé›†ç¾¤æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œç”±å¤šå°æœåŠ¡å™¨ç»„æˆã€‚ä¸ºäº†æé«˜å¹¶å‘åº¦å’Œå¯é æ€§ï¼Œå¤šå°æœåŠ¡å™¨ä¸Šè¿è¡Œç€åŒä¸€ç§æœåŠ¡ã€‚å½“å¤šä¸ªæœåŠ¡åœ¨è¿è¡Œæ—¶å°±éœ€è¦åè°ƒå„æœåŠ¡çš„è¿›åº¦ï¼Œæœ‰æ—¶å€™éœ€è¦ä¿è¯å½“æŸä¸ªæœåŠ¡åœ¨è¿›è¡ŒæŸä¸ªæ“ä½œæ—¶ï¼Œå…¶ä»–çš„æœåŠ¡éƒ½ä¸èƒ½è¿›è¡Œè¯¥æ“ä½œï¼Œå³å¯¹è¯¥æ“ä½œè¿›è¡ŒåŠ é”ï¼Œå¦‚æœå½“å‰æœºå™¨æŒ‚æ‰åï¼Œé‡Šæ”¾é”å¹¶ <code>fail over</code>åˆ°å…¶ä»–çš„æœºå™¨ç»§ç»­æ‰§è¡Œè¯¥æœåŠ¡</li></ul></li> <li><p>é›†ç¾¤ç®¡ç†</p> <ul><li><p>ä¸€ä¸ªé›†ç¾¤æœ‰æ—¶ä¼šå› ä¸ºå„ç§è½¯ç¡¬ä»¶æ•…éšœæˆ–è€…ç½‘ç»œæ•…éšœï¼Œå‡ºç°æ£Šäº›æœåŠ¡å™¨æŒ‚æ‰è€Œè¢«ç§»é™¤é›†ç¾¤ï¼Œè€ŒæŸäº›æœåŠ¡å™¨åŠ å…¥åˆ°é›†ç¾¤ä¸­çš„æƒ…å†µï¼Œ<code>zookeeper</code>ä¼šå°†è¿™äº›æœåŠ¡å™¨åŠ å…¥/ç§»å‡ºçš„æƒ…å†µé€šçŸ¥ç»™é›†ç¾¤ä¸­çš„å…¶ä»–æ­£å¸¸å·¥ä½œçš„æœåŠ¡å™¨ï¼Œä»¥åŠæ—¶è°ƒæ•´å­˜å‚¨å’Œè®¡ç®—ç­‰ä»»åŠ¡çš„åˆ†é…å’Œæ‰§è¡Œç­‰ã€‚æ­¤å¤–<code>zookeeper</code>è¿˜ä¼šå¯¹æ•…éšœçš„æœåŠ¡å™¨åšå‡ºè¯Šæ–­å¹¶å°è¯•ä¿®å¤ã€‚</p> <p><img src="/znote/img/backend/zk/zookeeper-3.png" alt="zookeeper-3"></p></li></ul></li> <li><p>ç”Ÿäº§åˆ†å¸ƒå¼å”¯ä¸€ID</p> <ul><li><p>åœ¨è¿‡å»çš„å•åº“å•è¡¨å‹ç³»ç»Ÿä¸­ï¼Œé€šå¸¸å¯ä»¥ä½¿ç”¨æ•°æ®åº“å­—æ®µè‡ªå¸¦çš„<code>auto_ increment</code>å±æ€§æ¥è‡ªåŠ¨ä¸ºæ¯æ¡è®°å½•ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„<code>ID</code>ã€‚ä½†æ˜¯åˆ†åº“åˆ†è¡¨åï¼Œå°±æ— æ³•åœ¨ä¾é æ•°æ®åº“çš„<code>auto_ Increment</code>å±æ€§æ¥å”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨<code>zookeeper</code>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”Ÿæˆå…¨å±€å”¯ä¸€<code>ID</code>ã€‚</p> <p>åšæ³•å¦‚ä¸‹:æ¯æ¬¡è¦ç”Ÿæˆä¸€ä¸ªæ–°<code>id</code>æ—¶ï¼Œåˆ›å»ºä¸€ä¸ªæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»ºæ“ä½œè¿”å›çš„èŠ‚ç‚¹åºå·ï¼Œå³ä¸ºæ–°<code>id</code>ï¼Œç„¶åæŠŠæ¯”è‡ªå·±èŠ‚ç‚¹å°çš„åˆ é™¤å³å¯</p></li></ul></li></ol> <h4 id="zookeeperçš„è®¾è®¡ç›®æ ‡"><a href="#zookeeperçš„è®¾è®¡ç›®æ ‡" class="header-anchor">#</a> Zookeeperçš„è®¾è®¡ç›®æ ‡</h4> <p><code>zooKeeper</code>è‡´åŠ›äºä¸ºåˆ†å¸ƒå¼åº”ç”¨æä¾›ä¸€ä¸ªé«˜æ€§èƒ½ã€é«˜å¯ç”¨ï¼Œä¸”å…·æœ‰ä¸¥æ ¼é¡ºåºè®¿é—®æ§åˆ¶èƒ½åŠ›çš„åˆ†å¸ƒå¼åè°ƒæœåŠ¡</p> <ol><li>é«˜æ€§èƒ½
<ul><li><code>zookeeper</code>å°†å…¨é‡æ•°æ®å­˜å‚¨åœ¨<strong>å†…å­˜</strong>ä¸­ï¼Œå¹¶ç›´æ¥æœåŠ¡äºå®¢æˆ·ç«¯çš„æ‰€æœ‰éäº‹åŠ¡è¯·æ±‚ï¼Œå°¤å…¶ç”¨äºä»¥è¯»ä¸ºä¸»çš„åº”ç”¨åœºæ™¯</li></ul></li> <li>é«˜å¯ç”¨
<ul><li><code>zookeeper</code>ä¸€èˆ¬ä»¥é›†ç¾¤çš„æ–¹å¼å¯¹å¤–æä¾›æœåŠ¡ï¼Œä¸€èˆ¬<code>3~5</code>å°æœºå™¨å°±å¯ä»¥ç»„æˆä¸€ä¸ªå¯ç”¨çš„ <code>Zookeeper</code>é›†ç¾¤äº†ï¼Œæ¯å°æœºå™¨éƒ½ä¼šåœ¨å†…å­˜ä¸­ç»´æŠ¤å½“å‰çš„æœåŠ¡å™¨çŠ¶æ€ï¼Œäº•ä¸”æ¯å°æœºå™¨ä¹‹é—´éƒ½ç›¸äº’ä¿æŒç€é€šä¿¡ã€‚åªè¦é›†ç¾¤ä¸­è¶…è¿‡ä¸€åŠçš„æœºå™¨éƒ½èƒ½å¤Ÿæ­£å¸¸å·¥ä½œï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°±èƒ½å¤Ÿæ­£å¸¸å¯¹å¤–æœåŠ¡</li></ul></li> <li>ä¸¥æ ¼é¡ºåºè®¿é—®
<ul><li>å¯¹äºæ¥è‡ªå®¢æˆ·ç«¯çš„æ¯ä¸ªæ›´æ–°è¯·æ±‚ï¼Œ<code>Zookeeper</code>éƒ½ä¼šåˆ†é…ä¸€ä¸ªå…¨å±€å”¯ä¸€çš„é€’å¢ç¼–å·ï¼Œè¿™ä¸ªç¼–å·ååº”äº†æ‰€æœ‰äº‹åŠ¡æ“ä½œçš„å…ˆåé¡ºåº</li></ul></li></ol> <h4 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="header-anchor">#</a> æ•°æ®æ¨¡å‹</h4> <p><code>zookeeper</code>çš„æ•°æ®ç»“ç‚¹å¯ä»¥è§†ä¸ºæ ‘çŠ¶ç»“æ„(æˆ–ç›®å½•)ï¼Œæ ‘ä¸­çš„å„ä¸ªç»“ç‚¹è¢«ç§°ä¸º<code>znode</code>(å³<code>zookeeper node</code>)ï¼Œä¸€ä¸ª<code>znode</code>å¯ä»¥ç”±å¤šä¸ªå­ç»“ç‚¹ã€‚<code>zookeeper</code>ç»“ç‚¹åœ¨ç»“æ„ä¸Šè¡¨ç°ä¸ºæ ‘çŠ¶ï¼›</p> <p>ä½¿ç”¨è·¯å¾„<code>path</code>æ¥å®šä½æŸä¸ª<code>znode</code>ï¼Œæ¯”å¦‚<code>/ns-1/itcast/mysqml/schemal1/table1</code>ï¼Œæ­¤å¤„<code>ns-1ï¼Œitcastã€mysqlã€schemal1ã€table1</code>åˆ†åˆ«æ˜¯<code>æ ¹ç»“ç‚¹ã€2çº§ç»“ç‚¹ã€3çº§ç»“ç‚¹ä»¥åŠ4çº§ç»“ç‚¹</code>ï¼›å…¶ä¸­<code>ns-1</code>æ˜¯<code>itcast</code>çš„çˆ¶ç»“ç‚¹ï¼Œ<code>itcast</code>æ˜¯<code>ns-1</code>çš„å­ç»“ç‚¹ï¼Œ<code>itcast</code>æ˜¯<code>mysql</code>çš„çˆ¶ç»“ç‚¹....ä»¥æ­¤ç±»æ¨</p> <p><code>znode</code>ï¼Œé—´è·æ–‡ä»¶å’Œç›®å½•ä¸¤ç§ç‰¹ç‚¹ï¼Œå³åƒæ–‡ä»¶ä¸€æ ·ç»´æŠ¤ç€æ•°æ®ã€å…ƒä¿¡æ¯ã€ACLã€æ—¶é—´æˆ³ç­‰æ•°æ®ç»“æ„ï¼Œåˆåƒç›®å½•ä¸€æ ·å¯ä»¥ä½œä¸ºè·¯å¾„æ ‡è¯†çš„ä¸€éƒ¨åˆ†</p> <p><img src="/znote/img/backend/zk/zookeeper-4.png" alt="zookeeper-4"></p> <p>é‚£ä¹ˆå¦‚ä½•æè¿°ä¸€ä¸ª<code>znode</code>å‘¢ï¼Ÿä¸€ä¸ª<code>znode</code>å¤§ä½“ä¸Šåˆ†ä¸º<code>3</code>ä¸ªéƒ¨åˆ†ï¼š</p> <ul><li>ç»“ç‚¹çš„æ•°æ®ï¼šå³<code>znode data</code>(ç»“ç‚¹<code>path</code>ï¼Œç»“ç‚¹<code>data</code>)çš„å…³ç³»å°±åƒæ˜¯<code>Java map</code>ä¸­çš„ <code>key value</code>å…³ç³»</li> <li>ç»“ç‚¹çš„å­ç»“ç‚¹<code>children</code></li> <li>ç»“ç‚¹çš„çŠ¶æ€<code>stat</code>ï¼šç”¨æ¥æè¿°å½“å‰ç»“ç‚¹çš„åˆ›å»ºã€ä¿®æ”¹è®°å½•ï¼ŒåŒ…æ‹¬<code>cZxid</code>ã€<code>ctime</code>ç­‰</li></ul> <h4 id="ç»“ç‚¹çŠ¶æ€statçš„å±æ€§"><a href="#ç»“ç‚¹çŠ¶æ€statçš„å±æ€§" class="header-anchor">#</a> ç»“ç‚¹çŠ¶æ€statçš„å±æ€§</h4> <p>åœ¨<code>zookeeper shell</code>ä¸­ä½¿ç”¨ <code>get</code>å‘½ä»¤æŸ¥çœ‹æŒ‡å®šè·¯å¾„ç»“ç‚¹çš„<code>data</code>ã€<code>stat</code>ä¿¡æ¯</p> <p><img src="/znote/img/backend/zk/zookeeper-5.png" alt="zookeeper-5"></p> <p>å±æ€§è¯´æ˜ï¼š</p> <p>ç»“ç‚¹çš„å„ä¸ªå±æ€§å¦‚ä¸‹ã€‚å…¶ä¸­é‡è¦çš„æ¦‚å¿µæ˜¯<code>Zxid(Zookeeper Transaction ID)</code>ï¼Œ<code>Zookeeper</code>ç»“ç‚¹çš„æ¯ä¸€æ¬¡æ›´æ”¹éƒ½å…·æœ‰å”¯ä¸€çš„<code>Zxid</code>ï¼Œå¦‚æœ<code>Zxid-1</code> å°äº<code>Zxid-2</code> ï¼Œåˆ™<code>Zxid-1</code> çš„æ›´æ”¹å‘ç”Ÿåœ¨ <code>Zxid-2</code>æ›´æ”¹ä¹‹å‰</p> <p><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_zkDataModel_znodes" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_zkDataModel_znodes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><code>cZxid</code>æ•°æ®ç»“ç‚¹åˆ›å»ºæ—¶çš„äº‹åŠ¡IDâ€”â€”é’ˆå¯¹äº<code>zookeeper</code>æ•°æ®ç»“ç‚¹çš„ç®¡ç†ï¼šæˆ‘ä»¬å¯¹ç»“ç‚¹æ•°æ®çš„ä¸€äº›å†™æ“ä½œéƒ½ä¼šå¯¼è‡´<code>zookeeper</code>è‡ªåŠ¨åœ°ä¸ºæˆ‘ä»¬å»å¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶ä¸”è‡ªåŠ¨åœ°å»ä¸ºæ¯ä¸€ä¸ªäº‹åŠ¡ç»´æŠ¤ä¸€ä¸ªäº‹åŠ¡<code>ID</code></li> <li><code>ctime</code>æ•°æ®ç»“ç‚¹åˆ›å»ºæ—¶çš„æ—¶é—´</li> <li><code>mZxid</code>æ•°æ®ç»“ç‚¹æœ€åä¸€æ¬¡æ›´æ–°æ—¶çš„äº‹åŠ¡ID</li> <li><code>mtime</code>æ•°æ®ç»“ç‚¹æœ€åä¸€æ¬¡æ›´æ–°æ—¶çš„æ—¶é—´</li> <li><code>pZxid</code>æ•°æ®èŠ‚ç‚¹æœ€åä¸€æ¬¡ä¿®æ”¹æ­¤<code>znode</code>å­èŠ‚ç‚¹æ›´æ”¹çš„<code>zxid</code></li> <li><code>cversion</code>å­ç»“ç‚¹çš„æ›´æ”¹æ¬¡æ•°</li> <li><code>dataVersion</code>ç»“ç‚¹æ•°æ®çš„æ›´æ”¹æ¬¡æ•°</li> <li><code>aclVersion</code>ç»“ç‚¹çš„ACLæ›´æ”¹æ¬¡æ•°â€”â€”ç±»ä¼¼<code>linux</code>çš„æƒé™åˆ—è¡¨ï¼Œç»´æŠ¤çš„æ˜¯å½“å‰ç»“ç‚¹çš„æƒé™åˆ—è¡¨è¢«ä¿®æ”¹çš„æ¬¡æ•°</li> <li><code>ephemeralOwner</code>å¦‚æœç»“ç‚¹æ˜¯ä¸´æ—¶ç»“ç‚¹ï¼Œåˆ™è¡¨ç¤ºåˆ›å»ºè¯¥ç»“ç‚¹çš„ä¼šè¯çš„<code>SessionID</code>ï¼›å¦‚æœæ˜¯æŒä¹…ç»“ç‚¹ï¼Œè¯¥å±æ€§å€¼ä¸º0</li> <li><code>dataLength</code>æ•°æ®å†…å®¹çš„é•¿åº¦</li> <li><code>numChildren</code>æ•°æ®ç»“ç‚¹å½“å‰çš„å­ç»“ç‚¹ä¸ªæ•°</li></ul> <p><strong>ç»“ç‚¹ç±»å‹</strong></p> <p><code>zookeeper</code>ä¸­çš„ç»“ç‚¹æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«ä¸º<strong>ä¸´æ—¶ç»“ç‚¹</strong>å’Œ<strong>æ°¸ä¹…ç»“ç‚¹</strong>ã€‚ç»“ç‚¹çš„ç±»å‹åœ¨åˆ›å»ºæ—¶è¢«ç¡®å®šï¼Œå¹¶ä¸”ä¸èƒ½æ”¹å˜</p> <ul><li>ä¸´æ—¶èŠ‚ç‚¹ï¼š
<ul><li>è¯¥èŠ‚ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¾èµ–äºåˆ›å»ºå®ƒä»¬çš„ä¼šè¯ã€‚ä¸€æ—¦ä¼šè¯( <code>Session</code>ï¼‰ç»“æŸï¼Œä¸´æ—¶èŠ‚ç‚¹å°†è¢«è‡ªåŠ¨åˆ é™¤ï¼Œå½“ç„¶å¯ä»¥ä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ é™¤ã€‚è™½ç„¶æ¯ä¸ªä¸´æ—¶çš„ <code>Znode</code>éƒ½ä¼šç»‘å®šåˆ°ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯ï¼Œä½†ä»–ä»¬å¯¹æ‰€æœ‰çš„å®¢æˆ·ç«¯è¿˜æ˜¯å¯è§çš„ã€‚å¦å¤–ï¼Œ<code>Zookeeper</code>çš„ä¸´æ—¶èŠ‚ç‚¹ä¸å…è®¸æ‹¥æœ‰å­èŠ‚ç‚¹</li></ul></li> <li>æŒä¹…åŒ–ç»“ç‚¹ï¼š
<ul><li>è¯¥ç»“ç‚¹çš„ç”Ÿå‘½å‘¨æœŸä¸ä¾èµ–äºä¼šè¯ï¼Œå¹¶ä¸”åªæœ‰åœ¨å®¢æˆ·ç«¯æ˜¾ç¤ºæ‰§è¡Œåˆ é™¤æ“ä½œçš„æ—¶å€™ï¼Œå®ƒä»¬æ‰èƒ½è¢«åˆ é™¤</li></ul></li></ul> <h4 id="å•æœºå®‰è£…"><a href="#å•æœºå®‰è£…" class="header-anchor">#</a> å•æœºå®‰è£…</h4> <p>æµ‹è¯•ç³»ç»Ÿç¯å¢ƒ<code>centos7.3</code></p> <p><code>zookeeper:zookeeper-3.4.10.tar.gz</code></p> <p><code>jdk:jdk-8u131-linux-x64.tar.gz</code></p> <p><a href="http://archive.apache.org/dist/zookeeper/" target="_blank" rel="noopener noreferrer">http://archive.apache.org/dist/zookeeper/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ol><li><p>åœ¨<code>centos</code>ä¸­ä½¿ç”¨ <code>root</code>ç”¨æˆ·åˆ›å»º <code>zookeeper</code>ç”¨æˆ·ï¼Œç”¨æˆ·å:<code>zookeeper</code>å¯†ç :<code>zookeeper</code></p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">useradd</span> zookeeper
<span class="token function">passwd</span> zookeeper
<span class="token function">su</span> zookeeper
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p><code>zookeeper</code>åº•å±‚ä¾èµ–äºjdkï¼Œ<code>zookeeper</code>ç”¨æˆ·ç™»å½•åï¼Œæ ¹ç›®å½•ä¸‹å…ˆè¿›è¡Œjdk çš„å®‰è£…ï¼Œjdkä½¿ç”¨ <code>jdk-8u131-linux-x64.tar.gz</code></p> <ul><li><div class="language- line-numbers-mode"><pre class="language-text"><code>tar -zxf tar.gz
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>é…ç½®jdk ç¯å¢ƒå˜é‡</p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">vi</span> /etc/profile
<span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/home/zookeeper/jdk1.8.0_131
<span class="token builtin class-name">export</span> JAVA_HOME

<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
<span class="token builtin class-name">export</span> <span class="token environment constant">PATH</span>

souce /etc/profile
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul></li> <li><p>æ£€æµ‹jdkå®‰è£…</p> <ul><li><code>java -version</code> // å¦‚æœåé¦ˆäº†Javaä¿¡æ¯ï¼Œåˆ™æˆåŠŸ</li></ul></li> <li><p><code>zookeeper</code> ä¸Šä¼ è§£å‹</p> <ul><li><code>tar -zxf tar.gz</code></li></ul></li> <li><p>ä¸º<code>zookeeper</code>å‡†å¤‡é…ç½®æ–‡ä»¶</p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># è¿›å…¥confç›®å½•</span>
<span class="token builtin class-name">cd</span> /home/zookeeper/zookeeper-3.4.10/conf
<span class="token comment"># å¤åˆ¶é…ç½®æ–‡ä»¶</span>
<span class="token function">cp</span> zoo_sampe.cfg zoo.cfg
<span class="token comment"># zookeeper æ ¹ç›®å½•ä¸‹åˆ›å»ºdataç›®å½•</span>
<span class="token function">mkdir</span> data
<span class="token comment"># vi é…ç½®æ–‡ä»¶ä¸­çš„dataDir</span>
<span class="token comment"># æ­¤è·¯å¾„ç”¨äºå­˜å‚¨zookeeperä¸­æ•°æ®çš„å†…å­˜å¿«ç…§ã€åŠäº‹åŠ¡æ—¥å¿—æ–‡ä»¶ï¼Œè™½ç„¶zookeeperæ˜¯ä½¿ç”¨å†…å­˜çš„ï¼Œä½†æ˜¯éœ€è¦æŒä¹…åŒ–ä¸€äº›æ•°æ®æ¥ä¿è¯æ•°æ®çš„å®‰å…¨ï¼Œå’Œredisä¸€æ ·</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/home/zookeeper/zookeeper-3.4.10/data
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></li> <li><p>å¯åŠ¨<code>zookeeper</code></p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># è¿›å…¥zookeeperçš„binç›®å½•</span>
<span class="token builtin class-name">cd</span> /home/zookeeper/zookeeper-3.4.10/bin
<span class="token comment"># å¯åŠ¨zookeeper</span>
./zkServer.sh start

<span class="token comment"># å¯åŠ¨: zkServer.sh start</span>
<span class="token comment"># åœæ­¢: zkServer.sh stop</span>
<span class="token comment"># æŸ¥çœ‹çŠ¶æ€ï¼šzkServer.sh status</span>

<span class="token comment"># è¿›å…¥zookeeper å†…éƒ¨</span>
./zkCli.sh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ul></li></ol> <h2 id="å¸¸ç”¨shellå‘½ä»¤"><a href="#å¸¸ç”¨shellå‘½ä»¤" class="header-anchor">#</a> å¸¸ç”¨shellå‘½ä»¤</h2> <p><code>zookeeper</code>â€”â€”<code>getting started</code>â€”â€”<a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperStarted.html#sc_FileManagement" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperStarted.html#sc_FileManagement<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h5 id="æŸ¥è¯¢"><a href="#æŸ¥è¯¢" class="header-anchor">#</a> <strong>æŸ¥è¯¢</strong></h5> <p><code>get /hadoop</code>  æŸ¥çœ‹ç»“ç‚¹çš„æ•°æ®å’Œå±æ€§     <code>stat /hadoop</code> æŸ¥çœ‹ç»“ç‚¹çš„å±æ€§</p> <h5 id="åˆ›å»º"><a href="#åˆ›å»º" class="header-anchor">#</a> <strong>åˆ›å»º</strong></h5> <p>åˆ›å»ºç»“ç‚¹å¹¶å†™å…¥æ•°æ®ï¼š</p> <p><code>create [-s] [-e] path data</code> # å…¶ä¸­ -s ä¸ºæœ‰åºç»“ç‚¹ï¼Œ-e ä¸´æ—¶ç»“ç‚¹ï¼ˆé»˜è®¤æ˜¯æŒä¹…ç»“ç‚¹ï¼‰</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>create /hadoop <span class="token string">&quot;123456&quot;</span>  <span class="token comment"># æ­¤æ—¶ï¼Œå¦‚æœquité€€å‡ºåå†./ZkCient.sh ç™»å…¥</span>
                         <span class="token comment"># å†ç”¨è¾“å…¥ get /hadoop è·å–ï¼Œç»“ç‚¹ä¾ç„¶å­˜åœ¨(æ°¸ä¹…ç»“ç‚¹)</span>
				       
create <span class="token parameter variable">-s</span> /a <span class="token string">&quot;a&quot;</span>         <span class="token comment"># åˆ›å»ºä¸€ä¸ªæŒä¹…åŒ–æœ‰åºç»“ç‚¹ï¼Œåˆ›å»ºçš„æ—¶å€™å¯ä»¥è§‚å¯Ÿåˆ°è¿”å›çš„æ•°æ®å¸¦ä¸Šäº†ä¸€ä¸ªid       </span>
create <span class="token parameter variable">-s</span> /b <span class="token string">&quot;b&quot;</span>         <span class="token comment"># è¿”å›çš„å€¼ï¼Œidé€’å¢äº†</span>

create <span class="token parameter variable">-s</span> <span class="token parameter variable">-e</span> /aa <span class="token string">&quot;aa&quot;</span>    <span class="token comment"># ä¾ç„¶è¿˜ä¼šè¿”å›è‡ªå¢çš„idï¼Œquitåå†è¿›æ¥ï¼Œç»§ç»­åˆ›å»ºï¼Œidä¾ç„¶æ˜¯å¾€åæ¨çš„</span>

create /aa/xx            <span class="token comment"># ç»§ç»­åˆ›å»ºç»“ç‚¹ï¼Œå¯ä»¥çœ‹åˆ°pZxidå˜åŒ–äº†</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h5 id="æ›´æ–°"><a href="#æ›´æ–°" class="header-anchor">#</a> <strong>æ›´æ–°</strong></h5> <p>æ›´æ–°ç»“ç‚¹çš„å‘½ä»¤æ˜¯<code>set</code>ï¼Œå¯ä»¥ç›´æ¥è¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š</p> <p><code>set path [version]</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">set</span> /hadoop <span class="token string">&quot;345&quot;</span>        <span class="token comment"># ä¿®æ”¹ç»“ç‚¹å€¼</span>

<span class="token builtin class-name">set</span> /hadoop <span class="token string">&quot;hadoop-x&quot;</span> <span class="token number">1</span> <span class="token comment"># ä¹Ÿå¯ä»¥åŸºäºç‰ˆæœ¬å·è¿›è¡Œæ›´æ”¹ï¼Œç±»ä¼¼äºä¹è§‚é”ï¼Œå½“ä¼ å…¥ç‰ˆæœ¬å·(dataVersion)</span>
                         <span class="token comment"># å’Œå½“å‰ç»“ç‚¹çš„æ•°æ®ç‰ˆæœ¬å·ä¸ä¸€è‡´æ—¶ï¼Œzookeeperä¼šæ‹’ç»æœ¬æ¬¡ä¿®æ”¹</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h5 id="åˆ é™¤"><a href="#åˆ é™¤" class="header-anchor">#</a> <strong>åˆ é™¤</strong></h5> <p>åˆ é™¤ç»“ç‚¹çš„è¯­æ³•å¦‚ä¸‹ï¼š</p> <p><code>delete path [version]</code> å’Œ <code>set</code> æ–¹æ³•ç›¸ä¼¼ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ç‰ˆæœ¬å·</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>delete /hadoop           <span class="token comment"># åˆ é™¤ç»“ç‚¹</span>
delete /hadoop <span class="token number">1</span>         <span class="token comment"># ä¹è§‚é”æœºåˆ¶ï¼Œä¸set æ–¹æ³•ä¸€è‡´</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>è¦æƒ³åˆ é™¤æŸä¸ªç»“ç‚¹åŠå…¶æ‰€æœ‰åä»£ç»“ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨é€’å½’åˆ é™¤ï¼Œå‘½ä»¤ä¸º <code>rmr path</code></p> <p><strong>æŸ¥çœ‹ç»“ç‚¹åˆ—è¡¨</strong></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ls</span> /hadoop               <span class="token comment"># å¯ä»¥æŸ¥çœ‹ç»“ç‚¹çš„åˆ—è¡¨</span>
ls2 /hadoop              <span class="token comment"># å¯ä»¥æŸ¥çœ‹ç»“ç‚¹çš„åˆ—è¡¨ä»¥åŠç›®æ ‡ç»“ç‚¹çš„ä¿¡æ¯</span>

<span class="token function">ls</span> /                     <span class="token comment"># æ ¹èŠ‚ç‚¹</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p><strong>ç›‘å¬å™¨get path [watch] | stat path [watch]</strong></p> <p>ä½¿ç”¨<code>get path [watch]</code> æ³¨å†Œçš„ç›‘å¬å™¨èƒ½å¤Ÿåœ¨ç»“ç‚¹<strong>å†…å®¹å‘ç”Ÿæ”¹å˜</strong>çš„æ—¶å€™ï¼Œå‘å®¢æˆ·ç«¯å‘å‡ºé€šçŸ¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯<code>zookeeper</code>çš„è§¦å‘å™¨æ˜¯ä¸€æ¬¡æ€§çš„(<code>One-time trigger</code>)ï¼Œå³è§¦å‘ä¸€æ¬¡åå°±ä¼šç«‹å³å¤±æ•ˆ</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>get /hadoop <span class="token function">watch</span>        <span class="token comment"># get çš„æ—¶å€™æ·»åŠ ç›‘å¬å™¨ï¼Œå½“å€¼æ”¹å˜çš„æ—¶å€™ï¼Œç›‘å¬å™¨è¿”å›æ¶ˆæ¯</span>
<span class="token builtin class-name">set</span> /hadoop <span class="token number">45678</span>        <span class="token comment"># æµ‹è¯•</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><strong>ls\ls2 path [watch]</strong></p> <p>ä½¿ç”¨ <code>ls path [watch] æˆ– ls2 path [watch]</code>æ³¨å†Œçš„ç›‘å¬å™¨èƒ½å¤Ÿç›‘å¬è¯¥ç»“ç‚¹ä¸‹<strong>æ‰€æœ‰å­èŠ‚ç‚¹</strong>çš„<strong>å¢åŠ </strong>å’Œ<strong>åˆ é™¤</strong>æ“ä½œ</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">ls</span> /hadoop <span class="token function">watch</span>         <span class="token comment"># æ·»åŠ ç›‘å¬å™¨</span>
<span class="token builtin class-name">set</span> /hadoop/node <span class="token string">&quot;node&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="zookeeperçš„aclæƒé™æ§åˆ¶"><a href="#zookeeperçš„aclæƒé™æ§åˆ¶" class="header-anchor">#</a> zookeeperçš„Aclæƒé™æ§åˆ¶</h2> <p><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_ZooKeeperAccessControl" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_ZooKeeperAccessControl<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><code>zookeeper</code>ç±»ä¼¼æ–‡ä»¶ç³»ç»Ÿï¼Œ<code>client</code>å¯ä»¥åˆ›å»ºç»“ç‚¹ã€æ›´æ–°ç»“ç‚¹ã€åˆ é™¤ç»“ç‚¹ï¼Œé‚£ä¹ˆå¦‚ä½•åšåˆ°ç»“ç‚¹çš„æƒé™æ§åˆ¶å‘¢ï¼Ÿ</p> <p><code>zookeeper</code>çš„ <code>access control list</code> è®¿é—®æ§åˆ¶åˆ—è¡¨å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹</p> <p><code>acl</code>æƒé™æ§åˆ¶ï¼Œä½¿ç”¨<code>schemeï¼šidï¼špermission</code>æ¥æ ‡è¯†ï¼Œä¸»è¦æ¶µç›–3ä¸ªæ–¹é¢ï¼š</p> <p><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_BuiltinACLSchemes" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_BuiltinACLSchemes<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>æƒé™æ¨¡å¼(<code>scheme</code>)ï¼šæˆæƒçš„ç­–ç•¥</li> <li>æˆæƒå¯¹è±¡(<code>id</code>)ï¼šæˆæƒçš„å¯¹è±¡</li> <li>æƒé™(<code>permission</code>)ï¼šæˆäºˆçš„æƒé™</li></ul> <p>å…¶ç‰¹æ€§å¦‚ä¸‹ï¼š</p> <ul><li><p><code>zookeeper</code>çš„æƒé™æ§åˆ¶æ˜¯åŸºäºæ¯ä¸ª<code>znode</code>ç»“ç‚¹çš„ï¼Œéœ€è¦å¯¹æ¯ä¸ªç»“ç‚¹è®¾ç½®æƒé™</p></li> <li><p>æ¯ä¸ª<code>znode</code>æ”¯æŒå¤šç§æƒé™æ§åˆ¶æ–¹æ¡ˆå’Œå¤šä¸ªæƒé™</p></li> <li><p>å­ç»“ç‚¹ä¸ä¼šç»§æ‰¿çˆ¶ç»“ç‚¹çš„æƒé™ï¼Œå®¢æˆ·ç«¯æ— æƒè®¿é—®æŸç»“ç‚¹ï¼Œä½†å¯èƒ½å¯ä»¥è®¿é—®å®ƒçš„å­ç»“ç‚¹ï¼š</p> <p>ä¾‹å¦‚<code>setAcl /test2 ip:192.168.133.133:crwda</code>  // å°†ç»“ç‚¹æƒé™è®¾ç½®ä¸ºIpï¼š192.168.133.133 çš„å®¢æˆ·ç«¯å¯ä»¥å¯¹èŠ‚ç‚¹è¿›è¡Œ
å¢åˆ æ”¹æŸ¥å’Œç®¡ç†æƒé™</p></li></ul> <p><strong>æƒé™æ¨¡å¼</strong></p> <ul><li><p>é‡‡ç”¨ä½•ç§æ–¹å¼æˆæƒ</p></li> <li></li> <li><table><thead><tr><th>æ–¹æ¡ˆ</th> <th>æè¿°</th></tr></thead> <tbody><tr><td>world</td> <td>åªæœ‰ä¸€ä¸ªç”¨æˆ·ï¼š<code>anyone</code>ï¼Œä»£è¡¨ç™»å½•<code>zookeeper</code>æ‰€æœ‰äºº(é»˜è®¤)</td></tr> <tr><td>ip</td> <td>å¯¹å®¢æˆ·ç«¯ä½¿ç”¨IPåœ°å€è®¤è¯</td></tr> <tr><td>auth</td> <td>ä½¿ç”¨å·²æ·»åŠ è®¤è¯çš„ç”¨æˆ·è®¤è¯</td></tr> <tr><td>digest</td> <td>ä½¿ç”¨&quot;ç”¨æˆ·åï¼šå¯†ç &quot;æ–¹å¼è®¤è¯</td></tr></tbody></table></li></ul> <p><strong>æˆæƒå¯¹è±¡</strong></p> <ul><li>ç»™è°æˆäºˆæƒé™</li> <li>æˆæƒå¯¹è±¡IDæ˜¯æŒ‡ï¼Œæƒé™èµ‹äºˆçš„å®ä½“ï¼Œä¾‹å¦‚ï¼šIPåœ°å€æˆ–ç”¨æˆ·</li></ul> <p><strong>æˆæƒçš„æƒé™</strong></p> <ul><li><p>æˆäºˆä»€ä¹ˆæƒé™</p></li> <li><p><code>createã€deleteã€readã€writerã€admin</code>ä¹Ÿå°±æ˜¯ å¢ã€åˆ ã€æŸ¥ã€æ”¹ã€ç®¡ç†æƒé™ï¼Œè¿™5ç§æƒé™ç®€å†™ä¸º c d r w aï¼Œæ³¨æ„ï¼š
è¿™äº”ç§æƒé™ä¸­ï¼Œæœ‰çš„æƒé™å¹¶ä¸æ˜¯å¯¹ç»“ç‚¹è‡ªèº«æ“ä½œçš„ä¾‹å¦‚ï¼šdeleteæ˜¯æŒ‡å¯¹<strong>å­ç»“ç‚¹</strong>çš„åˆ é™¤æƒé™</p> <p>å¯ä»¥è¯•å›¾åˆ é™¤çˆ¶ç»“ç‚¹ï¼Œä½†æ˜¯å­ç»“ç‚¹å¿…é¡»åˆ é™¤å¹²å‡€ï¼Œæ‰€ä»¥<code>delete</code>çš„æƒé™ä¹Ÿæ˜¯å¾ˆæœ‰ç”¨çš„</p></li> <li></li> <li><table><thead><tr><th>æƒé™</th> <th>ACLç®€å†™</th> <th>æè¿°</th></tr></thead> <tbody><tr><td>create</td> <td>c</td> <td>å¯ä»¥åˆ›å»ºå­ç»“ç‚¹</td></tr> <tr><td>delete</td> <td>d</td> <td>å¯ä»¥åˆ é™¤å­ç»“ç‚¹(ä»…ä¸‹ä¸€çº§ç»“ç‚¹)</td></tr> <tr><td>read</td> <td>r</td> <td>å¯ä»¥è¯»å–ç»“ç‚¹æ•°æ®ä»¥åŠæ˜¾ç¤ºå­ç»“ç‚¹åˆ—è¡¨</td></tr> <tr><td>write</td> <td>w</td> <td>å¯ä»¥è®¾ç½®ç»“ç‚¹æ•°æ®</td></tr> <tr><td>admin</td> <td>a</td> <td>å¯ä»¥è®¾ç½®ç»“ç‚¹è®¿é—®æ§åˆ¶æƒé™åˆ—è¡¨</td></tr></tbody></table></li></ul> <p><strong>æˆæƒçš„ç›¸å…³å‘½ä»¤</strong></p> <ul><li></li> <li><table><thead><tr><th>å‘½ä»¤</th> <th>ä½¿ç”¨æ–¹å¼</th> <th>æè¿°</th></tr></thead> <tbody><tr><td>getAcl</td> <td>getAcl</td> <td>è¯»å–ACLæƒé™</td></tr> <tr><td>setAcl</td> <td>setAcl</td> <td>è®¾ç½®ACLæƒé™</td></tr> <tr><td>addauth</td> <td>addauth</td> <td>æ·»åŠ è®¤è¯ç”¨æˆ·</td></tr></tbody></table></li></ul> <h4 id="æ¡ˆä¾‹-è¿œç¨‹ç™»å½•"><a href="#æ¡ˆä¾‹-è¿œç¨‹ç™»å½•" class="header-anchor">#</a> æ¡ˆä¾‹/è¿œç¨‹ç™»å½•</h4> <p><strong><code>./zkServer.sh -server 192.168.133.133</code></strong> å¯ä»¥è¿œç¨‹ç™»å½•</p> <p><strong>worldæƒé™æ¨¡å¼</strong></p> <ul><li><code>getAcl /node</code> // è¯»å–æƒé™ä¿¡æ¯</li> <li><code>setAcl /node world:anyone:drwa</code> // è®¾ç½®æƒé™(ç¦ç”¨åˆ›å»ºå­ç»“ç‚¹çš„æƒé™)</li></ul> <p><strong>ipæ¨¡å¼</strong></p> <p><code>./zkServer.sh -server 192.168.133.133</code> å¯ä»¥è¿œç¨‹ç™»å½•</p> <ul><li><code>setAcl /hadoop ip:192.168.133.133:drwa</code></li> <li>å¦‚æœåœ¨ä¸¤å°ä¸åŒçš„è™šæ‹Ÿæœºä¸­ï¼Œå¦ä¸€å°ç”¨è¿œç¨‹è¿æ¥çš„æ¨¡å¼ï¼Œè¿›è¡Œä¸Šé¢è¿™æ¡å‘½ä»¤ï¼Œé‚£ä¹ˆåªä¼šæœ‰ä¸€å°è¢«æˆæƒ</li> <li>éœ€è¦ä¸¤å°è™šæ‹Ÿæœºä¸€èµ·æˆæƒçš„è¯éœ€è¦ç”¨<strong>é€—å·</strong>å°†æˆæƒåˆ—è¡¨éš”å¼€ï¼š<code>setAcl /hadoop ip:192.168.133.133:cdrwa,ip:192.168.133.132:cdrwa</code></li></ul> <p><strong>authè®¤è¯ç”¨æˆ·æ¨¡å¼</strong></p> <p><strong><code>addauth digest &lt;user&gt;:&lt;password&gt;</code></strong></p> <p><strong><code>setAcl &lt;path&gt; auth:&lt;user&gt;:&lt;acl&gt;</code></strong></p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code>create /hadoop <span class="token string">&quot;hadoop&quot;</span>           <span class="token comment"># åˆå§‹åŒ–æµ‹è¯•ç”¨çš„ç»“ç‚¹</span>
addauth digest itcast:123456      <span class="token comment"># æ·»åŠ è®¤è¯ç”¨æˆ·</span>
setAcl /hadoop auth:itcast:cdrwa  <span class="token comment"># è®¾ç½®è®¤è¯ç”¨æˆ·</span>
quit                              <span class="token comment"># é€€å‡ºåå†./zkCli.sh è¿›å…¥</span>
get /hadoop                       <span class="token comment"># è¿™ä¸ªæ—¶å€™å°±æ²¡æœ‰æƒé™äº†ï¼Œéœ€è¦å†æ¬¡è®¤è¯</span>
addauth digest itcast:123456      <span class="token comment"># è®¤è¯ï¼Œå¯†ç é”™äº†çš„è¯ zookeeper ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ä¸èƒ½è®¤è¯</span>
get /hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <p><strong>Digestæˆæƒæ¨¡å¼</strong></p> <p><strong><code>setAcl &lt;path&gt; digest:&lt;user&gt;:&lt;password&gt;:&lt;acl&gt;</code></strong></p> <ul><li><p>è¿™é‡Œçš„å¯†ç æ˜¯ç»è¿‡<code>SHA1</code>ä»¥åŠ<code>BASE64</code>å¤„ç†çš„å¯†æ–‡ï¼Œåœ¨shell ä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤è®¡ç®—ï¼š</p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token operator">&lt;</span>user<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token operator">|</span> openssl dgst <span class="token parameter variable">-binary</span> <span class="token parameter variable">-sha1</span> <span class="token operator">|</span> openssl base64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># è®¡ç®—å¯†ç </span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> itcast:12345 <span class="token operator">|</span> openssl dgst <span class="token parameter variable">-binary</span> <span class="token parameter variable">-sha1</span> <span class="token operator">|</span> openssl base64
<span class="token comment"># è·å–å¯†ç ï¼Œè®¾ç½®æƒé™åˆ—è¡¨</span>
setAcl /hadoop digest:itcast:qUFSHxJjItUW/93UHFXFVGlvryY<span class="token operator">=</span>:cdrwa
<span class="token comment"># ç°åœ¨æƒ³è¦get /hadoop éœ€è¦ç™»å½•äº†</span>
addauth digest itcast:12345
get /hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul></li></ul> <p><strong>å¤šç§æˆæƒæ¨¡å¼</strong></p> <p>ä»…éœ€é€—å·éš”å¼€</p> <ul><li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code> setAcl /hadoop ip:192.168.133.132:cdrwa,auth:hadoop:cdrwa,digest:itcast:673OfZhUE8JEFMcu0l64qI8e5ek<span class="token operator">=</span>:cdrwa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul> <h4 id="acl-è¶…çº§ç®¡ç†å‘˜"><a href="#acl-è¶…çº§ç®¡ç†å‘˜" class="header-anchor">#</a> acl è¶…çº§ç®¡ç†å‘˜</h4> <ul><li><p><code>zookeeper</code>çš„æƒé™ç®¡ç†æ¨¡å¼æœ‰ä¸€ç§å«åš<code>super</code>ï¼Œè¯¥æ¨¡å¼æä¾›ä¸€ä¸ªè¶…ç®¡ï¼Œå¯ä»¥æ–¹ä¾¿çš„è®¿é—®ä»»ä½•æƒé™çš„èŠ‚ç‚¹</p> <p>å‡è®¾è¿™ä¸ªè¶…ç®¡æ˜¯<code>supper:admin</code>ï¼Œéœ€è¦ä¸ºè¶…ç®¡ç”Ÿäº§å¯†ç çš„å¯†æ–‡</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> super:admin <span class="token operator">|</span> openssl dgst <span class="token parameter variable">-binary</span> <span class="token parameter variable">-sha1</span> <span class="token operator">|</span> openssl base64
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>é‚£ä¹ˆæ‰“å¼€<code>zookeeper</code>ç›®å½•ä¸‹<code>/bin/zkServer.sh</code>æœåŠ¡å™¨è„šæœ¬æ–‡ä»¶ï¼Œæ‰¾åˆ°å¦‚ä¸‹ä¸€è¡Œï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code> /nohup <span class="token comment"># å¿«é€ŸæŸ¥æ‰¾ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹</span>
 <span class="token function">nohup</span> <span class="token string">&quot;<span class="token variable">$JAVA</span>&quot;</span> <span class="token string">&quot;-Dzookeeper.log.dir=<span class="token variable">${ZOO_LOG_DIR}</span>&quot;</span> <span class="token string">&quot;-Dzookeeper.root.logger=<span class="token variable">${ZOO_LOG4J_PROP}</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>è¿™ä¸ªå°±ç®—è„šæœ¬ä¸­å¯åŠ¨<code>zookeeper</code>çš„å‘½ä»¤ï¼Œé»˜è®¤åªæœ‰ä»¥ä¸Šä¸¤ä¸ªé…ç½®é¡¹ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªè¶…ç®¡çš„é…ç½®é¡¹</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>&quot;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:xQJmxLMiHGwaqBvst5y6rkB6HQs=&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>ä¿®æ”¹åå‘½ä»¤å˜æˆå¦‚ä¸‹</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">nohup</span> <span class="token string">&quot;<span class="token variable">$JAVA</span>&quot;</span> <span class="token string">&quot;-Dzookeeper.log.dir=<span class="token variable">${ZOO_LOG_DIR}</span>&quot;</span> <span class="token string">&quot;-Dzookeeper.root.logger=<span class="token variable">${ZOO_LOG4J_PROP}</span>&quot;</span> <span class="token string">&quot;-Dzookeeper.DigestAuthenticationProvider.superDigest=super:xQJmxLMiHGwaqBvst5y6rkB6HQs=&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># é‡èµ·åï¼Œç°åœ¨éšä¾¿å¯¹ä»»æ„èŠ‚ç‚¹æ·»åŠ æƒé™é™åˆ¶</span>
setAcl /hadoop ip:192.168.1.1:cdrwa <span class="token comment"># è¿™ä¸ªipå¹¶éæœ¬æœº</span>
<span class="token comment"># ç°åœ¨å½“å‰ç”¨æˆ·æ²¡æœ‰æƒé™äº†</span>
getAcl /hadoop
<span class="token comment"># ç™»å½•è¶…ç®¡</span>
addauth digest super:admin
<span class="token comment"># å¼ºè¡Œæ“ä½œèŠ‚ç‚¹</span>
get /hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li></ul> <h2 id="zookeeperçš„-javaapi"><a href="#zookeeperçš„-javaapi" class="header-anchor">#</a> zookeeperçš„ JavaAPI</h2> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.101tec<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zkclient<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.9<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusions</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclusion</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusion</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclusions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p><code>zonde</code>æ˜¯ <code>zookeeper</code>é›†åˆçš„æ ¸å¿ƒç»„ä»¶ï¼Œ<code>zookeeper API</code> æä¾›äº†ä¸€å°ç»„ä½¿ç”¨ <code>zookeeper</code>é›†ç¾¤æ¥æ“ä½œ<code>znode</code>çš„æ‰€æœ‰ç»†èŠ‚</p> <p>å®¢æˆ·ç«¯åº”è¯¥éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼Œä¸<code>zookeeper</code>æœåŠ¡å™¨è¿›è¡Œæ¸…æ™°å’Œå¹²å‡€çš„äº¤äº’</p> <ul><li>è¿æ¥åˆ°<code>zookeeper</code>æœåŠ¡å™¨ã€‚<code>zookeeper</code>æœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯åˆ†é…ä¼šè¯<code>ID</code></li> <li>å®šæœŸå‘æœåŠ¡å™¨å‘é€å¿ƒè·³ã€‚å¦åˆ™ï¼Œ<code>zookeeper</code>æœåŠ¡å™¨å°†è¿‡æœŸä¼šè¯<code>ID</code>ï¼Œå®¢æˆ·ç«¯éœ€è¦é‡æ–°è¿æ¥</li> <li>åªè¦ä¼šè¯<code>Id</code>å¤„äºæ´»åŠ¨çŠ¶æ€ï¼Œå°±å¯ä»¥è·å–/è®¾ç½®<code>znode</code></li> <li>æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼Œæ–­å¼€ä¸<code>zookeeper</code>æœåŠ¡å™¨è¿æ¥ï¼Œå¦‚æœå®¢æˆ·ç«¯é•¿æ—¶é—´ä¸æ´»åŠ¨ï¼Œåˆ™<code>zookeeper</code>æœåŠ¡å™¨å°†è‡ªåŠ¨æ–­å¼€å®¢æˆ·ç«¯</li></ul> <h4 id="è¿æ¥åˆ°zookeeper"><a href="#è¿æ¥åˆ°zookeeper" class="header-anchor">#</a> è¿æ¥åˆ°Zookeeper</h4> <p>è¿™éƒ¨åˆ†ï¼Œå®˜ç½‘çš„è§£é‡Šååˆ†ç¨€å°‘<a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperStarted.html#sc_ConnectingToZooKeeper" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperStarted.html#sc_ConnectingToZooKeeper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[zkshell: 0] help
ZooKeeper host:port cmd args
    get path [watch]
    ls path [watch]
    set path data [version]
    delquota [-n|-b] path
    quit
    printwatches on|off
    create path data acl
    stat path [watch]
    listquota path
    history
    setAcl path acl
    getAcl path
    sync path
    redo cmdno
    addauth scheme auth
    delete path [version]
    deleteall path
    setquota -n|-b val path
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token class-name">Zookeeper</span><span class="token punctuation">(</span><span class="token class-name">String</span> connectionString<span class="token punctuation">,</span> <span class="token keyword">int</span> sessionTimeout<span class="token punctuation">,</span> watcher watcher<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>connectionString</code> - <code>zookeeper</code>ä¸»æœº</li> <li><code>sessionTimeout</code>- ä¼šè¯è¶…æ—¶</li> <li><code>watcher</code> - å®ç°&quot;ç›‘å¬å™¨&quot; å¯¹è±¡ã€‚<code>zookeeper</code>é›†åˆé€šè¿‡ç›‘è§†å™¨å¯¹è±¡è¿”å›è¿æ¥çŠ¶æ€</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span><span class="token punctuation">,</span> <span class="token class-name">InterruptedException</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ZooKeeper</span> zookeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181&quot;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> x<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Watcher<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>SyncConnected</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>zookeeper<span class="token punctuation">.</span><span class="token function">getSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="æ–°å¢èŠ‚ç‚¹"><a href="#æ–°å¢èŠ‚ç‚¹" class="header-anchor">#</a> æ–°å¢èŠ‚ç‚¹</h4> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åŒæ­¥</span>
<span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> acl<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span> createMode<span class="token punctuation">)</span>
<span class="token comment">// å¼‚æ­¥</span>
<span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> acl<span class="token punctuation">,</span> <span class="token class-name">CreateMode</span> createMode<span class="token punctuation">,</span>
      <span class="token class-name">AsynCallback<span class="token punctuation">.</span>StringCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li></li> <li><table><thead><tr><th>å‚æ•°</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><code>path</code></td> <td><code>znode</code>è·¯å¾„</td></tr> <tr><td><code>data</code></td> <td>æ•°æ®</td></tr> <tr><td><code>acl</code></td> <td>è¦åˆ›å»ºçš„èŠ‚ç‚¹çš„è®¿é—®æ§åˆ¶åˆ—è¡¨ã€‚<code>zookeeper API</code>æä¾›äº†ä¸€ä¸ªé™æ€æ¥å£ <code>ZooDefs.Ids</code> æ¥è·å–ä¸€äº›åŸºæœ¬çš„<code>acl</code>åˆ—è¡¨ã€‚ä¾‹å¦‚ï¼Œ<code>ZooDefs.Ids.OPEN_ACL_UNSAFE</code>è¿”å›æ‰“å¼€<code>znode</code>çš„<code>acl</code>åˆ—è¡¨</td></tr> <tr><td><code>createMode</code></td> <td>èŠ‚ç‚¹çš„ç±»å‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæšä¸¾</td></tr> <tr><td><code>callBack</code></td> <td>å¼‚æ­¥å›è°ƒæ¥å£</td></tr> <tr><td><code>ctx</code></td> <td>ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</td></tr></tbody></table></li></ul> <p>ç¤ºä¾‹ï¼š</p> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// æšä¸¾çš„æ–¹å¼</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTest1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> s <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/node&quot;</span><span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">READ_ACL_UNSAFE</span><span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// è‡ªå®šä¹‰çš„æ–¹å¼</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTest2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> acls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Id</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;ip&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;192.168.133.133&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        acls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Perms</span><span class="token punctuation">.</span><span class="token constant">ALL</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/create/node4&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node4&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>acls<span class="token punctuation">,</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// auth</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTest3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">addAuthInfo</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;itcast:12345&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/node5&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node5&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">CREATOR_ALL_ACL</span><span class="token punctuation">,</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">// è‡ªå®šä¹‰çš„æ–¹å¼</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTest3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
<span class="token comment">//        zookeeper.addAuthInfo(&quot;digest&quot;,&quot;itcast:12345&quot;.getBytes());</span>
<span class="token comment">//        zookeeper.create(&quot;/node5&quot;,&quot;node5&quot;.getBytes(),</span>
<span class="token comment">//                ZooDefs.Ids.CREATOR_ALL_ACL,CreateMode.PERSISTENT);</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">addAuthInfo</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;itcast:12345&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> acls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Id</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;auth&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;itcast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        acls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Perms</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/create/node6&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node6&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                acls<span class="token punctuation">,</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// digest </span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTest3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> acls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Id</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;digest&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;itcast:qUFSHxJjItUW/93UHFXFVGlvryY=&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    acls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Perms</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/create/node7&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node7&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 	
                     acls<span class="token punctuation">,</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// å¼‚æ­¥</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">createTest4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/node12&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;node12&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>StringCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">/**
             * @param rc çŠ¶æ€ï¼Œ0 åˆ™ä¸ºæˆåŠŸï¼Œä»¥ä¸‹çš„æ‰€æœ‰ç¤ºä¾‹éƒ½æ˜¯å¦‚æ­¤
             * @param path è·¯å¾„
             * @param ctx ä¸Šä¸‹æ–‡å‚æ•°
             * @param name è·¯å¾„
             */</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> rc<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">,</span> <span class="token class-name">String</span> name<span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rc <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> name <span class="token operator">+</span>  <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I am context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;ç»“æŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul> <h4 id="ä¿®æ”¹èŠ‚ç‚¹"><a href="#ä¿®æ”¹èŠ‚ç‚¹" class="header-anchor">#</a> ä¿®æ”¹èŠ‚ç‚¹</h4> <p>åŒæ ·ä¹Ÿæœ‰ä¸¤ç§ä¿®æ”¹æ–¹å¼(<code>å¼‚æ­¥å’ŒåŒæ­¥</code>)</p> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åŒæ­¥</span>
<span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">int</span> version<span class="token punctuation">)</span>
<span class="token comment">// å¼‚æ­¥</span>
<span class="token function">setData</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data<span class="token punctuation">,</span> <span class="token keyword">int</span> version<span class="token punctuation">,</span> <span class="token class-name">StatCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li></li> <li><table><thead><tr><th>å‚æ•°</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><code>path</code></td> <td>èŠ‚ç‚¹è·¯å¾„</td></tr> <tr><td><code>data</code></td> <td>æ•°æ®</td></tr> <tr><td><code>version</code></td> <td>æ•°æ®çš„ç‰ˆæœ¬å·ï¼Œ -<code>1</code>ä»£è¡¨ä¸ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œä¹è§‚é”æœºåˆ¶</td></tr> <tr><td><code>callBack</code></td> <td>å¼‚æ­¥å›è°ƒ <code>AsyncCallback.StatCallback</code>ï¼Œå’Œä¹‹å‰çš„å›è°ƒæ–¹æ³•å‚æ•°ä¸åŒï¼Œè¿™ä¸ªå¯ä»¥è·å–èŠ‚ç‚¹çŠ¶æ€</td></tr> <tr><td><code>ctx</code></td> <td>ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</td></tr></tbody></table></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setData1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    	<span class="token comment">// arg1:èŠ‚ç‚¹çš„è·¯å¾„</span>
        <span class="token comment">// arg2:ä¿®æ”¹çš„æ•°æ®</span>
        <span class="token comment">// arg3:æ•°æ®çš„ç‰ˆæœ¬å· -1 ä»£è¡¨ç‰ˆæœ¬å·ä¸å‚ä¸æ›´æ–°</span>
        <span class="token class-name">Stat</span> stat <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hadoop-1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setData2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;hadoop-1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span> <span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>StatCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> rc<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// è®²é“ç†ï¼Œè¦åˆ¤ç©º</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rc <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> stat<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span>  <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I am context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul> <h4 id="åˆ é™¤èŠ‚ç‚¹"><a href="#åˆ é™¤èŠ‚ç‚¹" class="header-anchor">#</a> åˆ é™¤èŠ‚ç‚¹</h4> <p>å¼‚æ­¥ã€åŒæ­¥</p> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åŒæ­¥</span>
<span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">int</span> version<span class="token punctuation">)</span>
<span class="token comment">// å¼‚æ­¥</span>
<span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">int</span> version<span class="token punctuation">,</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>VoidCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li></li> <li><table><thead><tr><th>å‚æ•°</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><code>path</code></td> <td>èŠ‚ç‚¹è·¯å¾„</td></tr> <tr><td><code>version</code></td> <td>ç‰ˆæœ¬</td></tr> <tr><td><code>callBack</code></td> <td>æ•°æ®çš„ç‰ˆæœ¬å·ï¼Œ -<code>1</code>ä»£è¡¨ä¸ä½¿ç”¨ç‰ˆæœ¬å·ï¼Œä¹è§‚é”æœºåˆ¶</td></tr> <tr><td><code>ctx</code></td> <td>ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</td></tr></tbody></table></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deleteData1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">deleteData2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>VoidCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> rc<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rc <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I am context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li></ul> <h4 id="æŸ¥çœ‹èŠ‚ç‚¹"><a href="#æŸ¥çœ‹èŠ‚ç‚¹" class="header-anchor">#</a> æŸ¥çœ‹èŠ‚ç‚¹</h4> <p>åŒæ­¥ã€å¼‚æ­¥</p> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åŒæ­¥</span>
<span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span>
<span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span>
<span class="token comment">// å¼‚æ­¥</span>
<span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">,</span> <span class="token class-name">DataCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
<span class="token function">getData</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">,</span> <span class="token class-name">DataCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li></li> <li><table><thead><tr><th>å‚æ•°</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><code>path</code></td> <td>èŠ‚ç‚¹è·¯å¾„</td></tr> <tr><td><code>boolean</code></td> <td>æ˜¯å¦ä½¿ç”¨è¿æ¥å¯¹è±¡ä¸­æ³¨å†Œçš„ç›‘å¬å™¨</td></tr> <tr><td><code>stat</code></td> <td>å…ƒæ•°æ®</td></tr> <tr><td><code>callBack</code></td> <td>å¼‚æ­¥å›è°ƒæ¥å£ï¼Œå¯ä»¥è·å¾—çŠ¶æ€å’Œæ•°æ®</td></tr> <tr><td><code>ctx</code></td> <td>ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</td></tr></tbody></table></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getData1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stat</span> stat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ¤ç©º</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">getCtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getData2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>DataCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> rc<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// åˆ¤ç©º</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rc <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> path
                                   <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> 
                                   stat<span class="token punctuation">.</span><span class="token function">getCzxid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I am context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div></li></ul> <h4 id="æŸ¥çœ‹å­èŠ‚ç‚¹"><a href="#æŸ¥çœ‹å­èŠ‚ç‚¹" class="header-anchor">#</a> æŸ¥çœ‹å­èŠ‚ç‚¹</h4> <p>åŒæ­¥ã€å¼‚æ­¥</p> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åŒæ­¥</span>
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">)</span>
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">)</span>
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span>    
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span>
<span class="token comment">// å¼‚æ­¥</span>
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">,</span> <span class="token class-name">ChildrenCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>    
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">,</span> <span class="token class-name">ChildrenCallback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">,</span> <span class="token class-name">Children2Callback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>    
<span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">,</span> <span class="token class-name">Children2Callback</span> callBack<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li></li> <li><table><thead><tr><th>å‚æ•°</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><code>path</code></td> <td>èŠ‚ç‚¹è·¯å¾„</td></tr> <tr><td><code>boolean</code></td> <td></td></tr> <tr><td><code>callBack</code></td> <td>å¼‚æ­¥å›è°ƒï¼Œå¯ä»¥è·å–èŠ‚ç‚¹åˆ—è¡¨</td></tr> <tr><td><code>ctx</code></td> <td>ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</td></tr></tbody></table></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getChildren_1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hadoop <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        hadoop<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getChildren_2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        zookeeper<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>ChildrenCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> rc<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rc <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I am children&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ul> <h4 id="æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨"><a href="#æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨" class="header-anchor">#</a> æ£€æŸ¥èŠ‚ç‚¹æ˜¯å¦å­˜åœ¨</h4> <p>åŒæ­¥ã€å¼‚æ­¥</p> <ul><li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// åŒæ­¥</span>
<span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">)</span>
<span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">)</span>
<span class="token comment">// å¼‚æ­¥</span>
<span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token keyword">boolean</span> watch<span class="token punctuation">,</span> <span class="token class-name">StatCallback</span> cb<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
<span class="token function">exists</span><span class="token punctuation">(</span><span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Watcher</span> watcher<span class="token punctuation">,</span> <span class="token class-name">StatCallback</span> cb<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li></li> <li><table><thead><tr><th>å‚æ•°</th> <th>è§£é‡Š</th></tr></thead> <tbody><tr><td><code>path</code></td> <td>èŠ‚ç‚¹è·¯å¾„</td></tr> <tr><td><code>boolean</code></td> <td></td></tr> <tr><td><code>callBack</code></td> <td>å¼‚æ­¥å›è°ƒï¼Œå¯ä»¥è·å–èŠ‚ç‚¹åˆ—è¡¨</td></tr> <tr><td><code>ctx</code></td> <td>ä¼ é€’ä¸Šä¸‹æ–‡å‚æ•°</td></tr></tbody></table></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exists1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    <span class="token class-name">Stat</span> exists <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoopx&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// åˆ¤ç©º</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>exists<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exists2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
    zookeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoopx&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">AsyncCallback<span class="token punctuation">.</span>StatCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token keyword">int</span> rc<span class="token punctuation">,</span> <span class="token class-name">String</span> path<span class="token punctuation">,</span> <span class="token class-name">Object</span> ctx<span class="token punctuation">,</span> <span class="token class-name">Stat</span> stat<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// åˆ¤ç©º</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>rc <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> path <span class="token operator">+</span> <span class="token string">&quot; &quot;</span> <span class="token operator">+</span> ctx <span class="token operator">+</span><span class="token string">&quot; &quot;</span> <span class="token operator">+</span> stat<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;I am children&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></li></ul> <h2 id="äº‹ä»¶ç›‘å¬æœºåˆ¶"><a href="#äº‹ä»¶ç›‘å¬æœºåˆ¶" class="header-anchor">#</a> äº‹ä»¶ç›‘å¬æœºåˆ¶</h2> <p><strong>watcheræ¦‚å¿µ</strong></p> <p><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_WatchRememberThese" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperProgrammers.html#sc_WatchRememberThese<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li><code>zookeeper</code>æä¾›äº†æ•°æ®çš„<code>å‘å¸ƒ/è®¢é˜…</code>åŠŸèƒ½ï¼Œå¤šä¸ªè®¢é˜…è€…å¯åŒæ—¶ç›‘å¬æŸä¸€ç‰¹å®šä¸»é¢˜å¯¹è±¡ï¼Œå½“è¯¥ä¸»é¢˜å¯¹è±¡çš„è‡ªèº«çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ä¾‹å¦‚èŠ‚ç‚¹å†…å®¹æ”¹å˜ã€èŠ‚ç‚¹ä¸‹çš„å­èŠ‚ç‚¹åˆ—è¡¨æ”¹å˜ç­‰ï¼Œä¼šå®æ—¶ã€ä¸»åŠ¨é€šçŸ¥æ‰€æœ‰è®¢é˜…è€…</li> <li><code>zookeeper</code>é‡‡ç”¨äº† <code>Watcher</code>æœºåˆ¶å®ç°æ•°æ®çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ã€‚è¯¥æœºåˆ¶åœ¨è¢«è®¢é˜…å¯¹è±¡å‘ç”Ÿå˜åŒ–æ—¶ä¼šå¼‚æ­¥é€šçŸ¥å®¢æˆ·ç«¯ï¼Œå› æ­¤å®¢æˆ·ç«¯ä¸å¿…åœ¨ <code>Watcher</code>æ³¨å†Œåè½®è¯¢é˜»å¡ï¼Œä»è€Œå‡è½»äº†å®¢æˆ·ç«¯å‹åŠ›</li> <li><code>watcher</code>æœºåˆ¶äº‹ä»¶ä¸Šä¸è§‚å¯Ÿè€…æ¨¡å¼ç±»ä¼¼ï¼Œä¹Ÿå¯çœ‹ä½œæ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼åœ¨åˆ†å¸ƒå¼åœºæ™¯ä¸‹çš„å®ç°æ–¹å¼</li></ul> <h4 id="watcheræ¶æ„"><a href="#watcheræ¶æ„" class="header-anchor">#</a> watcheræ¶æ„</h4> <p><code>watcher</code>å®ç°ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆ</p> <ul><li><code>zookeeper</code>æœåŠ¡ç«¯</li> <li><code>zookeeper</code>å®¢æˆ·ç«¯</li> <li>å®¢æˆ·ç«¯çš„<code>ZKWatchManagerå¯¹è±¡</code></li></ul> <p>å®¢æˆ·ç«¯<strong>é¦–å…ˆå°† <code>Watcher</code>æ³¨å†Œåˆ°æœåŠ¡ç«¯</strong>ï¼ŒåŒæ—¶å°† <code>Watcher</code>å¯¹è±¡<strong>ä¿å­˜åˆ°å®¢æˆ·ç«¯çš„<code>watch</code>ç®¡ç†å™¨ä¸­</strong>ã€‚å½“<code>Zookeeper</code>æœåŠ¡ç«¯ç›‘å¬çš„æ•°æ®çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒæœåŠ¡ç«¯ä¼š<strong>ä¸»åŠ¨é€šçŸ¥å®¢æˆ·ç«¯</strong>ï¼Œæ¥ç€å®¢æˆ·ç«¯çš„ <code>Watch</code>ç®¡ç†å™¨ä¼š**è§¦å‘ç›¸å…³ <code>Watcher</code>**æ¥å›è°ƒç›¸åº”å¤„ç†é€»è¾‘ï¼Œä»è€Œå®Œæˆæ•´ä½“çš„æ•°æ® <code>å‘å¸ƒ/è®¢é˜…</code>æµç¨‹</p> <p><img src="/znote/img/backend/zk/zookeeper-6.png" alt="zookeeper-6"></p> <h4 id="watcherç‰¹æ€§"><a href="#watcherç‰¹æ€§" class="header-anchor">#</a> watcherç‰¹æ€§</h4> <ul><li></li> <li><table><thead><tr><th>ç‰¹æ€§</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td>ä¸€æ¬¡æ€§</td> <td><code>watcher</code>æ˜¯<strong>ä¸€æ¬¡æ€§</strong>çš„ï¼Œä¸€æ—¦è¢«è§¦å‘å°±ä¼šç§»é™¤ï¼Œå†æ¬¡ä½¿ç”¨æ—¶éœ€è¦é‡æ–°æ³¨å†Œ</td></tr> <tr><td>å®¢æˆ·ç«¯é¡ºåºå›è°ƒ</td> <td><code>watcher</code>å›è°ƒæ˜¯<strong>é¡ºåºä¸²è¡Œ</strong>æ‰§è¡Œçš„ï¼Œåªæœ‰å›è°ƒåå®¢æˆ·ç«¯æ‰èƒ½çœ‹åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ä¸€ä¸ª<code>watcher</code>å›è°ƒé€»è¾‘ä¸åº”è¯¥å¤ªå¤šï¼Œä»¥å…å½±å“åˆ«çš„<code>watcher</code>æ‰§è¡Œ</td></tr> <tr><td>è½»é‡çº§</td> <td><code>WatchEvent</code>æ˜¯æœ€å°çš„é€šä¿¡å•ä½ï¼Œç»“æ„ä¸ŠåªåŒ…å«<strong>é€šçŸ¥çŠ¶æ€ã€äº‹ä»¶ç±»å‹å’ŒèŠ‚ç‚¹è·¯å¾„</strong>ï¼Œå¹¶ä¸ä¼šå‘Šè¯‰æ•°æ®èŠ‚ç‚¹å˜åŒ–å‰åçš„å…·ä½“å†…å®¹</td></tr> <tr><td>æ—¶æ•ˆæ€§</td> <td><code>watcher</code>åªæœ‰åœ¨å½“å‰<code>session</code>å½»åº•å¤±æ•ˆæ—¶æ‰ä¼šæ— æ•ˆï¼Œè‹¥åœ¨<code>session</code>æœ‰æ•ˆæœŸå†…å¿«é€Ÿé‡è¿æˆåŠŸï¼Œåˆ™<code>watcher</code>ä¾ç„¶å­˜åœ¨ï¼Œä»å¯æ¥æ”¶åˆ°é€šçŸ¥ï¼›</td></tr></tbody></table></li></ul> <p><strong>watcheræ¥å£è®¾è®¡</strong></p> <p><code>Watcher</code>æ˜¯ä¸€ä¸ªæ¥å£ï¼Œä»»ä½•å®ç°äº†<code>Watcher</code>æ¥å£çš„ç±»å°±ç®—ä¸€ä¸ªæ–°çš„<code>Watcher</code>ã€‚<code>Watcher</code>å†…éƒ¨åŒ…å«äº†ä¸¤ä¸ªæšä¸¾ç±»ï¼š<code>KeeperState</code>ã€<code>EventType</code></p> <p><img src="/znote/img/backend/zk/zookeeper-7.png" alt="zookeeper-7"></p> <h5 id="watcheré€šçŸ¥çŠ¶æ€-keeperstate"><a href="#watcheré€šçŸ¥çŠ¶æ€-keeperstate" class="header-anchor">#</a> Watcheré€šçŸ¥çŠ¶æ€(KeeperState)</h5> <p><code>KeeperState</code>æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯<strong>è¿æ¥çŠ¶æ€</strong>å‘ç”Ÿå˜åŒ–æ—¶å¯¹åº”çš„é€šçŸ¥ç±»å‹ã€‚è·¯å¾„ä¸º<code>org.apache.zookeeper.Watcher.EventKeeperState</code>ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œå…¶æšä¸¾å±æ€§å¦‚ä¸‹ï¼š</p> <ul><li></li> <li><table><thead><tr><th>æšä¸¾å±æ€§</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td><code>SyncConnected</code></td> <td>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ­£å¸¸è¿æ¥æ—¶</td></tr> <tr><td><code>Disconnected</code></td> <td>å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥æ—¶</td></tr> <tr><td><code>Expired</code></td> <td>ä¼šè¯<code>session</code>å¤±æ•ˆæ—¶</td></tr> <tr><td><code>AuthFailed</code></td> <td>èº«ä»½è®¤è¯å¤±è´¥æ—¶</td></tr></tbody></table></li></ul> <h5 id="watcheräº‹ä»¶ç±»å‹-eventtype"><a href="#watcheräº‹ä»¶ç±»å‹-eventtype" class="header-anchor">#</a> Watcheräº‹ä»¶ç±»å‹(EventType)</h5> <p><code>EventType</code>æ˜¯<strong>æ•°æ®èŠ‚ç‚¹<code>znode</code>å‘ç”Ÿå˜åŒ–</strong>æ—¶å¯¹åº”çš„é€šçŸ¥ç±»å‹ã€‚<strong><code>EventType</code>å˜åŒ–æ—¶<code>KeeperState</code>æ°¸è¿œå¤„äº<code>SyncConnected</code>é€šçŸ¥çŠ¶æ€ä¸‹</strong>ï¼›å½“<code>keeperState</code>å‘ç”Ÿå˜åŒ–æ—¶ï¼Œ<code>EventType</code>æ°¸è¿œä¸º<code>None</code>ã€‚å…¶è·¯å¾„ä¸º<code>org.apache.zookeeper.Watcher.Event.EventType</code>ï¼Œæ˜¯ä¸€ä¸ªæšä¸¾ç±»ï¼Œæšä¸¾å±æ€§å¦‚ä¸‹ï¼š</p> <ul><li></li> <li><table><thead><tr><th>æšä¸¾å±æ€§</th> <th>è¯´æ˜</th></tr></thead> <tbody><tr><td><code>None</code></td> <td>æ— </td></tr> <tr><td><code>NodeCreated</code></td> <td><code>Watcher</code>ç›‘å¬çš„æ•°æ®èŠ‚ç‚¹è¢«åˆ›å»ºæ—¶</td></tr> <tr><td><code>NodeDeleted</code></td> <td><code>Watcher</code>ç›‘å¬çš„æ•°æ®èŠ‚ç‚¹è¢«åˆ é™¤æ—¶</td></tr> <tr><td><code>NodeDataChanged</code></td> <td><code>Watcher</code>ç›‘å¬çš„æ•°æ®èŠ‚ç‚¹å†…å®¹å‘ç”Ÿæ›´æ”¹æ—¶(æ— è®ºæ•°æ®æ˜¯å¦çœŸçš„å˜åŒ–)</td></tr> <tr><td><code>NodeChildrenChanged</code></td> <td><code>Watcher</code>ç›‘å¬çš„æ•°æ®èŠ‚ç‚¹çš„å­èŠ‚ç‚¹åˆ—è¡¨å‘ç”Ÿå˜æ›´æ—¶</td></tr></tbody></table></li> <li><p>æ³¨æ„ï¼šå®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ç›¸å…³äº‹ä»¶é€šçŸ¥ä¸­åªåŒ…å«çŠ¶æ€ä»¥åŠç±»å‹ç­‰ä¿¡æ¯ï¼Œä¸åŒ…å«èŠ‚ç‚¹å˜åŒ–å‰åçš„å…·ä½“å†…å®¹ï¼Œå˜åŒ–å‰çš„æ•°æ®éœ€ä¸šåŠ¡è‡ªèº«å­˜å‚¨ï¼Œå˜åŒ–åçš„æ•°æ®éœ€è¦è°ƒç”¨<code>get</code>ç­‰æ–¹æ³•é‡æ–°è·å–</p></li></ul> <h5 id="æ•è·ç›¸åº”çš„äº‹ä»¶"><a href="#æ•è·ç›¸åº”çš„äº‹ä»¶" class="header-anchor">#</a> æ•è·ç›¸åº”çš„äº‹ä»¶</h5> <p>ä¸Šé¢è®²åˆ°<code>zookeeper</code>å®¢æˆ·ç«¯è¿æ¥çš„çŠ¶æ€å’Œ<code>zookeeper</code>å¯¹<code>znode</code>èŠ‚ç‚¹ç›‘å¬çš„äº‹ä»¶ç±»å‹ï¼Œä¸‹é¢æˆ‘ä»¬æ¥è®²è§£å¦‚ä½•å»ºç«‹<code>zookeeper</code>çš„***<code>watcher</code>ç›‘å¬***ã€‚åœ¨<code>zookeeper</code>ä¸­é‡‡ç”¨<code>zk.getChildren(path,watch)ã€zk.exists(path,watch)ã€zk.getData(path,watcher,stat)</code>è¿™æ ·çš„æ–¹å¼æ¥ä¸ºæŸä¸ª<code>znode</code>æ³¨å†Œç›‘å¬ ã€‚</p> <p>ä¸‹è¡¨ä»¥<code>node-x</code>èŠ‚ç‚¹ä¸ºä¾‹ï¼Œè¯´æ˜è°ƒç”¨çš„æ³¨å†Œæ–¹æ³•å’Œå¯ç”¨ç›‘å¬äº‹ä»¶é—´çš„å…³ç³»ï¼š</p> <table><thead><tr><th>æ³¨å†Œæ–¹å¼</th> <th>created</th> <th>childrenChanged</th> <th>Changed</th> <th>Deleted</th></tr></thead> <tbody><tr><td><code>zk.exists(&quot;/node-x&quot;,watcher)</code></td> <td>å¯ç›‘æ§</td> <td></td> <td>å¯ç›‘æ§</td> <td>å¯ç›‘æ§</td></tr> <tr><td><code>zk.getData(&quot;/node-x&quot;,watcher)</code></td> <td></td> <td></td> <td>å¯ç›‘æ§</td> <td>å¯ç›‘æ§</td></tr> <tr><td><code>zk.getChildren(&quot;/node-x&quot;,watcher)</code></td> <td></td> <td>å¯ç›‘æ§</td> <td></td> <td>å¯ç›‘æ§</td></tr></tbody></table> <p><strong>æ³¨å†Œwatcherçš„æ–¹æ³•</strong></p> <h5 id="å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥çŠ¶æ€"><a href="#å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥çŠ¶æ€" class="header-anchor">#</a> å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„è¿æ¥çŠ¶æ€</h5> <ul><li><p><code>KeeperState</code>ï¼šé€šçŸ¥çŠ¶æ€</p></li> <li><p><code>SyncConnected</code>ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ­£å¸¸è¿æ¥æ—¶</p></li> <li><p><code>Disconnected</code>ï¼šå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨æ–­å¼€è¿æ¥æ—¶</p></li> <li><p><code>Expired</code>ï¼šä¼šè¯<code>session</code>å¤±æ•ˆæ—¶</p></li> <li><p><code>AuthFailed</code>ï¼šèº«ä»½è®¤è¯å¤±è´¥æ—¶</p></li> <li><p>äº‹ä»¶ç±»å‹ä¸ºï¼š<code>None</code></p> <ul><li><p>æ¡ˆä¾‹</p></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ZkConnectionWatcher</span> <span class="token keyword">implements</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> watchedEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Event<span class="token punctuation">.</span>KeeperState</span> state <span class="token operator">=</span> watchedEvent<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>SyncConnected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// æ­£å¸¸</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ­£å¸¸è¿æ¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>Disconnected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// å¯ä»¥ç”¨Windowsæ–­å¼€è™šæ‹Ÿæœºç½‘å¡çš„æ–¹å¼æ¨¡æ‹Ÿ</span>
            <span class="token comment">// å½“ä¼šè¯æ–­å¼€ä¼šå‡ºç°ï¼Œæ–­å¼€è¿æ¥ä¸ä»£è¡¨ä¸èƒ½é‡è¿ï¼Œåœ¨ä¼šè¯è¶…æ—¶æ—¶é—´å†…é‡è¿å¯ä»¥æ¢å¤æ­£å¸¸</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ–­å¼€è¿æ¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>Expired</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// æ²¡æœ‰åœ¨ä¼šè¯è¶…æ—¶æ—¶é—´å†…é‡æ–°è¿æ¥ï¼Œè€Œæ˜¯å½“ä¼šè¯è¶…æ—¶è¢«ç§»é™¤çš„æ—¶å€™é‡è¿ä¼šèµ°è¿›è¿™é‡Œ</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥è¿‡æœŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>state <span class="token operator">==</span> <span class="token class-name">Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>AuthFailed</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// åœ¨æ“ä½œçš„æ—¶å€™æƒé™ä¸å¤Ÿä¼šå‡ºç°</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æˆæƒå¤±è´¥&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IP</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.133.133:2181&quot;</span>
<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// 5000ä¸ºä¼šè¯è¶…æ—¶æ—¶é—´</span>
        <span class="token class-name">ZooKeeper</span> zooKeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token constant">IP</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ZkConnectionWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¨¡æ‹Ÿæˆæƒå¤±è´¥</span>
        zooKeeper<span class="token punctuation">.</span><span class="token function">addAuthInfo</span><span class="token punctuation">(</span><span class="token string">&quot;digest1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;itcast1:123451&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> data <span class="token operator">=</span> zooKeeper<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div></li></ul></li></ul> <h5 id="watcheræ£€æŸ¥èŠ‚ç‚¹"><a href="#watcheræ£€æŸ¥èŠ‚ç‚¹" class="header-anchor">#</a> watcheræ£€æŸ¥èŠ‚ç‚¹</h5> <p><strong>exists</strong></p> <ul><li><p><code>exists(String path, boolean b)</code></p></li> <li><p><code>exists(String path, Watcher w)</code></p></li> <li><p><code>NodeCreated</code>ï¼š<strong>èŠ‚ç‚¹</strong>åˆ›å»º</p></li> <li><p><code>NodeDeleted</code>ï¼š<strong>èŠ‚ç‚¹</strong>åˆ é™¤</p></li> <li><p><code>NodeDataChanged</code>ï¼š<strong>èŠ‚ç‚¹</strong>å†…å®¹</p> <ul><li><p>æ¡ˆä¾‹</p></li> <li><div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventTypeTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IP</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.133.133:2181&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zooKeeper<span class="token punctuation">;</span>

    <span class="token comment">// é‡‡ç”¨zookeeperè¿æ¥åˆ›å»ºæ—¶çš„ç›‘å¬å™¨</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exists1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è‡ªå®šä¹‰ç›‘å¬å™¨</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exists2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è‡ªå®šä¹‰&quot;</span> <span class="token operator">+</span> w<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ¼”ç¤ºä½¿ç”¨å¤šæ¬¡çš„ç›‘å¬å™¨</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exists3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> watchedEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è‡ªå®šä¹‰çš„&quot;</span> <span class="token operator">+</span> watchedEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æ¼”ç¤ºä¸€èŠ‚ç‚¹æ³¨å†Œå¤šä¸ªç›‘å¬å™¨</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">exists4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> w<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è‡ªå®šä¹‰1&quot;</span> <span class="token operator">+</span> w<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> watchedEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è‡ªå®šä¹‰2&quot;</span> <span class="token operator">+</span> watchedEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token keyword">try</span> <span class="token punctuation">{</span>
                        zooKeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token string">&quot;/watcher1&quot;</span><span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// æµ‹è¯•</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        zooKeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token constant">IP</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ZKWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">exists4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ZKWatcher</span> <span class="token keyword">implements</span> <span class="token class-name">Watcher</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> watchedEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;zkçš„ç›‘å¬å™¨&quot;</span> <span class="token operator">+</span> watchedEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br></div></div></li></ul></li></ul> <p><strong>getData</strong></p> <ul><li><code>getData(String path, boolean b, Stat stat)</code></li> <li><code>getData(String path, Watcher w, Stat stat)</code></li> <li><code>NodeDeleted</code>ï¼š<strong>èŠ‚ç‚¹</strong>åˆ é™¤</li> <li><code>NodeDataChange</code>ï¼š<strong>èŠ‚ç‚¹</strong>å†…å®¹å‘ç”Ÿå˜åŒ–</li></ul> <p><strong>getChildren</strong></p> <ul><li><code>getChildren(String path, boolean b)</code></li> <li><code>getChildren(String path, Watcher w)</code></li> <li><code>NodeChildrenChanged</code>ï¼š<strong>å­èŠ‚ç‚¹</strong>å‘ç”Ÿå˜åŒ–</li> <li><code>NodeDeleted</code>ï¼š<strong>èŠ‚ç‚¹åˆ é™¤</strong></li></ul> <h2 id="é…ç½®ä¸­å¿ƒæ¡ˆä¾‹"><a href="#é…ç½®ä¸­å¿ƒæ¡ˆä¾‹" class="header-anchor">#</a> é…ç½®ä¸­å¿ƒæ¡ˆä¾‹</h2> <p>å·¥ä½œä¸­æœ‰è¿™æ ·çš„ä¸€ä¸ªåœºæ™¯ï¼šæ•°æ®åº“ç”¨æˆ·åå’Œå¯†ç ä¿¡æ¯æ”¾åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œåº”ç”¨è¯»å–è¯¥é…ç½®æ–‡ä»¶ï¼Œé…ç½®æ–‡ä»¶ä¿¡æ¯æ”¾å…¥ç¼“å­˜</p> <p>è‹¥æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç æ”¹å˜æ—¶å€™ï¼Œè¿˜éœ€è¦é‡æ–°åŠ è½½åª›å­˜ï¼Œæ¯”è¾ƒéº»çƒ¦ï¼Œé€šè¿‡ <code>Zookeeper</code>å¯ä»¥è½»æ¾å®Œæˆ,å½“æ•°æ®åº“å‘ç”Ÿå˜åŒ–æ—¶è‡ªåŠ¨å®Œæˆç¼“å­˜åŒæ­¥</p> <p>ä½¿ç”¨äº‹ä»¶ç›‘å¬æœºåˆ¶å¯ä»¥åšå‡ºä¸€ä¸ªç®€å•çš„é…ç½®ä¸­å¿ƒ</p> <p>è®¾è®¡æ€è·¯</p> <ol><li>è¿æ¥<code>zookeeper</code>æœåŠ¡å™¨</li> <li>è¯»å–<code>zookeeper</code>ä¸­çš„é…ç½®ä¿¡æ¯ï¼Œæ³¨å†Œ<code>watcher</code>ç›‘å¬å™¨ï¼Œå­˜å…¥æœ¬åœ°å˜é‡</li> <li>å½“<code>zookeeper</code>ä¸­çš„é…ç½®ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œé€šè¿‡<code>watcher</code>çš„å›è°ƒæ–¹æ³•æ•è·æ•°æ®å˜åŒ–äº‹ä»¶</li> <li>é‡æ–°è·å–é…ç½®ä¿¡æ¯</li></ol> <h2 id="åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹"><a href="#åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹" class="header-anchor">#</a> åˆ†å¸ƒå¼å”¯ä¸€idæ¡ˆä¾‹</h2> <p>åœ¨è¿‡å»çš„å•åº“å•è¡¨å‹ç³»ç»Ÿä¸­ï¼Œé€šå¸¸ç¬¬å¯ä»¥ä½¿ç”¨æ•°æ®åº“å­—æ®µè‡ªå¸¦çš„<code>auto_ increment</code>å±æ€§æ¥è‡ªåŠ¨ä¸ºæ¯æ¡è®°å½•ç”Ÿæˆä¸ªå”¯ä¸€çš„<code>ID</code>ã€‚ä½†æ˜¯åˆ†åº“åˆ†è¡¨åï¼Œå°±æ— æ³•åœ¨ä¾é æ•°æ®åº“çš„<code>auto_ increment</code>å±æ€§æ¥å”¯ä¸€æ ‡è¯†ä¸€æ¡è®°å½•äº†ã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥ç”¨<code>zookeeper</code>åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ç”Ÿæˆå…¨å±€å”¯ä¸€<code>ID</code></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IdGenerate</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">IP</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.133.133:2181&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">ZooKeeper</span> zooKeeper<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> zooKeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/id&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">EPHEMERAL_SEQUENTIAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        zooKeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token constant">IP</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ZKWatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">generateId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ZKWatcher</span> <span class="token keyword">implements</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> watchedEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;zkçš„ç›‘å¬å™¨&quot;</span> <span class="token operator">+</span> watchedEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><h2 id="åˆ†å¸ƒå¼é”æ¡ˆä¾‹"><a href="#åˆ†å¸ƒå¼é”æ¡ˆä¾‹" class="header-anchor">#</a> åˆ†å¸ƒå¼é”æ¡ˆä¾‹</h2> <p>åˆ†å¸ƒå¼é”æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œæ¯”å¦‚é€šè¿‡æ•°æ®åº“ã€rediséƒ½å¯å®ç°ã€‚ä½œä¸ºåˆ†å¸ƒå¼ååŒå·¥å…·<code>Zookeeper</code>ï¼Œå½“ç„¶ä¹Ÿæœ‰ç€æ ‡å‡†çš„å®ç°æ–¹å¼ã€‚ä¸‹é¢ä»‹ç»åœ¨<code>zookeeper</code>ä¸­å¦‚æœå®ç°æ’ä»–é”</p> <p>è®¾è®¡æ€è·¯</p> <ol><li>æ¯ä¸ªå®¢æˆ·ç«¯å¾€<code>/Locks</code>ä¸‹åˆ›å»ºä¸´æ—¶æœ‰åºèŠ‚ç‚¹<code>/Locks/Lock_</code>ï¼Œåˆ›å»ºæˆåŠŸå<code>/Locks</code>ä¸‹é¢ä¼šæœ‰æ¯ä¸ªå®¢æˆ·ç«¯å¯¹åº”çš„èŠ‚ç‚¹ï¼Œå¦‚<code>/Locks/Lock_000000001</code></li> <li>å®¢æˆ·ç«¯å–å¾—/Locksä¸‹å­èŠ‚ç‚¹ï¼Œå¹¶è¿›è¡Œæ’åºï¼Œåˆ¤æ–­æ’åœ¨å‰é¢çš„æ˜¯å¦ä¸ºè‡ªå·±ï¼Œå¦‚æœè‡ªå·±çš„é”èŠ‚ç‚¹åœ¨ç¬¬ä¸€ä½ï¼Œä»£è¡¨è·å–é”æˆåŠŸ</li> <li>å¦‚æœè‡ªå·±çš„é”èŠ‚ç‚¹ä¸åœ¨ç¬¬ä¸€ä½ï¼Œåˆ™ç›‘å¬è‡ªå·±å‰ä¸€ä½çš„é”èŠ‚ç‚¹ã€‚ä¾‹å¦‚ï¼Œè‡ªå·±é”èŠ‚ç‚¹<code>Lock_000000002</code>ï¼Œé‚£ä¹ˆåˆ™ç›‘å¬<code>Lock_000000001</code></li> <li>å½“å‰ä¸€ä½é”èŠ‚ç‚¹<code>(Lock_000000001)</code>å¯¹åº”çš„å®¢æˆ·ç«¯æ‰§è¡Œå®Œæˆï¼Œé‡Šæ”¾äº†é”ï¼Œå°†ä¼šè§¦å‘ç›‘å¬å®¢æˆ·ç«¯<code>(Lock_000000002)</code>çš„é€»è¾‘</li> <li>ç›‘å¬å®¢æˆ·ç«¯é‡æ–°æ‰§è¡Œç¬¬<code>2</code>æ­¥é€»è¾‘ï¼Œåˆ¤æ–­è‡ªå·±æ˜¯å¦è·å¾—äº†é”</li> <li><strong>zookeeperæ˜¯æœ‰å·¥å…·åŒ…çš„(è¿™é‡Œé‡‡ç”¨æ‰‹å†™)</strong></li></ol> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// çº¿ç¨‹æµ‹è¯•ç±»</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThreadTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delayOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">interface</span> <span class="token class-name">Runable</span><span class="token punctuation">{</span>
        <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">Runable</span> runable<span class="token punctuation">,</span><span class="token keyword">int</span> threadNum<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">ThreadPoolExecutor</span> threadPoolExecutor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadPoolExecutor</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">ArrayBlockingQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> threadNum<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            threadPoolExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>runable<span class="token operator">::</span><span class="token function">run</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        threadPoolExecutor<span class="token punctuation">.</span><span class="token function">shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
<span class="token comment">//        DistributedLock distributedLock = new DistributedLock();</span>
<span class="token comment">//        distributedLock.acquireLock();</span>
<span class="token comment">//        delayOperation();</span>
<span class="token comment">//        distributedLock.releaseLock();</span>
        <span class="token class-name">DateTimeFormatter</span> dateTimeFormatter <span class="token operator">=</span> <span class="token class-name">DateTimeFormatter</span><span class="token punctuation">.</span><span class="token function">ofPattern</span><span class="token punctuation">(</span><span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ¯ç§’æ‰“å°ä¿¡æ¯</span>
        <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">999999999</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token class-name">String</span> format <span class="token operator">=</span> dateTimeFormatter<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token class-name">LocalDateTime</span><span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>format<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// çº¿ç¨‹æµ‹è¯•</span>
        <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">DistributedLock</span> distributedLock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DistributedLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            distributedLock<span class="token punctuation">.</span><span class="token function">acquireLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">delayOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            distributedLock<span class="token punctuation">.</span><span class="token function">releaseLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DistributedLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token constant">IP</span> <span class="token operator">=</span> <span class="token string">&quot;192.168.133.133:2181&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">ROOT_LOCK</span> <span class="token operator">=</span> <span class="token string">&quot;/Root_Lock&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">LOCK_PREFIX</span> <span class="token operator">=</span> <span class="token string">&quot;/Lock_&quot;</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">DATA</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">ZooKeeper</span> zookeeper<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// åˆå§‹åŒ–</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            zookeeper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token constant">IP</span><span class="token punctuation">,</span> <span class="token number">200000</span><span class="token punctuation">,</span> w <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Watcher<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>SyncConnected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æš´éœ²çš„å¤–éƒ¨æ–¹æ³•ï¼Œä¸»é€»è¾‘</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">acquireLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">createLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">attemptLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æš´éœ²çš„å¤–éƒ¨æ–¹æ³•ï¼Œä¸»é€»è¾‘</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">releaseLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            zookeeper<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é”é‡Šæ”¾äº†&quot;</span> <span class="token operator">+</span> path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> <span class="token operator">|</span> <span class="token class-name">KeeperException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">createLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// åˆ›å»ºä¸€ä¸ªç›®å½•èŠ‚ç‚¹</span>
            <span class="token class-name">Stat</span> root <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token constant">ROOT_LOCK</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>root <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
                zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token constant">ROOT_LOCK</span><span class="token punctuation">,</span> <span class="token constant">DATA</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç›®å½•ä¸‹åˆ›å»ºå­èŠ‚ç‚¹</span>
            path <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token constant">ROOT_LOCK</span> <span class="token operator">+</span> <span class="token constant">LOCK_PREFIX</span><span class="token punctuation">,</span> <span class="token constant">DATA</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">,</span> <span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">EPHEMERAL_SEQUENTIAL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeeperException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">private</span> <span class="token class-name">Watcher</span> watcher <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Watcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token class-name">WatchedEvent</span> watchedEvent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>watchedEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Event<span class="token punctuation">.</span>EventType<span class="token punctuation">.</span>NodeDeleted</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">notifyAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">attemptLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// è·å–æ­£åœ¨æ’é˜Ÿçš„èŠ‚ç‚¹ï¼Œç”±äºæ˜¯zookeeperç”Ÿæˆçš„ä¸´æ—¶èŠ‚ç‚¹ï¼Œä¸ä¼šå‡ºé”™ï¼Œè¿™é‡Œä¸èƒ½åŠ ç›‘è§†å™¨</span>
            <span class="token comment">// å› ä¸ºæ·»åŠ äº†ç›‘è§†å™¨åï¼Œä»»ä½•å­èŠ‚ç‚¹çš„å˜åŒ–éƒ½ä¼šè§¦å‘ç›‘è§†å™¨</span>
            <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> nodes <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token constant">ROOT_LOCK</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            nodes<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">compareTo</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è·å–è‡ªèº«èŠ‚ç‚¹çš„æ’å</span>
            <span class="token keyword">int</span> ranking <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token constant">ROOT_LOCK</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// å·²ç»æ˜¯æœ€é å‰çš„èŠ‚ç‚¹äº†ï¼Œè·å–é”</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>ranking <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                <span class="token keyword">return</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¹¶ä¸æ˜¯é å‰çš„é”ï¼Œç›‘è§†è‡ªèº«èŠ‚ç‚¹çš„å‰ä¸€ä¸ªèŠ‚ç‚¹</span>
                <span class="token class-name">Stat</span> status <span class="token operator">=</span> zookeeper<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token constant">ROOT_LOCK</span><span class="token operator">+</span><span class="token string">&quot;/&quot;</span><span class="token operator">+</span>nodes<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>ranking <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// æœ‰å¯èƒ½è¿™è¿™ä¸ªåˆ¤æ–­çš„ç¬é—´ï¼Œ0å·å®Œæˆäº†æ“ä½œ(æ­¤æ—¶æˆ‘ä»¬åº”è¯¥åˆ¤æ–­æˆåŠŸè‡ªæ—‹æ‰å¯¹)ï¼Œä½†æ˜¯ä¸Šé¢çš„statuså˜é‡å·²ç»è·å–äº†å€¼å¹¶ä¸”ä¸ä¸ºç©ºï¼Œ1å·æ²‰ç¡</span>
                <span class="token comment">// ä½†æ˜¯ï¼Œè¯·æ³¨æ„è‡ªè¡Œæµ‹è¯•ï¼Œè™½ç„¶1å·è¡¨é¢ä¸Šæ²‰ç¡äº†ï¼Œä½†æ˜¯å®é™…ä¸Šwatcher.wait()æ˜¯ç¬é—´å”¤é†’çš„</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">attemptLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token keyword">synchronized</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">)</span><span class="token punctuation">{</span>
                        watcher<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    <span class="token function">attemptLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">KeeperException</span> <span class="token operator">|</span> <span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br></div></div><h2 id="é›†ç¾¤æ­å»º"><a href="#é›†ç¾¤æ­å»º" class="header-anchor">#</a> é›†ç¾¤æ­å»º</h2> <p><code>zookeeper</code>å®˜ç½‘â€”â€”<code>Getting started</code>â€”â€”<a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperStarted.html#sc_RunningReplicatedZooKeeper" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperStarted.html#sc_RunningReplicatedZooKeeper<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å®Œå…¨é…ç½®â€”â€”<a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_zkMulitServerSetup" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_zkMulitServerSetup<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_configuration" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>è¿è¡Œæ—¶å¤åˆ¶çš„<code>zookeeper</code></p> <p><strong>è¯´æ˜</strong>ï¼šå¯¹äºå¤åˆ¶æ¨¡å¼ï¼Œè‡³å°‘éœ€è¦ä¸‰ä¸ªæœåŠ¡å™¨ï¼Œå¹¶ä¸”å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨å¥‡æ•°ä¸ªæœåŠ¡å™¨ã€‚å¦‚æœåªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆæ‚¨å°†å¤„äºä¸€ç§æƒ…å†µï¼Œå¦‚æœå…¶ä¸­ä¸€å°æœåŠ¡å™¨å‘ç”Ÿæ•…éšœï¼Œåˆ™æ²¡æœ‰è¶³å¤Ÿçš„è®¡ç®—æœºæ„æˆå¤šæ•°ä»²è£(<code>zk</code>é‡‡ç”¨çš„æ˜¯è¿‡åŠæ•°ä»²è£ã€‚å› æ­¤ï¼Œæ­å»ºçš„é›†ç¾¤è¦å®¹å¿nä¸ªèŠ‚ç‚¹çš„æ•…éšœï¼Œå°±å¿…é¡»æœ‰<code>2n+1</code>å°è®¡ç®—æœºï¼Œè¿™æ˜¯å› ä¸ºå®•æ‰nå°åï¼Œé›†ç¾¤è¿˜æ®‹ä½™<code>n+1</code>å°è®¡ç®—æœºï¼Œ<code>n+1</code>å°è®¡ç®—æœºä¸­å¿…å®šæœ‰ä¸€ä¸ªæœ€å®Œæ•´æœ€æ¥è¿‘<code>leader</code>çš„<code>follower</code>ï¼Œå‡å¦‚å®•æ‰çš„nå°éƒ½æ˜¯æœ‰å®Œæ•´ä¿¡æ¯çš„ï¼Œå‰©ä¸‹çš„ä¸€å°å°±ä¼šå‡ºç°åœ¨æ®‹ä½™çš„<code>zk</code>é›†ç¾¤ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š<code>zk</code>ä¸ºäº†å®‰å…¨ï¼Œå¿…é¡»è¾¾åˆ°å¤šæ•°ä»²è£ï¼Œå¦åˆ™æ²¡æœ‰<code>leader</code>ï¼Œé›†ç¾¤å¤±è´¥ï¼Œå…·ä½“ä½“ç°åœ¨**<code>leader</code>é€‰ä¸¾-ç« **)ã€‚ç”±äºå­˜åœ¨ä¸¤ä¸ªå•ç‚¹æ•…éšœï¼Œå› æ­¤ä¸¤ä¸ªæœåŠ¡å™¨è¿˜<strong>ä¸å¦‚</strong>å•ä¸ªæœåŠ¡å™¨ç¨³å®šã€‚</p> <p>â€”â€”å…³äº<code>2n+1</code>åŸåˆ™ï¼Œ<code>Kafka</code>å®˜ç½‘æœ‰æƒå¨çš„è§£é‡Š(è™½ç„¶<code>Kafka</code>ä¸é‡‡ç”¨)http://kafka.apache.org/0110/documentation.html#design_replicatedlog</p> <p>å¤šæ•°ä»²è£çš„è®¾è®¡æ˜¯ä¸ºäº†<strong>é¿å…è„‘è£‚</strong>(zkï¼Œå·²ç»é‡‡ç”¨äº†å¤šæ•°ä»²è£ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°)ï¼Œå’Œæ•°æ®ä¸€è‡´æ€§çš„é—®é¢˜</p> <ul><li><strong>è„‘è£‚</strong>ï¼šç”±äºç½‘ç»œå»¶è¿Ÿç­‰å„ç§å› ç´ ï¼Œæœ€ç»ˆå¯¼è‡´é›†ç¾¤ä¸€åˆ†ä¸ºäºŒï¼Œå„è‡ªç‹¬ç«‹è¿è¡Œ(ä¸¤ä¸ª<code>leader</code>)ï¼Œé›†ç¾¤å°±æ˜¯åçš„</li> <li>å¦‚æœæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œä¸¤å°éƒ½è®¤ä¸ºå¦å¤–çš„<code>zk</code>å®•æ‰ï¼Œå„è‡ªæˆä¸º<code>leader</code>è¿è¡Œ(å‡è®¾å¯ä»¥ï¼Œå®é™…ä¸Šé€‰ä¸å‡º<code>leader</code>ï¼Œå¯ä»¥å®é™…æ­å»ºä¸€ä¸ªé›†ç¾¤ï¼Œçœ‹çœ‹ä¸€å°zkæ˜¯å¦èƒ½å¤ŸæˆåŠŸé›†ç¾¤ï¼Œè¯¦è§**<code>leader</code>é€‰ä¸¾**)ï¼Œå°±ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li> <li>å¦‚æœæœ‰ä¸‰å°æœåŠ¡å™¨ï¼Œä¸€å°å› ä¸ºç½‘ç»œåˆ†åŒºï¼Œæ— æ³•è¿æ¥ï¼Œå‰©ä¸‹ä¸¤å°ç½‘ç»œæ­£å¸¸ï¼Œé€‰ä¸¾å‡ºäº†<code>leader</code>ï¼Œé›†ç¾¤æ­£å¸¸</li> <li>ä»¥æ­¤ç±»æ¨
<ul><li><img src="/znote/img/backend/zk/è„‘è£‚.png" alt="è„‘è£‚"></li> <li>zkçš„è®¾è®¡å¤©ç”Ÿå°±æ˜¯<code>cap</code>ä¸­çš„<code>cp</code>ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°ä¸Šè¿°çš„è„‘è£‚å’Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œæˆ‘ä»¬æ­å»º<code>zk</code>ä»…éœ€ä¿è¯<code>2n+1</code>åŸåˆ™</li></ul></li></ul> <p>å¤åˆ¶æ¨¡å¼æ‰€éœ€çš„<strong>conf / zoo.cfg</strong>æ–‡ä»¶ç±»ä¼¼äºç‹¬ç«‹æ¨¡å¼ä¸‹ä½¿ç”¨çš„æ–‡ä»¶ï¼Œä½†æœ‰ä¸€äº›åŒºåˆ«ã€‚è¿™æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/var/lib/zookeeper
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token assign-left variable">server.1</span><span class="token operator">=</span>zoo1:2888:3888 <span class="token comment"># è¿™æ˜¯å¤šæœºéƒ¨ç½²</span>
<span class="token assign-left variable">server.2</span><span class="token operator">=</span>zoo2:2888:3888
<span class="token assign-left variable">server.3</span><span class="token operator">=</span>zoo3:2888:3888
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>æ–°çš„é”®å€¼**<code>initLimit</code><strong>æ˜¯<code>zookeeper</code>ç”¨äºé™åˆ¶é€‰ä¸¾ä¸­<code>zookeeper</code>æœåŠ¡è¿æ¥åˆ°<code>leader</code>çš„æ—¶é—´ï¼Œ</strong><code>syncLimit</code>**é™åˆ¶æœåŠ¡å™¨ä¸<code>leader</code>çš„è¿‡æœŸæ—¶é—´</li> <li>å¯¹äºè¿™ä¸¤ä¸ªè¶…æ—¶ï¼Œæ‚¨éƒ½å¯ä»¥ä½¿ç”¨<strong>tickTime</strong>æŒ‡å®šæ—¶é—´å•ä½ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>initLimit</code>çš„è¶…æ—¶ä¸º5ä¸ªæ»´ç­”å£°ï¼Œå³<code>2000</code>æ¯«ç§’/æ»´ç­”å£°ï¼Œå³<code>10</code>ç§’</li> <li>è¡¨æ ¼*<code>server.X</code><em>çš„æ¡ç›®åˆ—å‡ºäº†ç»„æˆ<code>ZooKeeper</code>æœåŠ¡çš„æœåŠ¡å™¨ã€‚æœåŠ¡å™¨å¯åŠ¨æ—¶ï¼Œå®ƒé€šè¿‡åœ¨æ•°æ®ç›®å½•ä¸­æŸ¥æ‰¾æ–‡ä»¶</em><code>myid</code>*æ¥çŸ¥é“å®ƒæ˜¯å“ªå°æœåŠ¡å™¨ã€‚è¯¥æ–‡ä»¶åŒ…å«<code>ASCII</code>çš„æœåŠ¡å™¨å·ã€‚</li> <li>æœ€åï¼Œè®°ä¸‹æ¯ä¸ªæœåŠ¡å™¨åç§°åé¢çš„ä¸¤ä¸ªç«¯å£å·ï¼š<code>â€œ 2888â€</code>å’Œ<code>â€œ 3888â€</code>ã€‚å¯¹ç­‰æ–¹ä½¿ç”¨å‰ä¸€ä¸ªç«¯å£è¿æ¥åˆ°å…¶ä»–å¯¹ç­‰æ–¹ã€‚è¿™ç§è¿æ¥æ˜¯å¿…éœ€çš„ï¼Œä»¥ä¾¿å¯¹ç­‰æ–¹å¯ä»¥è¿›è¡Œé€šä¿¡ï¼Œä¾‹å¦‚ï¼Œä»¥å•†å®šæ›´æ–°é¡ºåºã€‚æ›´å…·ä½“åœ°è¯´ï¼Œ<strong><code>ZooKeeper</code>æœåŠ¡å™¨ä½¿ç”¨æ­¤ç«¯å£å°†<code>follower</code>è¿æ¥åˆ°<code>leader</code></strong>ã€‚å½“å‡ºç°æ–°çš„<code>leader</code>è€…æ—¶ï¼Œ<code>follower</code>ä½¿ç”¨æ­¤ç«¯å£æ‰“å¼€ä¸<code>leader</code>çš„<code>TCP</code>è¿æ¥ã€‚å› ä¸ºé»˜è®¤çš„<code>leader</code>é€‰ä¸¾ä¹Ÿä½¿ç”¨<code>TCP</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å½“å‰éœ€è¦å¦ä¸€ä¸ªç«¯å£æ¥è¿›è¡Œ<code>leader</code>é€‰ä¸¾ã€‚è¿™æ˜¯ç¬¬äºŒä¸ªç«¯å£ã€‚</li></ul> <p><strong>æ­£æ–‡</strong>æ­å»ºï¼šå•æœºç¯å¢ƒä¸‹ï¼Œ<code>jdk</code>ã€<code>zookeeper</code>å®‰è£…å®Œæ¯•ï¼ŒåŸºäºä¸€å°è™šæ‹Ÿæœºï¼Œè¿›è¡Œ<code>zookeeper</code><strong>ä¼ªé›†ç¾¤æ­å»º</strong>ï¼Œ<code>zookeeper</code>é›†ç¾¤ä¸­åŒ…å«3ä¸ªèŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡ç«¯å£å·ï¼Œåˆ†åˆ«ä¸º<code>2181</code>ã€<code>2182</code>ã€<code>2183</code></p> <ol><li><p>åŸºäº<code>zookeeper-3.4.10</code>å¤åˆ¶ä¸‰ä»½<code>zookeeper</code>å®‰è£…å¥½çš„æœåŠ¡å™¨æ–‡ä»¶,ç›®å½•åç§°åˆ†åˆ«ä¸º<code>zookeeper2181</code>ã€<code>zookeeper2182</code>ã€<code>zookeeper2183</code></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">cp</span> <span class="token parameter variable">-r</span> zookeeper-3.4.10  zookeeper2181
<span class="token function">cp</span> <span class="token parameter variable">-r</span> zookeeper-3.4.10  zookeeper2182
<span class="token function">cp</span> <span class="token parameter variable">-r</span> zookeeper-3.4.10  zookeeper2183

<span class="token comment"># cp -r zookeeper-3.1.10 ./zookeeper218{1..3}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>ä¿®æ”¹<code>zookeeper2181</code>æœåŠ¡å™¨å¯¹åº”é…ç½®æ–‡ä»¶</p></li></ol> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># æœåŠ¡å™¨å¯¹åº”ç«¯å£å·</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token comment"># æ•°æ®å¿«ç…§æ–‡ä»¶æ‰€åœ¨è·¯å¾„</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/opt/zookeeper2181/data
<span class="token comment"># é›†ç¾¤é…ç½®ä¿¡æ¯</span>
   <span class="token comment"># server:A=B:C:D</span>
   <span class="token comment"># A:æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºè¿™ä¸ªæ˜¯æœåŠ¡å™¨çš„ç¼–å·</span>
   <span class="token comment"># B:æ˜¯è¿™ä¸ªæœåŠ¡å™¨çš„ipåœ°å€</span>
   <span class="token comment"># C:ZookeeperæœåŠ¡å™¨ä¹‹é—´é€šä¿¡çš„ç«¯å£(æ•°æ®äº’é€šï¼Œå¿…é¡»çš„)</span>
   <span class="token comment"># D:Leaderé€‰ä¸¾çš„ç«¯å£</span>
<span class="token assign-left variable">server.1</span><span class="token operator">=</span><span class="token number">192.168</span>.133.133:2287:3387  <span class="token comment"># è¿™æ˜¯ä¼ªé›†ç¾¤éƒ¨ç½²ï¼Œæ³¨æ„ç«¯å£å·  </span>
<span class="token assign-left variable">server.2</span><span class="token operator">=</span><span class="token number">192.168</span>.133.133:2288:3388
<span class="token assign-left variable">server.3</span><span class="token operator">=</span><span class="token number">192.168</span>.133.133:2289:3389
<span class="token comment"># å¯¹ï¼Œè¿™äº›éƒ½æ˜¯2181çš„é…ç½®æ–‡ä»¶</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ol start="3"><li><p>åœ¨ä¸Šä¸€æ­¥ <code>dataDir</code>æŒ‡å®šçš„ç›®å½•ä¸‹ï¼Œåˆ›å»º<code>myid</code>æ–‡ä»¶ï¼Œç„¶ååœ¨è¯¥æ–‡ä»¶æ·»åŠ ä¸Šä¸€æ­¥<code>server</code>é…ç½®çš„å¯¹åº”<code>A</code>æ•°å­—</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment"># zookeeper2181å¯¹åº”çš„æ•°å­—ä¸º1</span>
<span class="token comment"># /opt/zookeeper2181/dataç›®å½•(å³dataDirçš„ç›®å½•ä¸‹)ä¸‹æ‰§è¡Œå‘½ä»¤</span>
<span class="token builtin class-name">echo</span> <span class="token string">&quot;1&quot;</span> <span class="token operator">&gt;</span> myid
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p><code>zookeeper2182ã€2183</code>å‚ç…§2/3è¿›è¡Œç›¸åº”é…ç½®</p></li> <li><p>åˆ†åˆ«å¯åŠ¨ä¸‰å°æœåŠ¡å™¨ï¼Œæ£€éªŒé›†ç¾¤çŠ¶æ€</p> <p>æ£€æŸ¥ï¼š<code>cd</code>è¿›å…¥<code>bin</code>ç›®å½•<code>./zkServer status</code></p> <p>ç™»å½•å‘½ä»¤ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>./zkCli.sh <span class="token parameter variable">-server</span> <span class="token number">192.168</span>.60.130:2181
./zkCli.sh <span class="token parameter variable">-server</span> <span class="token number">192.168</span>.60.130:2182
./zkCli.sh <span class="token parameter variable">-server</span> <span class="token number">192.168</span>.60.130:2183
<span class="token comment"># å¦‚æœå¯åŠ¨åæ²¡æœ‰æ˜¾ç¤ºå‡ºé›†ç¾¤çš„çŠ¶æ€ï¼Œè¯·è‡ªå·±æ£€æŸ¥ç«¯å£å’Œé…ç½®æ–‡ä»¶é—®é¢˜ï¼Œä¸»è¦æ˜¯ç«¯å£å ç”¨å’Œé…ç½®æ–‡ä»¶é—®é¢˜</span>
<span class="token comment"># ss -lntpd | grep 2181</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ol> <h4 id="ä¸€è‡´æ€§åè®®-zabåè®®"><a href="#ä¸€è‡´æ€§åè®®-zabåè®®" class="header-anchor">#</a> ä¸€è‡´æ€§åè®®â€”â€”zabåè®®</h4> <p><code>zab</code>åè®®çš„å…¨ç§°æ˜¯ <em><strong><code>Zookeeper Atomic Broadcast</code></strong></em> (<code>zookeeper</code>åŸå­å¹¿æ’­)ã€‚<code>zookeeper</code>æ˜¯é€šè¿‡<code>zab</code>åè®®æ¥ä¿è¯åˆ†å¸ƒå¼äº‹åŠ¡çš„æœ€ç»ˆä¸€è‡´æ€§</p> <p>åŸºäº<code>zab</code>åè®®ï¼Œ<code>zookeeper</code>é›†ç¾¤ä¸­çš„è§’è‰²ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ç±»ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p> <table><thead><tr><th>è§’è‰²</th> <th>æè¿°</th></tr></thead> <tbody><tr><td><strong>é¢†å¯¼è€…(<code>Leader</code>)</strong></td> <td>é¢†å¯¼è€…è´Ÿè´£è¿›è¡ŒæŠ•ç¥¨çš„å‘èµ·å’Œå†³è®®ï¼Œæ›´æ–°ç³»ç»ŸçŠ¶æ€</td></tr> <tr><td><strong>å­¦ä¹ è€…(<code>Learner</code>)-è·Ÿéšè€…(<code>Follower</code>)</strong></td> <td><code>Follower</code>ç”¨äºæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚å¹¶å‘å®¢æˆ·ç«¯è¿”å›ç»“æœï¼Œåœ¨é€‰ä¸»è¿‡ç¨‹ä¸­å‚ä¸æŠ•ç¥¨</td></tr> <tr><td><strong>å­¦ä¹ è€…(<code>Learner</code>)-è§‚å¯Ÿè€…(<code>ObServer</code>)</strong></td> <td><code>ObServer</code>å¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥ï¼Œå°†å†™è¯·æ±‚è½¬å‘ç»™<code>leader</code>èŠ‚ç‚¹ã€‚ä½†<code>ObServer</code>ä¸å‚åŠ æŠ•ç¥¨è¿‡ç¨‹ï¼ŒåªåŒæ­¥<code>leader</code>çš„çŠ¶æ€ã€‚<code>ObServer</code>çš„ç›®çš„æ˜¯ä¸ºäº†æ‰©å±•ç³»ç»Ÿï¼Œæé«˜è¯»å–é€Ÿåº¦</td></tr> <tr><td><strong>å®¢æˆ·ç«¯(<code>Client</code>)</strong></td> <td>è¯·æ±‚å‘èµ·æ–¹</td></tr></tbody></table> <p>Â·<code>zab</code>å¹¿æ’­æ¨¡å¼å·¥ä½œåŸç†ï¼Œé€šè¿‡ç±»ä¼¼ä¸¤ç«¯å¼æäº¤åè®®çš„æ–¹å¼è§£å†³æ•°æ®ä¸€è‡´æ€§ï¼š</p> <p><img src="/znote/img/backend/zk/zookeeper-8.png" alt="zookeeper-8"></p> <ol><li><code>leader</code>ä»å®¢æˆ·ç«¯æ”¶<strong>åˆ°ä¸€ä¸ªå†™è¯·æ±‚</strong></li> <li><code>leader</code><strong>ç”Ÿæˆä¸€ä¸ªæ–°çš„äº‹åŠ¡</strong>å¹¶ä¸ºè¿™ä¸ªäº‹åŠ¡ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„<code>ZXID</code></li> <li><code>leader</code><strong>å°†äº‹åŠ¡æè®®(<code>propose</code>)å‘é€ç»™æ‰€æœ‰çš„<code>follows</code>èŠ‚ç‚¹</strong></li> <li><code>follower</code>èŠ‚ç‚¹å°†æ”¶åˆ°çš„äº‹åŠ¡è¯·æ±‚åŠ å…¥åˆ°æœ¬åœ°<strong>å†å²é˜Ÿåˆ—(<code>history queue</code>)ä¸­ï¼Œå¹¶å‘é€<code>ack</code>ç»™<code>leader</code></strong>ï¼Œè¡¨ç¤ºç¡®è®¤æè®®</li> <li>å½“<code>leader</code>æ”¶åˆ°å¤§å¤šæ•°<code>follower</code>(<strong>åŠæ•°ä»¥ä¸ŠèŠ‚ç‚¹</strong>)çš„<code>ack(acknowledgement)</code>ç¡®è®¤æ¶ˆæ¯ï¼Œ<code>leader</code>ä¼šæœ¬åœ°æäº¤ï¼Œå¹¶å‘é€<code>commit</code>è¯·æ±‚</li> <li>å½“<code>follower</code><strong>æ”¶åˆ°<code>commit</code>è¯·æ±‚æ—¶ï¼Œä»å†å²é˜Ÿåˆ—ä¸­å°†äº‹åŠ¡è¯·æ±‚<code>commit</code></strong></li></ol> <p>å› ä¸ºæ˜¯åŠæ•°ä»¥ä¸Šçš„ç»“ç‚¹å°±å¯ä»¥é€šè¿‡äº‹åŠ¡è¯·æ±‚ï¼Œæ‰€ä»¥å»¶è¿Ÿä¸é«˜</p> <h4 id="leaderé€‰ä¸¾"><a href="#leaderé€‰ä¸¾" class="header-anchor">#</a> leaderé€‰ä¸¾</h4> <p><strong>æœåŠ¡å™¨çŠ¶æ€</strong></p> <ul><li><strong><code>looking</code></strong>ï¼šå¯»æ‰¾<code>leader</code>çŠ¶æ€ã€‚å½“æœåŠ¡å™¨å¤„äºè¯¥çŠ¶æ€æ—¶ï¼Œå®ƒä¼šè®¤ä¸ºå½“å‰é›†ç¾¤ä¸­æ²¡æœ‰<code>leader</code>ï¼Œå› æ­¤éœ€è¦è¿›å…¥<code>leader</code>é€‰ä¸¾çŠ¶æ€</li> <li><strong><code>following</code></strong>ï¼šè·Ÿéšç€çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯<code>follower</code></li> <li><strong><code>observing</code></strong>ï¼šè§‚å¯Ÿè€…çŠ¶æ€ã€‚è¡¨æ˜å½“å‰æœåŠ¡å™¨è§’è‰²æ˜¯<code>observer</code></li></ul> <p>åˆ†ä¸ºä¸¤ç§é€‰ä¸¾ï¼Œ<strong>æœåŠ¡å™¨å¯åŠ¨æ—¶çš„é€‰ä¸¾</strong>å’Œ<strong>æœåŠ¡å™¨è¿è¡Œæ—¶æœŸçš„é€‰ä¸¾</strong></p> <p><strong>æœåŠ¡å™¨å¯åŠ¨æ—¶æœŸçš„leaderé€‰ä¸¾</strong></p> <p>åœ¨é›†ç¾¤åˆå§‹åŒ–èŠ‚ç‚¹ï¼Œå½“æœ‰ä¸€å°æœåŠ¡å™¨<code>server1</code>å¯åŠ¨æ—¶ï¼Œå…¶<strong>å•ç‹¬æ— æ³•è¿›è¡Œå’Œå®Œæˆ<code>leader</code>é€‰ä¸¾</strong>ï¼Œå½“ç¬¬äºŒå°æœåŠ¡å™¨<code>server2</code>å¯åŠ¨æ—¶ï¼Œæ­¤æ—¶ä¸¤å°åŠå…¶å¯ä»¥ç›¸äº’é€šä¿¡ï¼Œæ¯å°åŠå…¶éƒ½è¯•å›¾æ‰¾åˆ°<code>leader</code>ï¼Œ<strong>äºæ˜¯è¿›å…¥<code>leader</code>é€‰ä¸¾è¿‡ç¨‹</strong>ã€‚é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹ï¼š</p> <ol><li><p>æ¯ä¸ª<code>server</code>å‘å‡ºä¸€ä¸ªæŠ•ç¥¨ã€‚ç”±äºæ˜¯åˆå§‹çŠ¶æ€ï¼Œ<code>server1</code>å’Œ<code>server2</code>éƒ½ä¼šå°†è‡ªå·±ä½œä¸º<code>leader</code>æœåŠ¡å™¨æ¥è¿›è¡ŒæŠ•ç¥¨ï¼Œæ¯æ¬¡æŠ•ç¥¨éƒ½ä¼šåŒ…<strong>å«æ‰€æ¨ä¸¾çš„<code>myid</code>å’Œ<code>zxid</code>ï¼Œä½¿ç”¨(<code>myidï¼Œzxid</code>)</strong>ï¼Œæ­¤æ—¶<code>server1</code>çš„æŠ•ç¥¨ä¸º(1ï¼Œ0)ï¼Œ<code>server2</code>çš„æŠ•ç¥¨ä¸º(2ï¼Œ0)ï¼Œç„¶å<strong>å„è‡ªå°†è¿™ä¸ªæŠ•ç¥¨å‘ç»™é›†ç¾¤ä¸­çš„å…¶å®ƒæœºå™¨</strong></p></li> <li><p>é›†ç¾¤ä¸­çš„<strong>æ¯å°æœåŠ¡å™¨éƒ½æ¥æ”¶æ¥è‡ªé›†ç¾¤ä¸­å„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨</strong></p></li> <li><p><strong>å¤„ç†æŠ•ç¥¨</strong>ã€‚é’ˆå¯¹æ¯ä¸€ä¸ªæŠ•ç¥¨ï¼ŒæœåŠ¡å™¨éƒ½éœ€è¦å°†åˆ«äººçš„æŠ•ç¥¨å’Œè‡ªå·±çš„æŠ•ç¥¨è¿›è¡Œpkï¼Œè§„åˆ™å¦‚ä¸‹</p> <ul><li><p>ä¼˜å…ˆæ£€æŸ¥<code>zxid</code>ã€‚<code>zxid</code>æ¯”è¾ƒå¤§çš„æœåŠ¡å™¨ä¼˜å…ˆä½œä¸º<code>leader</code>(<strong><code>zxid</code>è¾ƒå¤§è€…ä¿å­˜çš„æ•°æ®æ›´å¤š</strong>)</p></li> <li><p>å¦‚æœ<code>zxid</code>ç›¸åŒã€‚é‚£ä¹ˆå°±æ¯”è¾ƒ<code>myid</code>ã€‚<code>myid</code>è¾ƒå¤§çš„æœåŠ¡å™¨ä½œä¸º<code>leader</code>æœåŠ¡å™¨</p> <p><strong>å¯¹äº<code>Server1</code>è€Œè¨€ï¼Œå®ƒçš„æŠ•ç¥¨æ˜¯(1ï¼Œ0)</strong>ï¼Œæ¥æ”¶<code>Server2</code>çš„æŠ•ç¥¨ä¸º(2ï¼Œ0)ï¼Œ<strong>é¦–å…ˆä¼šæ¯”è¾ƒä¸¤è€…çš„<code>zxid</code></strong>ï¼Œå‡ä¸º0ï¼Œ<strong>å†æ¯”è¾ƒ<code>myid</code></strong>ï¼Œæ­¤æ—¶<code>server2</code>çš„<code>myid</code>æœ€å¤§ï¼Œäºæ˜¯æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨ä¸º(2ï¼Œ0)ï¼Œç„¶åé‡æ–°æŠ•ç¥¨ï¼Œ<strong>å¯¹äºserver2è€Œè¨€ï¼Œæ— éœ€æ›´æ–°è‡ªå·±çš„æŠ•ç¥¨</strong>ï¼Œåªæ˜¯å†æ¬¡å‘é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨å‘å‡ºä¸Šä¸€æ¬¡æŠ•ç¥¨ä¿¡æ¯å³å¯</p></li></ul></li> <li><p><strong>ç»Ÿè®¡æŠ•ç¥¨</strong>ã€‚æ¯æ¬¡æŠ•ç¥¨åï¼ŒæœåŠ¡å™¨éƒ½ä¼šç»Ÿè®¡æŠ•ç¥¨ä¿¡æ¯ï¼Œåˆ¤æ–­æ˜¯å¦å·²ç»æœ‰<strong>è¿‡åŠæœºå™¨æ¥å—åˆ°ç›¸åŒçš„æŠ•ç¥¨ä¿¡æ¯</strong>ï¼Œå¯¹äº<code>server1ã€server2</code>è€Œè¨€ï¼Œéƒ½ç»Ÿè®¡å‡ºé›†ç¾¤ä¸­å·²ç»æœ‰ä¸¤å°æœºå™¨æ¥å—äº†(2ï¼Œ0)çš„æŠ•ç¥¨ä¿¡æ¯ï¼Œæ­¤æ—¶ä¾¿è®¤ä¸ºå·²ç»é€‰ä¸¾å‡ºäº†<code>leader</code></p></li> <li><p><strong>æ”¹å˜æœåŠ¡å™¨çŠ¶æ€</strong>ã€‚ä¸€æ—¦ç¡®å®šäº†<code>leader</code>,æ¯ä¸ªæœåŠ¡å™¨å°±ä¼šæ›´æ–°è‡ªå·±çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯<code>follower</code>ï¼Œé‚£ä¹ˆå°±å˜æ›´ä¸º<code>following</code>ï¼Œå¦‚æœæ˜¯<code>leader</code>ï¼Œå°±å˜æ›´ä¸º<code>leading</code></p></li></ol> <p><strong>ä¸¾ä¾‹ï¼šå¦‚æœæˆ‘ä»¬æœ‰ä¸‰ä¸ªèŠ‚ç‚¹çš„é›†ç¾¤ï¼Œ1ï¼Œ2ï¼Œ3ï¼Œå¯åŠ¨ 1 å’Œ 2 åï¼Œ2 ä¸€å®šä¼šæ˜¯ <code>leader</code>ï¼Œ3 å†åŠ å…¥ä¸ä¼šè¿›è¡Œé€‰ä¸¾ï¼Œè€Œæ˜¯ç›´æ¥æˆä¸º<code>follower</code></strong>â€”â€” ä»”ç»†è§‚å¯Ÿ ä¸€å°<code>zk</code>æ— æ³•é›†ç¾¤ï¼Œæ²¡æœ‰<code>leader</code></p> <p><strong>æœåŠ¡å™¨è¿è¡Œæ—¶æœŸé€‰ä¸¾</strong></p> <p>åœ¨<code>zookeeper</code>è¿è¡ŒæœŸé—´ï¼Œ<code>leader</code>ä¸é<code>leader</code>æœåŠ¡å™¨å„å¸å…¶èŒï¼Œå³ä½¿å½“æœ‰é<code>leader</code>æœåŠ¡å™¨å®•æœºæˆ–è€…æ–°åŠ å…¥ï¼Œæ­¤æ—¶ä¹Ÿä¸ä¼šå½±å“<code>leader</code>ï¼Œä½†æ˜¯ä¸€æ—¦<code>leader</code>æœåŠ¡å™¨æŒ‚äº†ï¼Œé‚£ä¹ˆæ•´ä¸ªé›†ç¾¤å°†æš‚åœå¯¹å¤–æœåŠ¡ï¼Œè¿›å…¥æ–°ä¸€è½®<code>leader</code>é€‰ä¸¾ï¼Œå…¶è¿‡ç¨‹å’Œå¯åŠ¨æ—¶æœŸçš„<code>leader</code>é€‰ä¸¾è¿‡ç¨‹åŸºæœ¬ä¸€è‡´</p> <p>å‡è®¾æ­£åœ¨è¿è¡Œçš„æœ‰<code>server1</code>ã€<code>server2</code>ã€<code>server3</code>ä¸‰å°æœåŠ¡å™¨ï¼Œå½“å‰<code>leader</code>æ˜¯<code>server2</code>ï¼Œè‹¥æŸä¸€æ—¶åˆ»<code>leader</code>æŒ‚äº†ï¼Œæ­¤æ—¶ä¾¿å¼€å§‹<code>Leader</code>é€‰ä¸¾ã€‚é€‰ä¸¾è¿‡ç¨‹å¦‚ä¸‹</p> <ol><li>å˜æ›´çŠ¶æ€ã€‚<strong><code>leader</code>æŒ‚åï¼Œä½™ä¸‹çš„æœåŠ¡å™¨éƒ½ä¼šå°†è‡ªå·±çš„æœåŠ¡å™¨çŠ¶æ€å˜æ›´ä¸º<code>looking</code></strong>ï¼Œç„¶åå¼€å§‹è¿›å…¥<code>leader</code>é€‰ä¸¾è¿‡ç¨‹</li> <li>æ¯ä¸ª<code>server</code>å‘å‡ºä¸€ä¸ªæŠ•ç¥¨ã€‚åœ¨è¿è¡ŒæœŸé—´ï¼Œ<strong>æ¯ä¸ªæœåŠ¡å™¨ä¸Šçš„<code>zxid</code>å¯èƒ½ä¸åŒ</strong>ï¼Œæ­¤æ—¶å‡å®š<code>server1</code>çš„<code>zxid</code>ä¸º<code>122</code>ï¼Œ<code>server3</code>çš„<code>zxid</code>ä¸º<code>122</code>ï¼Œ<strong>åœ¨ç¬¬ä¸€è½®æŠ•ç¥¨ä¸­ï¼Œserver1å’Œserver3éƒ½ä¼šæŠ•è‡ªå·±</strong>ï¼Œäº§ç”ŸæŠ•ç¥¨(1ï¼Œ122)ï¼Œ(3ï¼Œ122)ï¼Œç„¶å<strong>å„è‡ªå°†æŠ•ç¥¨å‘é€ç»™é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨</strong></li> <li><strong>æ¥æ”¶æ¥è‡ªå„ä¸ªæœåŠ¡å™¨çš„æŠ•ç¥¨</strong>ã€‚ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ</li> <li><strong>å¤„ç†æŠ•ç¥¨</strong>ã€‚ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒï¼Œæ­¤æ—¶ï¼Œ<code>server3</code>å°†ä¼šæˆä¸º<code>leader</code></li> <li><strong>ç»Ÿè®¡æŠ•ç¥¨</strong>ã€‚ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ</li> <li><strong>æ”¹å˜æœåŠ¡å™¨çš„çŠ¶æ€</strong>ã€‚ä¸å¯åŠ¨æ—¶è¿‡ç¨‹ç›¸åŒ</li></ol> <h4 id="observerè§’è‰²åŠå…¶é…ç½®"><a href="#observerè§’è‰²åŠå…¶é…ç½®" class="header-anchor">#</a> observerè§’è‰²åŠå…¶é…ç½®</h4> <p><code>zookeeper</code>å®˜ç½‘â€”â€”<code>Observers Guide</code><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperObservers.html" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperObservers.html<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>å°½ç®¡<code>ZooKeeper</code>é€šè¿‡ä½¿ç”¨å®¢æˆ·ç«¯ç›´æ¥è¿æ¥åˆ°è¯¥é›†åˆçš„æŠ•ç¥¨æˆå‘˜è¡¨ç°è‰¯å¥½ï¼Œä½†æ˜¯æ­¤ä½“ç³»ç»“æ„ä½¿å…¶å¾ˆéš¾æ‰©å±•åˆ°å¤§é‡å®¢æˆ·ç«¯ã€‚é—®é¢˜åœ¨äºï¼Œéšç€æˆ‘ä»¬æ·»åŠ æ›´å¤šçš„æŠ•ç¥¨æˆå‘˜ï¼Œå†™å…¥æ€§èƒ½ä¼šä¸‹é™ã€‚è¿™æ˜¯ç”±äºä»¥ä¸‹äº‹å®ï¼šå†™æ“ä½œéœ€è¦ï¼ˆé€šå¸¸ï¼‰é›†åˆä¸­è‡³å°‘ä¸€åŠèŠ‚ç‚¹çš„åŒæ„ï¼Œå› æ­¤ï¼Œéšç€æ·»åŠ æ›´å¤šçš„æŠ•ç¥¨è€…ï¼ŒæŠ•ç¥¨çš„æˆæœ¬å¯èƒ½ä¼šæ˜¾ç€å¢åŠ ã€‚</p> <p>æˆ‘ä»¬å¼•å…¥äº†ä¸€ç§ç§°ä¸º<em>Observer</em>çš„æ–°å‹<code>ZooKeeper</code>èŠ‚ç‚¹ï¼Œè¯¥èŠ‚ç‚¹æœ‰åŠ©äºè§£å†³æ­¤é—®é¢˜å¹¶è¿›ä¸€æ­¥æé«˜<code>ZooKeeper</code>çš„å¯ä¼¸ç¼©æ€§ã€‚è§‚å¯Ÿå‘˜æ˜¯åˆæ³•çš„éæŠ•ç¥¨æˆå‘˜ï¼Œä»–ä»¬ä»…å¬å–æŠ•ç¥¨ç»“æœï¼Œè€Œå¬ä¸åˆ°æŠ•ç¥¨ç»“æœã€‚é™¤äº†è¿™ç§ç®€å•çš„åŒºåˆ«ä¹‹å¤–ï¼Œè§‚å¯Ÿè€…çš„åŠŸèƒ½ä¸è·Ÿéšè€…çš„åŠŸèƒ½å®Œå…¨ç›¸åŒ-å®¢æˆ·ç«¯å¯ä»¥è¿æ¥åˆ°è§‚å¯Ÿè€…ï¼Œå¹¶å‘å…¶å‘é€è¯»å†™è¯·æ±‚ã€‚è§‚å¯Ÿè€…åƒè¿½éšè€…ä¸€æ ·å°†è¿™äº›è¯·æ±‚è½¬å‘ç»™é¢†å¯¼è€…ï¼Œä½†æ˜¯ä»–ä»¬åªæ˜¯ç­‰å¾…å¬å–æŠ•ç¥¨ç»“æœã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸å½±å“æŠ•ç¥¨æ•ˆæœçš„æƒ…å†µä¸‹å°½å¯èƒ½å¢åŠ è§‚å¯Ÿå‘˜çš„æ•°é‡ã€‚</p> <p>è§‚å¯Ÿè€…è¿˜æœ‰å…¶ä»–ä¼˜ç‚¹ã€‚å› ä¸ºä»–ä»¬ä¸æŠ•ç¥¨ï¼Œæ‰€ä»¥å®ƒä»¬ä¸æ˜¯<code>ZooKeeper</code>é€‰ä¸¾ä¸­çš„å…³é”®éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå®ƒä»¬å¯ä»¥åœ¨ä¸æŸå®³<code>ZooKeeper</code>æœåŠ¡å¯ç”¨æ€§çš„æƒ…å†µä¸‹å‘ç”Ÿæ•…éšœæˆ–ä¸ç¾¤é›†æ–­å¼€è¿æ¥ã€‚ç»™ç”¨æˆ·å¸¦æ¥çš„å¥½å¤„æ˜¯ï¼Œè§‚å¯Ÿè€…å¯ä»¥é€šè¿‡æ¯”è·Ÿéšè€…æ›´ä¸å¯é çš„ç½‘ç»œé“¾æ¥è¿›è¡Œè¿æ¥ã€‚å®é™…ä¸Šï¼Œè§‚å¯Ÿè€…å¯ç”¨äºä¸å¦ä¸€ä¸ªæ•°æ®ä¸­å¿ƒçš„<code>ZooKeeper</code>æœåŠ¡å™¨è¿›è¡Œå¯¹è¯ã€‚è§‚å¯Ÿè€…çš„å®¢æˆ·ç«¯å°†çœ‹åˆ°å¿«é€Ÿè¯»å–ï¼Œå› ä¸ºæ‰€æœ‰è¯»å–å‡åœ¨æœ¬åœ°æä¾›ï¼Œå¹¶ä¸”ç”±äºç¼ºå°‘è¡¨å†³åè®®è€Œéœ€è¦çš„æ¶ˆæ¯æ•°é‡è¾ƒå°ï¼Œå› æ­¤å†™å…¥ä¼šå¯¼è‡´ç½‘ç»œæµé‡æœ€å°</p> <p><code>ovserver</code>è§’è‰²<strong>ç‰¹ç‚¹</strong>ï¼š</p> <ol><li><strong>ä¸å‚ä¸é›†ç¾¤çš„<code>leader</code>é€‰ä¸¾</strong></li> <li><strong>ä¸å‚ä¸é›†ç¾¤ä¸­å†™æ•°æ®æ—¶çš„<code>ack</code>åé¦ˆ</strong></li></ol> <p>ä¸ºäº†ä½¿ç”¨<code>observer</code>è§’è‰²ï¼Œåœ¨ä»»ä½•æƒ³å˜æˆ<code>observer</code>è§’è‰²çš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥å¦‚ä¸‹é…ç½®ï¼š</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">peerType</span><span class="token operator">=</span>observer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>å¹¶åœ¨æ‰€æœ‰<code>server</code>çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æˆ<code>observer</code>æ¨¡å¼çš„<code>server</code>çš„é‚£è¡Œé…ç½®è¿½åŠ ***<code>:observer</code>***ï¼Œä¾‹å¦‚</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token assign-left variable">server.1</span><span class="token operator">=</span><span class="token number">192.168</span>.133.133:2287:3387  <span class="token comment"># æ³¨æ„ç«¯å£å·  </span>
<span class="token assign-left variable">server.2</span><span class="token operator">=</span><span class="token number">192.168</span>.133.133:2288:3388
<span class="token assign-left variable">server.3</span><span class="token operator">=</span><span class="token number">192.168</span>.133.133:2289:3389:observer
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>æ³¨æ„<code>2n+1</code>åŸåˆ™â€”â€”<code>é›†ç¾¤æ­å»º</code></p> <h4 id="apiè¿æ¥é›†ç¾¤"><a href="#apiè¿æ¥é›†ç¾¤" class="header-anchor">#</a> APIè¿æ¥é›†ç¾¤</h4> <p><code>Zookeeper(String connectionString, int sessionTimeout, Watcher watcher)</code></p> <ul><li><code>connectionString</code> ï¼š<code>zookeeper</code>é›†åˆä¸»æœº</li> <li><code>sessionTimeout</code>ï¼šä¼šè¯è¶…æ—¶(ä»¥æ¯«ç§’ä¸ºå•ä½)</li> <li><code>watcher</code>ï¼šå®ç°&quot;ç›‘å¬å™¨&quot;ç•Œé¢çš„å¯¹è±¡ã€‚<code>zookeeper</code>é›†åˆé€šè¿‡ç›‘è§†å™¨å¯¹è±¡è¿”å›è¿æ¥çŠ¶æ€</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ZooKeeper</span> connection <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ZooKeeper</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">,</span> watchedEvent <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>watchedEvent<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">Watcher<span class="token punctuation">.</span>Event<span class="token punctuation">.</span>KeeperState<span class="token punctuation">.</span>SyncConnected</span><span class="token punctuation">)</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¿æ¥æˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        connection<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">,</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>connection<span class="token punctuation">.</span><span class="token function">getSessionId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h2 id="curatorä»‹ç»"><a href="#curatorä»‹ç»" class="header-anchor">#</a> curatorä»‹ç»</h2> <p><a href="https://blog.csdn.net/wo541075754/article/details/68067872" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/wo541075754/article/details/68067872<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å…³äºç¬¬ä¸‰æ–¹å®¢æˆ·ç«¯çš„å°ä»‹ç»</p> <p><code>zkClient</code>æœ‰å¯¹<code>dubbo</code>çš„ä¸€äº›æ“ä½œæ”¯æŒï¼Œä½†æ˜¯<code>zkClient</code>å‡ ä¹æ²¡æœ‰æ–‡æ¡£ï¼Œä¸‹é¢æ˜¯<code>curator</code></p> <p><strong>curatorç®€ä»‹</strong></p> <p><code>curator</code>æ˜¯<code>Netflix</code>å…¬å¸å¼€æºçš„ä¸€ä¸ª <code>zookeeper</code>å®¢æˆ·ç«¯ï¼ŒåæçŒ®ç»™ <code>apache</code>,ï¼Œ<code>curator</code>æ¡†æ¶åœ¨<code>zookeeper</code>åŸç”Ÿ<code>API</code>æ¥å£ä¸Šè¿›è¡Œäº†åŒ…è£…ï¼Œè§£å†³äº†å¾ˆå¤š<code>zooKeeper</code>å®¢æˆ·ç«¯éå¸¸åº•å±‚çš„ç»†èŠ‚å¼€å‘ã€‚æä¾›<code>zooKeeper</code>å„ç§åº”ç”¨åœºæ™¯(æ¯”å¦‚:åˆ†å¸ƒå¼é”æœåŠ¡ã€é›†ç¾¤é¢†å¯¼é€‰ä¸¾ã€å…±äº«è®¡æ•°å™¨ã€ç¼“å­˜æœºåˆ¶ã€åˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰çš„æŠ½è±¡å°è£…ï¼Œå®ç°äº†<code>Fluent</code>é£æ ¼çš„APlæ¥å£ï¼Œæ˜¯æœ€å¥½ç”¨ï¼Œæœ€æµè¡Œçš„<code>zookeeper</code>çš„å®¢æˆ·ç«¯</p> <p>åŸç”Ÿ<code>zookeeperAPI</code>çš„ä¸è¶³</p> <ul><li>è¿æ¥å¯¹è±¡å¼‚æ­¥åˆ›å»ºï¼Œéœ€è¦å¼€å‘äººå‘˜è‡ªè¡Œç¼–ç ç­‰å¾…</li> <li>è¿æ¥æ²¡æœ‰è‡ªåŠ¨é‡è¿è¶…æ—¶æœºåˆ¶</li> <li>watcherä¸€æ¬¡æ³¨å†Œç”Ÿæ•ˆä¸€æ¬¡</li> <li>ä¸æ”¯æŒé€’å½’åˆ›å»ºæ ‘å½¢èŠ‚ç‚¹</li></ul> <p><code>curator</code>ç‰¹ç‚¹</p> <ul><li>è§£å†³<code>session</code>ä¼šè¯è¶…æ—¶é‡è¿</li> <li><code>watcher</code>åå¤æ³¨å†Œ</li> <li>ç®€åŒ–å¼€å‘<code>api</code></li> <li>éµå¾ª<code>Fluent</code>é£æ ¼<code>API</code></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>    <span class="token comment">&lt;!-- Zookeeper --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.4.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-framework<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclustions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclustion</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
               <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>zookeeper<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclustion</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclustions</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.curator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>curator-recipes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="åŸºç¡€ç”¨æ³•"><a href="#åŸºç¡€ç”¨æ³•" class="header-anchor">#</a> åŸºç¡€ç”¨æ³•</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        <span class="token class-name">CuratorFramework</span> client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹</span>
                <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><code>session</code>é‡è¿ç­–ç•¥
<ul><li><code>RetryPolicy retry Policy = new RetryOneTime(3000);</code> <ul><li>è¯´æ˜ï¼šä¸‰ç§’åé‡è¿ä¸€æ¬¡ï¼Œåªé‡è¿ä¸€æ¬¡</li></ul></li> <li><code>RetryPolicy retryPolicy = new RetryNTimes(3,3000);</code> <ul><li>è¯´æ˜ï¼šæ¯ä¸‰ç§’é‡è¿ä¸€æ¬¡ï¼Œé‡è¿ä¸‰æ¬¡</li></ul></li> <li><code>RetryPolicy retryPolicy = new RetryUntilElapsed(1000,3000);</code> <ul><li>è¯´æ˜ï¼šæ¯ä¸‰ç§’é‡è¿ä¸€æ¬¡ï¼Œæ€»ç­‰å¾…æ—¶é—´è¶…è¿‡ä¸ª<code>10</code>ç§’ååœæ­¢é‡è¿</li></ul></li> <li><code>RetryPolicy retryPolicy = new ExponentialBackoffRetry(1000,3)</code> <ul><li>è¯´æ˜ï¼šè¿™ä¸ªç­–ç•¥çš„é‡è¯•é—´éš”ä¼šè¶Šæ¥è¶Šé•¿
<ul><li>å…¬å¼ï¼š<code>baseSleepTImeMs * Math.max(1,random.nextInt(1 &lt;&lt; (retryCount + 1)))</code> <ul><li><code>baseSleepTimeMs</code> = <code>1000</code> ä¾‹å­ä¸­çš„å€¼</li> <li><code>maxRetries</code> = <code>3</code> ä¾‹å­ä¸­çš„å€¼</li></ul></li></ul></li></ul></li></ul></li></ul> <h4 id="åˆ›å»º-2"><a href="#åˆ›å»º-2" class="header-anchor">#</a> åˆ›å»º</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> curatorGettingStart <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>

    <span class="token comment">// idsæƒé™</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">create1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–°å¢èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">EPHEMERAL</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„aclæƒé™åˆ—è¡¨</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">)</span>
                <span class="token comment">// arg1ï¼šèŠ‚ç‚¹è·¯å¾„ï¼Œarg2ï¼šèŠ‚ç‚¹æ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node1&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// è‡ªå®šä¹‰æƒé™</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">create2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span>ACL<span class="token punctuation">&gt;</span></span> acls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Id</span> id <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Id</span><span class="token punctuation">(</span><span class="token string">&quot;world&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;anyone&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        acls<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Perms</span><span class="token punctuation">.</span><span class="token constant">READ</span><span class="token punctuation">,</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ–°å¢èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">EPHEMERAL</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„aclæƒé™åˆ—è¡¨</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span>acls<span class="token punctuation">)</span>
                <span class="token comment">// arg1ï¼šèŠ‚ç‚¹è·¯å¾„ï¼Œarg2ï¼šèŠ‚ç‚¹æ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node2&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// é€’å½’åˆ›å»º</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">create3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–°å¢èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// é€’å½’åˆ›å»º</span>
                <span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">EPHEMERAL</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„aclæƒé™åˆ—è¡¨</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">)</span>
                <span class="token comment">// arg1ï¼šèŠ‚ç‚¹è·¯å¾„ï¼Œarg2ï¼šèŠ‚ç‚¹æ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node2/nodex&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// é€’å½’åˆ›å»º</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">create4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// æ–°å¢èŠ‚ç‚¹</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

                <span class="token punctuation">.</span><span class="token function">creatingParentsIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„ç±»å‹</span>
                <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">EPHEMERAL</span><span class="token punctuation">)</span>
                <span class="token comment">// èŠ‚ç‚¹çš„aclæƒé™åˆ—è¡¨</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">)</span>
                <span class="token comment">// å¼‚æ­¥</span>
                <span class="token punctuation">.</span><span class="token function">inBackground</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BackgroundCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> curatorFramework<span class="token punctuation">,</span> <span class="token class-name">CuratorEvent</span> curatorEvent<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å¼‚æ­¥åˆ›å»ºæˆåŠŸ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token comment">// arg1ï¼šèŠ‚ç‚¹è·¯å¾„ï¼Œarg2ï¼šèŠ‚ç‚¹æ•°æ®</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node2/nodex&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        <span class="token class-name">CuratorFramework</span> client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹</span>
                <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;create&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        create1();</span>
<span class="token comment">//        create2();</span>
<span class="token comment">//        create3();</span>
        <span class="token function">create4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br></div></div><h4 id="ä¿®æ”¹"><a href="#ä¿®æ”¹" class="header-anchor">#</a> ä¿®æ”¹</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> curatorGettingStart <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">set1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¿®æ”¹èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ç‰ˆæœ¬</span>
                <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hadoop1&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">set2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¿®æ”¹èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hadoop2&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">set3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// ä¿®æ”¹èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token comment">// å¼‚æ­¥</span>
                <span class="token punctuation">.</span><span class="token function">inBackground</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BackgroundCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> curatorFramework<span class="token punctuation">,</span> <span class="token class-name">CuratorEvent</span> curatorEvent<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span><span class="token punctuation">(</span>curatorEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CuratorEventType</span><span class="token punctuation">.</span><span class="token constant">SET_DATA</span><span class="token punctuation">)</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>curatorEvent<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span> <span class="token string">&quot;    &quot;</span> <span class="token operator">+</span>curatorEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/hadoop&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;hadoop3&quot;</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
                <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        set1();</span>
        <span class="token function">set2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        set3();</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h4 id="åˆ é™¤-2"><a href="#åˆ é™¤-2" class="header-anchor">#</a> åˆ é™¤</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> curatorGettingStart <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delete1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ é™¤èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;node1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delete2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ é™¤èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ç‰ˆæœ¬</span>
                <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;node2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delete3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ é™¤èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// é€’å½’åˆ é™¤</span>
                <span class="token punctuation">.</span><span class="token function">deletingChildrenIfNeeded</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;node3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">delete4</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// åˆ é™¤èŠ‚ç‚¹</span>
        client<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withVersion</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
                <span class="token comment">// å¼‚æ­¥</span>
                <span class="token punctuation">.</span><span class="token function">inBackground</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BackgroundCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">processResult</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> curatorFramework<span class="token punctuation">,</span> <span class="token class-name">CuratorEvent</span> curatorEvent<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>curatorEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token class-name">CuratorEventType</span><span class="token punctuation">.</span><span class="token constant">DELETE</span><span class="token punctuation">)</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>curatorEvent<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;    &quot;</span> <span class="token operator">+</span> curatorEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;node3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
                <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;delete&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//        delete1();</span>
        <span class="token comment">//        delete2();</span>
        <span class="token comment">//        delete3();</span>
        <span class="token comment">// delete4();</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br></div></div><h4 id="è¯»å–èŠ‚ç‚¹"><a href="#è¯»å–èŠ‚ç‚¹" class="header-anchor">#</a> è¯»å–èŠ‚ç‚¹</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> curatorGettingStart <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span> 
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">get1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–æ•°æ®</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">get2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Stat</span> stat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–æ•°æ®</span>
        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">storingStatIn</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span><span class="token punctuation">(</span>bytes<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stat<span class="token punctuation">.</span><span class="token function">getCzxid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">get3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–æ•°æ®</span>
        client<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">inBackground</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> curatorFramework<span class="token punctuation">,</span> <span class="token class-name">CuratorEvent</span> curatorEvent<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>curatorEvent<span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;  &quot;</span> <span class="token operator">+</span> curatorEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/node&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
                <span class="token punctuation">.</span><span class="token function">namespace</span><span class="token punctuation">(</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">get1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">get2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">get3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><h4 id="è¯»å–å­èŠ‚ç‚¹"><a href="#è¯»å–å­èŠ‚ç‚¹" class="header-anchor">#</a> è¯»å–å­èŠ‚ç‚¹</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code> <span class="token keyword">public</span> <span class="token keyword">class</span> curatorGettingStart <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>  
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getChildren1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–æ•°æ®</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> strings <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        strings<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">getChildren2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span>  <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–æ•°æ®</span>
        client<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">inBackground</span><span class="token punctuation">(</span><span class="token punctuation">(</span>curatorFramework<span class="token punctuation">,</span> curatorEvent<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                    curatorEvent<span class="token punctuation">.</span><span class="token function">getChildren</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token operator">::</span><span class="token function">println</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/get&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;------------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
<span class="token comment">//                .namespace(&quot;get&quot;)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">getChildren1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">getChildren2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h4 id="watcher"><a href="#watcher" class="header-anchor">#</a> watcher</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WatcherTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">watcher1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// arg1 curatorçš„å®¢æˆ·ç«¯</span>
        <span class="token comment">// arg2 ç›‘è§†çš„è·¯å¾„</span>
        <span class="token class-name">NodeCache</span> nodeCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">NodeCache</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> <span class="token string">&quot;/watcher&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨</span>
        nodeCache<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        nodeCache<span class="token punctuation">.</span><span class="token function">getListenable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">NodeCacheListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token comment">// èŠ‚ç‚¹å˜åŒ–æ—¶çš„å›è°ƒæ–¹æ³•</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">nodeChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token comment">// è·¯å¾„</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>nodeCache<span class="token punctuation">.</span><span class="token function">getCurrentData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;  &quot;</span> <span class="token operator">+</span> nodeCache<span class="token punctuation">.</span><span class="token function">getCurrentData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// è¾“å‡ºèŠ‚ç‚¹å†…å®¹</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>nodeCache<span class="token punctuation">.</span><span class="token function">getCurrentData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ³¨å†Œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ—¶é—´çª—å†…å¯ä»¥ä¸€ç›´ç›‘å¬</span>
        <span class="token comment">//        TimeUnit.SECONDS.sleep(1000);</span>
        <span class="token comment">//å…³ é—­</span>
        nodeCache<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">watcher2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// arg1 å®¢æˆ·ç«¯</span>
        <span class="token comment">// arg2 è·¯å¾„</span>
        <span class="token comment">// arg3 äº‹ä»¶é’Ÿæ˜¯å¦å¯ä»¥è·å–èŠ‚ç‚¹æ•°æ®</span>
        <span class="token class-name">PathChildrenCache</span> pathChildrenCache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PathChildrenCache</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> <span class="token string">&quot;/watcher&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¯åŠ¨</span>
        pathChildrenCache<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pathChildrenCache<span class="token punctuation">.</span><span class="token function">getListenable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PathChildrenCacheListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token comment">// èŠ‚ç‚¹å˜åŒ–æ—¶çš„å›è°ƒæ–¹æ³•</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">childEvent</span><span class="token punctuation">(</span><span class="token class-name">CuratorFramework</span> curatorFramework<span class="token punctuation">,</span> <span class="token class-name">PathChildrenCacheEvent</span> pathChildrenCacheEvent<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>pathChildrenCacheEvent <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// è·å–å­èŠ‚ç‚¹æ•°æ®</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>pathChildrenCacheEvent<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// è·¯å¾„</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pathChildrenCacheEvent<span class="token punctuation">.</span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// äº‹ä»¶ç±»å‹</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>pathChildrenCacheEvent<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ—¶é—´çª—å†…å¯ä»¥ä¸€ç›´ç›‘å¬</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//å…³ é—­</span>
        pathChildrenCache<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
                <span class="token comment">//                .namespace(&quot;get&quot;)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//        watcher1();</span>
        <span class="token function">watcher2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br></div></div><h4 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="header-anchor">#</a> äº‹åŠ¡</h4> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CuratorTransaction</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span><span class="token punctuation">{</span>
        <span class="token comment">/*client.inTransaction()
                .create()
                    .withMode(CreateMode.PERSISTENT)
                    .withACL(ZooDefs.Ids.OPEN_ACL_UNSAFE)
                    .forPath(&quot;/transaction&quot;,new byte[0])
                .and()
                .setData()
                    .forPath(&quot;/setData/transaction&quot;,new byte[0])
                .and()
                .commit();*/</span>
        client<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withMode</span><span class="token punctuation">(</span><span class="token class-name">CreateMode</span><span class="token punctuation">.</span><span class="token constant">PERSISTENT</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">withACL</span><span class="token punctuation">(</span><span class="token class-name">ZooDefs<span class="token punctuation">.</span>Ids</span><span class="token punctuation">.</span><span class="token constant">OPEN_ACL_UNSAFE</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/transaction&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">setData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">forPath</span><span class="token punctuation">(</span><span class="token string">&quot;/setData/transaction&quot;</span><span class="token punctuation">,</span><span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
                <span class="token comment">//                .namespace(&quot;get&quot;)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">transaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h4 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="header-anchor">#</a> åˆ†å¸ƒå¼é”</h4> <ul><li><code>InterProcessMutex</code>ï¼šåˆ†å¸ƒå¼å¯é‡å…¥æ’å®ƒé”</li> <li><code>InterProcessReadWriteLock</code>ï¼šåˆ†å¸ƒå¼è¯»å†™é”</li></ul> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CuratorDistributeLock</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">CuratorFramework</span> client<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">interProcessMutex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ’ä»–é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–ä¸€ä¸ªåˆ†å¸ƒå¼æ’ä»–é”</span>
        <span class="token class-name">InterProcessMutex</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InterProcessMutex</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> <span class="token string">&quot;/lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¼€å¯ä¸¤ä¸ªè¿›ç¨‹æµ‹è¯•ï¼Œä¼šå‘ç°ï¼šå¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼æ’å®ƒé”è·å–äº†é”ï¼Œé‚£ä¹ˆç›´åˆ°é”é‡Šæ”¾ä¸ºæ­¢æ•°æ®éƒ½ä¸ä¼šè¢«ä¾µæ‰°</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–é”ä¸­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ“ä½œä¸­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        lock<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é‡Šæ”¾é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">interProcessReadWriteLock1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;å†™é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ†å¸ƒå¼è¯»å†™é”</span>
        <span class="token class-name">InterProcessReadWriteLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InterProcessReadWriteLock</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> <span class="token string">&quot;/lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¼€å¯ä¸¤ä¸ªè¿›ç¨‹æµ‹è¯•ï¼Œè§‚å¯Ÿåˆ°å†™å†™äº’æ–¥ï¼Œç‰¹æ€§åŒæ’å®ƒé”</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–é”ä¸­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ“ä½œä¸­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        lock<span class="token punctuation">.</span><span class="token function">writeLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é‡Šæ”¾é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">interProcessReadWriteLock2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è¯»é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// åˆ†å¸ƒå¼è¯»å†™é”</span>
        <span class="token class-name">InterProcessReadWriteLock</span> lock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">InterProcessReadWriteLock</span><span class="token punctuation">(</span>client<span class="token punctuation">,</span> <span class="token string">&quot;/lock1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// å¼€å¯ä¸¤ä¸ªè¿›ç¨‹æµ‹è¯•ï¼Œè§‚å¯Ÿå¾—åˆ°è¯»è¯»å…±äº«ï¼Œä¸¤ä¸ªè¿›ç¨‹å¹¶å‘è¿›è¡Œï¼Œæ³¨æ„å¹¶å‘å’Œå¹¶è¡Œæ˜¯ä¸¤ä¸ªæ¦‚å¿µï¼Œ(å¹¶å‘æ˜¯çº¿ç¨‹å¯åŠ¨æ—¶é—´æ®µä¸ä¸€å®šä¸€è‡´ï¼Œå¹¶è¡Œæ˜¯æ—¶é—´è½´ä¸€è‡´çš„)</span>
        <span class="token comment">// å†æµ‹è¯•ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªè¯»ï¼Œä¸€ä¸ªå†™ï¼Œä¹Ÿä¼šå‡ºç°äº’æ–¥ç°è±¡</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;è·å–é”ä¸­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;æ“ä½œä¸­&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        lock<span class="token punctuation">.</span><span class="token function">readLock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;é‡Šæ”¾é”&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token comment">// å·¥å‚åˆ›å»ºï¼Œfluenté£æ ¼</span>
        client <span class="token operator">=</span> <span class="token class-name">CuratorFrameworkFactory</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// ipç«¯å£å·</span>
                <span class="token punctuation">.</span><span class="token function">connectString</span><span class="token punctuation">(</span><span class="token string">&quot;192.168.133.133:2181,192.168.133.133:2182,192.168.133.133:2183&quot;</span><span class="token punctuation">)</span>
                <span class="token comment">// ä¼šè¯è¶…æ—¶</span>
                <span class="token punctuation">.</span><span class="token function">sessionTimeoutMs</span><span class="token punctuation">(</span><span class="token number">5000</span><span class="token punctuation">)</span>
                <span class="token comment">// é‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œæ˜¯è¶…æ—¶å1000æ¯«ç§’é‡è¯•ä¸€æ¬¡</span>
                <span class="token punctuation">.</span><span class="token function">retryPolicy</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RetryOneTime</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token comment">// åç§°ç©ºé—´ï¼Œåœ¨æ“ä½œèŠ‚ç‚¹çš„æ—¶å€™ï¼Œä¼šä»¥è¿™ä¸ªä¸ºçˆ¶èŠ‚ç‚¹,å¯é€‰æ“ä½œ</span>
                <span class="token comment">//                .namespace(&quot;get&quot;)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//        interProcessMutex();</span>
<span class="token comment">//                interProcessReadWriteLock1();</span>
        <span class="token function">interProcessReadWriteLock2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;æ“ä½œå®Œæˆ&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h2 id="å››å­—ç›‘æ§å‘½ä»¤-é…ç½®å±æ€§"><a href="#å››å­—ç›‘æ§å‘½ä»¤-é…ç½®å±æ€§" class="header-anchor">#</a> å››å­—ç›‘æ§å‘½ä»¤/é…ç½®å±æ€§</h2> <p><code>zookeeper</code>æ–‡æ¡£â€”â€”<code>administrator's Guide</code>â€”â€”<a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_zkCommands" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_zkCommands<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> å››å­—å‘½ä»¤</p> <p><a href="https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_configuration" target="_blank" rel="noopener noreferrer">https://zookeeper.apache.org/doc/r3.4.14/zookeeperAdmin.html#sc_configuration<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> é…ç½®å±æ€§</p> <p><code>zookeeper</code>æ”¯æŒæŸäº›ç‰¹å®šçš„å››å­—å‘½ä»¤ä¸å…¶çš„äº¤äº’ã€‚å®ƒä»¬å¤§å¤šæ•°æ˜¯æŸ¥è¯¢å‘½ä»¤ï¼Œç”¨æ¥è·å–<code>zookeeper</code>æœåŠ¡çš„å½“å‰çŠ¶æ€åŠç›¸å…³ä¿¡æ¯ã€‚ç”¨æˆ·å†å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡<code>telnet</code>æˆ–<code>nc</code>å‘<code>zookeeper</code>æäº¤ç›¸åº”çš„å‘½ä»¤ã€‚<code>zookeeper</code>å¸¸ç”¨å››å­—å‘½ä»¤è§ä¸‹è¡¨æ‰€ç¤ºï¼š</p> <table><thead><tr><th>å‘½ä»¤</th> <th>æè¿°</th></tr></thead> <tbody><tr><td><code>conf</code></td> <td>è¾“å‡ºç›¸å…³æœåŠ¡é…ç½®çš„è¯¦ç»†ä¿¡æ¯ã€‚æ¯”å¦‚ç«¯å£å·ã€<code>zk</code>æ•°æ®ä»¥åŠæ—¥å¿—é…ç½®è·¯å¾„ã€æœ€å¤§è¿æ¥æ•°ï¼Œ<code>session</code>è¶…æ—¶ã€<code>serverId</code>ç­‰</td></tr> <tr><td><code>cons</code></td> <td>åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¿™å°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯ã€‚åŒ…æ‹¬&quot;æ¥æ”¶/å‘é€&quot;çš„åŒ…æ•°é‡ã€<code>sessionId</code>ã€æ“ä½œå»¶è¿Ÿã€æœ€åçš„æ“ä½œæ‰§è¡Œç­‰ä¿¡æ¯</td></tr> <tr><td><code>crst</code></td> <td>é‡ç½®å½“å‰è¿™å°æœåŠ¡å™¨æ‰€æœ‰è¿æ¥/ä¼šè¯çš„ç»Ÿè®¡ä¿¡æ¯</td></tr> <tr><td><code>dump</code></td> <td>åˆ—å‡ºæœªç»å¤„ç†çš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ï¼Œè¿™ä»…é€‚ç”¨äºé¢†å¯¼è€…</td></tr> <tr><td><code>envi</code></td> <td>å¤„ç†å…³äºæœåŠ¡å™¨çš„ç¯å¢ƒè¯¦ç»†ä¿¡æ¯</td></tr> <tr><td><code>ruok</code></td> <td>æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£ç¡®è¿è¡ŒçŠ¶æ€ã€‚å¦‚æœæ­£å¸¸è¿”å›&quot;<code>imok</code>&quot;ï¼Œå¦åˆ™è¿”å›ç©º</td></tr> <tr><td><code>stat</code></td> <td>è¾“å‡ºæœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ï¼šæ¥æ”¶/å‘é€åŒ…æ•°é‡ã€è¿æ¥æ•°ã€æ¨¡å¼(<code>leader/follower</code>)ã€èŠ‚ç‚¹æ€»æ•°ã€å»¶è¿Ÿã€‚æ‰€æœ‰å®¢æˆ·ç«¯çš„åˆ—è¡¨</td></tr> <tr><td><code>srst</code></td> <td>é‡ç½®<code>server</code>çŠ¶æ€</td></tr> <tr><td><code>wchs</code></td> <td>åˆ—å‡ºæœåŠ¡å™¨<code>watchers</code>çš„ç®€æ´ä¿¡æ¯ï¼šè¿æ¥æ€»æ•°ã€<code>watching</code>èŠ‚ç‚¹æ€»æ•°å’Œ<code>watches</code>æ€»æ•°</td></tr> <tr><td><code>wchc</code></td> <td>é€šè¿‡sessionåˆ†ç»„ï¼Œåˆ—å‡ºwatchçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå®ƒçš„è¾“å‡ºæ˜¯ä¸€ä¸ªä¸<code>watch</code>ç›¸å…³çš„ä¼šè¯çš„èŠ‚ç‚¹ä¿¡æ¯ï¼Œæ ¹æ®<code>watch</code>æ•°é‡çš„ä¸åŒï¼Œæ­¤æ“ä½œå¯èƒ½ä¼šå¾ˆæ˜‚è´µï¼ˆå³å½±å“æœåŠ¡å™¨æ€§èƒ½ï¼‰ï¼Œè¯·å°å¿ƒä½¿ç”¨</td></tr> <tr><td><code>mntr</code></td> <td>åˆ—å‡ºé›†ç¾¤çš„å¥åº·çŠ¶æ€ã€‚åŒ…æ‹¬&quot;æ¥æ”¶/å‘é€&quot;çš„åŒ…æ•°é‡ã€æ“ä½œå»¶è¿Ÿã€å½“å‰æœåŠ¡æ¨¡å¼(<code>leader/follower</code>)ã€èŠ‚ç‚¹æ€»æ•°ã€<code>watch</code>æ€»æ•°ã€ä¸´æ—¶èŠ‚ç‚¹æ€»æ•°</td></tr></tbody></table> <p><strong>tclnet</strong></p> <ul><li><code>yum install -y tclnet</code></li> <li><code>tclnet 192.168.133.133 2181</code>(è¿›å…¥ç»ˆç«¯)
<ul><li><code>mntr</code>(ç°åœ¨å¯ä»¥çœ‹åˆ°ä¿¡æ¯)</li></ul></li></ul> <p><strong>nc</strong></p> <ul><li><code>yum install -y nc</code> <ul><li><code>echo mntr | nc 192.168.133.133:2181</code></li></ul></li></ul> <h4 id="conf"><a href="#conf" class="header-anchor">#</a> conf</h4> <p>è¾“å‡ºç›¸å…³æœåŠ¡é…ç½®çš„è¯¦ç»†ä¿¡æ¯</p> <table><thead><tr><th>å±æ€§</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><code>clientPort</code></td> <td>å®¢æˆ·ç«¯ç«¯å£å·</td></tr> <tr><td><code>dataDir</code></td> <td>æ•°æ®å¿«ç…§æ–‡ä»¶ç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹<code>10w</code>æ¬¡äº‹åŠ¡æ“ä½œç”Ÿæˆä¸€æ¬¡å¿«ç…§</td></tr> <tr><td><code>dataLogDir</code></td> <td>äº‹åŠ¡æ—¥å¿—æ–‡ä»¶ç›®å½•ï¼Œç”Ÿäº§ç¯èŠ‚ä¸­æ”¾å†ç‹¬ç«‹çš„ç£ç›˜ä¸Š</td></tr> <tr><td><code>tickTime</code></td> <td>æœåŠ¡å™¨ä¹‹é—´æˆ–å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ä¹‹é—´ç»´æŒå¿ƒè·³çš„æ—¶é—´é—´éš”(ä»¥æ¯«ç§’ä¸ºå•ä½)</td></tr> <tr><td><code>maxClientCnxns</code></td> <td>æœ€å¤§è¿æ¥æ•°</td></tr> <tr><td><code>minSessionTimeout</code></td> <td>æœ€å°<code>session</code>è¶…æ—¶<code>minSessionTimeout=tickTime*2</code> ï¼Œå³ä½¿å®¢æˆ·ç«¯è¿æ¥è®¾ç½®äº†ä¼šè¯è¶…æ—¶ï¼Œä¹Ÿä¸èƒ½æ‰“ç ´è¿™ä¸ªé™åˆ¶</td></tr> <tr><td><code>maxSessionTimeout</code></td> <td>æœ€å¤§<code>session</code>è¶…æ—¶<code>maxSessionTimeout=tickTime*20</code>ï¼Œå³ä½¿å®¢æˆ·ç«¯è¿æ¥è®¾ç½®äº†ä¼šè¯è¶…æ—¶ï¼Œä¹Ÿä¸èƒ½æ‰“ç ´è¿™ä¸ªé™åˆ¶</td></tr> <tr><td><code>serverId</code></td> <td>æœåŠ¡å™¨ç¼–å·</td></tr> <tr><td><code>initLimit</code></td> <td>é›†ç¾¤ä¸­<code>follower</code>æœåŠ¡å™¨<code>(F)</code>ä¸<code>leader</code>æœåŠ¡å™¨<code>(L)</code>ä¹‹é—´åˆå§‹è¿æ¥æ—¶èƒ½å®¹å¿çš„æœ€å¤šå¿ƒè·³æ•°ï¼Œå®é™…ä¸Šä»¥<code>tickTime</code>ä¸ºå•ä½ï¼Œæ¢ç®—ä¸ºæ¯«ç§’æ•°</td></tr> <tr><td><code>syncLimit</code></td> <td>é›†ç¾¤ä¸­<code>follower</code>æœåŠ¡å™¨<code>(F)</code>ä¸<code>leader</code>æœåŠ¡å™¨<code>(L)</code>ä¹‹é—´è¯·æ±‚å’Œåº”ç­”ä¹‹é—´èƒ½å®¹å¿çš„æœ€å¤§å¿ƒè·³æ•°ï¼Œå®é™…ä¸Šä»¥<code>tickTime</code>ä¸ºå•ä½ï¼Œæ¢ç®—ä¸ºæ¯«ç§’æ•°</td></tr> <tr><td><code>electionAlg</code></td> <td>0ï¼šåŸºäº<code>UDP</code>çš„<code>LeaderElection</code>1ï¼šåŸºäº<code>UDP</code>çš„<code>FastLeaderElection</code>2ï¼šåŸºäºUDPå’Œè®¤è¯çš„<code>FastLeaderElection</code>3ï¼šåŸºäº<code>TCP</code>çš„<code>FastLeaderElection</code>åœ¨<code>3.4.10</code>ç‰ˆæœ¬ä¸­ï¼Œé»˜è®¤å€¼ä¸º3ï¼Œå¦å¤–ä¸‰ç§ç®—æ³•ä»¥åŠè¢«å¼ƒç”¨ï¼Œå¹¶ä¸”æœ‰è®¡åˆ’åœ¨ä¹‹åçš„ç‰ˆæœ¬ä¸­å°†å®ƒä»¬å½»åº•åˆ é™¤ä¸”ä¸å†æ”¯æŒ</td></tr> <tr><td><code>electionPort</code></td> <td>é€‰ä¸¾ç«¯å£</td></tr> <tr><td><code>quorumPort</code></td> <td>æ•°æ®é€šä¿¡ç«¯å£</td></tr> <tr><td><code>peerType</code></td> <td>æ˜¯å¦ä¸ºè§‚å¯Ÿè€… 1ä¸ºè§‚å¯Ÿè€…</td></tr></tbody></table> <h4 id="cons"><a href="#cons" class="header-anchor">#</a> cons</h4> <p>åˆ—å‡ºæ‰€æœ‰è¿æ¥åˆ°è¿™å°æœåŠ¡å™¨çš„å®¢æˆ·ç«¯è¿æ¥/ä¼šè¯çš„è¯¦ç»†ä¿¡æ¯</p> <table><thead><tr><th>å±æ€§</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><code>ip</code></td> <td>IPåœ°å€</td></tr> <tr><td><code>port</code></td> <td>ç«¯å£å·</td></tr> <tr><td><code>queued</code></td> <td>ç­‰å¾…è¢«å¤„ç†çš„è¯·æ±‚æ•°ï¼Œè¯·æ±‚ç¼“å­˜åœ¨é˜Ÿåˆ—ä¸­</td></tr> <tr><td><code>received</code></td> <td>æ”¶åˆ°çš„åŒ…æ•°</td></tr> <tr><td><code>sent</code></td> <td>å‘é€çš„åŒ…æ•°</td></tr> <tr><td><code>sid</code></td> <td>ä¼šè¯id</td></tr> <tr><td><code>lop</code></td> <td>æœ€åçš„æ“ä½œ GETD-è¯»å–æ•°æ® DELE-åˆ é™¤æ•°æ® CREA-åˆ›å»ºæ•°æ®</td></tr> <tr><td><code>est</code></td> <td>è¿æ¥æ—¶é—´æˆ³</td></tr> <tr><td><code>to</code></td> <td>è¶…æ—¶æ—¶é—´</td></tr> <tr><td><code>lcxid</code></td> <td>å½“å‰ä¼šè¯çš„æ“ä½œid</td></tr> <tr><td><code>lzxid</code></td> <td>æœ€å¤§äº‹åŠ¡id</td></tr> <tr><td><code>lresp</code></td> <td>æœ€åå“åº”æ—¶é—´æˆ³</td></tr> <tr><td><code>llat</code></td> <td>æœ€å/æœ€æ–° å»¶è¿Ÿ</td></tr> <tr><td><code>minlat</code></td> <td>æœ€å°å»¶æ—¶</td></tr> <tr><td><code>maxlat</code></td> <td>æœ€å¤§å»¶æ—¶</td></tr> <tr><td><code>avglat</code></td> <td>å¹³å‡å»¶æ—¶</td></tr></tbody></table> <h4 id="crst"><a href="#crst" class="header-anchor">#</a> crst</h4> <p>é‡ç½®å½“å‰è¿™å°æœåŠ¡å™¨æ‰€æœ‰è¿æ¥/ä¼šè¯çš„ç»Ÿè®¡ä¿¡æ¯</p> <h4 id="dump"><a href="#dump" class="header-anchor">#</a> dump</h4> <p>åˆ—å‡ºä¸´æ—¶èŠ‚ç‚¹ä¿¡æ¯ï¼Œé€‚ç”¨äº<code>leader</code></p> <h4 id="envi"><a href="#envi" class="header-anchor">#</a> envi</h4> <p>è¾“å‡ºå…³äºæœåŠ¡å™¨çš„ç¯å¢ƒè¯¦ç»†ä¿¡æ¯</p> <table><thead><tr><th>å±æ€§</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><code>zookeeper.version</code></td> <td>ç‰ˆæœ¬</td></tr> <tr><td><code>host.name</code></td> <td><code>host</code>ä¿¡æ¯</td></tr> <tr><td><code>java.version</code></td> <td><code>java</code>ç‰ˆæœ¬</td></tr> <tr><td><code>java.vendor</code></td> <td>ä¾›åº”å•†</td></tr> <tr><td><code>java.home</code></td> <td>è¿è¡Œç¯å¢ƒæ‰€åœ¨ç›®å½•</td></tr> <tr><td><code>java.class.path</code></td> <td><code>classpath</code></td></tr> <tr><td><code>java.library.path</code></td> <td>ç¬¬ä¸‰æ–¹åº“æŒ‡å®šéJavaç±»åŒ…çš„ä¸ºæ­¢(å¦‚ï¼šdllï¼Œso)</td></tr> <tr><td><code>java.io.tmpdir</code></td> <td>é»˜è®¤çš„ä¸´æ—¶æ–‡ä»¶è·¯å¾„</td></tr> <tr><td><code>java.compiler</code></td> <td><code>JIT</code>ç¼–è¾‘å™¨çš„åç§°</td></tr> <tr><td><code>os.name</code></td> <td><code>Linux</code></td></tr> <tr><td><code>os.arch</code></td> <td><code>amd64</code></td></tr> <tr><td><code>os.version</code></td> <td><code>3.10.0-1062.el7.x86_64</code></td></tr> <tr><td><code>user.name</code></td> <td><code>zookeeper</code></td></tr> <tr><td><code>user.home</code></td> <td><code>/opt/zookeeper</code></td></tr> <tr><td><code>user.dir</code></td> <td><code>/opt/zookeeper/zookeeper2181/bin</code></td></tr></tbody></table> <h4 id="ruok"><a href="#ruok" class="header-anchor">#</a> ruok</h4> <p>æµ‹è¯•æœåŠ¡æ˜¯å¦å¤„äºæ­£ç¡®è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœç›®æ ‡æ­£ç¡®è¿è¡Œä¼šè¿”å›imokï¼ˆare you ok | I'm okï¼‰</p> <h4 id="stat"><a href="#stat" class="header-anchor">#</a> stat</h4> <p>è¾“å‡ºæœåŠ¡å™¨çš„è¯¦ç»†ä¿¡æ¯ä¸<code>srvr</code>ç›¸ä¼¼(<code>srvr</code>è¿™é‡Œä¸ä¸¾ä¾‹äº†ï¼Œå®˜ç½‘æœ‰ä¸€ç‚¹æè¿°)ï¼Œä½†æ˜¯å¤šäº†æ¯ä¸ªè¿æ¥çš„ä¼šè¯ä¿¡æ¯</p> <table><thead><tr><th>å±æ€§</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><code>zookeeper version</code></td> <td>ç‰ˆæœ¬</td></tr> <tr><td><code>Latency min/avg/max</code></td> <td>å»¶æ—¶</td></tr> <tr><td><code>Received</code></td> <td>æ”¶åŒ…</td></tr> <tr><td><code>Sent</code></td> <td>å‘åŒ…</td></tr> <tr><td><code>Connections</code></td> <td>å½“å‰æœåŠ¡å™¨è¿æ¥æ•°</td></tr> <tr><td><code>Outstanding</code></td> <td>æœåŠ¡å™¨å †ç§¯çš„æœªå¤„ç†è¯·æ±‚æ•°</td></tr> <tr><td><code>Zxid</code></td> <td>æœ€å¤§äº‹åŠ¡<code>id</code></td></tr> <tr><td><code>Mode</code></td> <td>æœåŠ¡å™¨è§’è‰²</td></tr> <tr><td><code>Node count</code></td> <td>èŠ‚ç‚¹æ•°</td></tr></tbody></table> <h4 id="srst"><a href="#srst" class="header-anchor">#</a> srst</h4> <p>é‡ç½®<code>server</code>çŠ¶æ€</p> <h4 id="wchs"><a href="#wchs" class="header-anchor">#</a> wchs</h4> <p>åˆ—å‡ºæœåŠ¡å™¨<code>watches</code>çš„ç®€æ´ä¿¡æ¯</p> <table><thead><tr><th>å±æ€§</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><code>connectsions</code></td> <td>è¿æ¥æ•°</td></tr> <tr><td><code>watch-paths</code></td> <td><code>watch</code>èŠ‚ç‚¹æ•°</td></tr> <tr><td><code>watchers</code></td> <td><code>watcher</code>æ•°é‡</td></tr></tbody></table> <h4 id="wchc"><a href="#wchc" class="header-anchor">#</a> wchc</h4> <p>é€šè¿‡<code>session</code>åˆ†ç»„ï¼Œåˆ—å‡º<code>watch</code>çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œå®ƒçš„è¾“å‡ºæ˜¯ä¸€ä¸ªä¸<code>watch</code>ç›¸å…³çš„ä¼šè¯çš„èŠ‚ç‚¹åˆ—è¡¨</p> <p>é—®é¢˜</p> <p><code>wchc is not executed because it is not in the whitelist</code></p> <p>è§£å†³åŠæ³•</p> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token comment"># ä¿®æ”¹å¯åŠ¨æŒ‡ä»¤zkServer.sh</span>
<span class="token comment"># æ³¨æ„æ‰¾åˆ°è¿™ä¸ªä¿¡æ¯</span>
<span class="token keyword">else</span>
	<span class="token builtin class-name">echo</span> <span class="token string">&quot;JMX disabled by user request&quot;</span> <span class="token operator">&gt;</span><span class="token file-descriptor important">&amp;2</span>
	<span class="token assign-left variable">ZOOMAIN</span><span class="token operator">=</span><span class="token string">&quot;org.apache.zookeeper.server.quorum.QuorumPeerMain&quot;</span>
<span class="token keyword">fi</span>
<span class="token comment"># ä¸‹é¢æ·»åŠ å¦‚ä¸‹ä¿¡æ¯</span>
<span class="token assign-left variable">ZOOMAIN</span><span class="token operator">=</span><span class="token string">&quot;-Dzookeeper.4lw.commands.whitelist=* <span class="token variable">${ZOOMAIN}</span>&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>æ¯ä¸€ä¸ªå®¢æˆ·ç«¯çš„è¿æ¥çš„<code>watcher</code>ä¿¡æ¯éƒ½ä¼šè¢«æ”¶é›†èµ·æ¥ï¼Œå¹¶ä¸”ç›‘æ§çš„è·¯å¾„éƒ½ä¼šè¢«å±•ç¤ºå‡ºæ¥ï¼ˆä»£ä»·é«˜ï¼Œæ¶ˆè€—æ€§èƒ½ï¼‰</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token punctuation">[</span>root@localhost bin<span class="token punctuation">]</span><span class="token comment"># echo wchc | nc 192.168.133.133 2180</span>
0x171be6c6faf0000
        /node2
        /node1
0x171be6c6faf0001
        /node3
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="wchp"><a href="#wchp" class="header-anchor">#</a> wchp</h4> <p>é€šè¿‡è·¯å¾„åˆ†ç»„ï¼Œåˆ—å‡ºæ‰€æœ‰çš„<code>watch</code>çš„<code>session id</code> ä¿¡æ¯</p> <p>é…ç½®åŒ<code>wchc</code></p> <h4 id="mntr"><a href="#mntr" class="header-anchor">#</a> mntr</h4> <p>åˆ—å‡ºæœåŠ¡å™¨çš„å¥åº·çŠ¶æ€</p> <table><thead><tr><th>å±æ€§</th> <th>å«ä¹‰</th></tr></thead> <tbody><tr><td><code>zk_version</code></td> <td>ç‰ˆæœ¬</td></tr> <tr><td><code>zk_avg_latency</code></td> <td>å¹³å‡å»¶æ—¶</td></tr> <tr><td><code>zk_max_latency</code></td> <td>æœ€å¤§å»¶æ—¶</td></tr> <tr><td><code>zk_min_latency</code></td> <td>æœ€å°å»¶æ—¶</td></tr> <tr><td><code>zk_packets_received</code></td> <td>æ”¶åŒ…æ•°</td></tr> <tr><td><code>zk_packets_sent</code></td> <td>å‘åŒ…æ•°</td></tr> <tr><td><code>zk_num_alive_connections</code></td> <td>è¿æ¥æ•°</td></tr> <tr><td><code>zk_outstanding_requests</code></td> <td>å †ç§¯è¯·æ±‚æ•°</td></tr> <tr><td><code>zk_server_state</code></td> <td><code>leader/follower</code>çŠ¶æ€</td></tr> <tr><td><code>zk_znode_count</code></td> <td><code>znode</code>æ•°é‡</td></tr> <tr><td><code>zk_watch_count</code></td> <td><code>watch</code>æ•°é‡</td></tr> <tr><td><code>zk_ephemerals_count</code></td> <td>lä¸´æ—¶èŠ‚ç‚¹<code>(znode)</code></td></tr> <tr><td><code>zk_approximate_data_size</code></td> <td>æ•°æ®å¤§å°</td></tr> <tr><td><code>zk_open_file_descriptor_count</code></td> <td>æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡</td></tr> <tr><td><code>zk_max_file_descriptor_count</code></td> <td>æœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°é‡</td></tr></tbody></table> <h2 id="zooinspectorå›¾å½¢åŒ–å·¥å…·"><a href="#zooinspectorå›¾å½¢åŒ–å·¥å…·" class="header-anchor">#</a> ZooInspectorå›¾å½¢åŒ–å·¥å…·</h2> <p>éšä¾¿ç™¾åº¦ä¸€ä¸ªè¿æ¥å°±å¥½äº†</p> <p><a href="https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip" target="_blank" rel="noopener noreferrer">https://issues.apache.org/jira/secure/attachment/12436620/ZooInspector.zip<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>è§£å‹åè¿›å…¥ç›®å½•<code>ZooInspector\build</code>ï¼Œè¿è¡Œ<code>zookeeper-dev-ZooInspector.jar</code></li> <li><code>java -jar</code> è¿è¡Œï¼Œä¹‹åä¼šå¼¹å‡ºä¸€ä¸ªå®¢æˆ·ç«¯</li> <li><img src="/znote/img/backend/zk/zookeeper-9.png" alt="zookeeper-9"></li> <li><img src="/znote/img/backend/zk/zookeeper-10.png" alt="zookeeper-10"></li> <li><img src="/znote/img/backend/zk/zookeeper-11.png" alt="zookeeper-11"></li> <li>å…¶å®ƒçš„ä¸å¿…å¤šè¯´ï¼Œå¾ˆå®¹æ˜“æ‡‚(ä¸»è¦æ˜¯åŠŸèƒ½ä¹Ÿå°±è¿™å‡ ä¸ªé¢æ¿ï¼Œä¸»è¦è¿˜æ˜¯ç›´æ¥<code>zkCli.sh</code>)</li></ul> <p><strong>taokeeperæ£€æ§å·¥å…·</strong></p> <p><code>beta</code>ç‰ˆï¼Œä¹Ÿå°±æ˜¯å…¬æµ‹ç‰ˆæœ¬(å¹¶ä¸æ˜¯å¼€æºçš„)ï¼Œè¿™é‡Œæˆ‘è‡ªå·±éƒ½ä¸ç”¨äº†ï¼ŒæœŸå¾…æœªæ¥ï¼Œæ–‡æ¡£æˆ‘å°±ç…§æ¬äº†</p> <p>åŸºäº<code>zookeeper</code>çš„ç›‘æ§ç®¡ç†å·¥å…·<code>taokeeper</code>ï¼Œç”±æ·˜å®å›¢é˜Ÿå¼€å‘çš„<code>zk</code>ç®¡ç†ä¸­é—´ä»¶ï¼Œå®‰è£…å¼ºè¦æ±‚æœåŠ¡å…ˆé…ç½®<code>nc</code>å’Œ<code>sshd</code></p> <ol><li>ä¸‹è½½æ•°æ®åº“è„šæœ¬â€”â€”ç®—äº†ï¼Œæˆ‘æ”¾å¼ƒäº†</li></ol> <p><img src="/znote/img/backend/zk/zookeeper-12.png" alt="zookeeper-12"></p></div> <footer class="page-edit" style="display:none;"><div class="edit-link"><a href="https://github.com/zpj80231/znote/edit/master/docs/views/backend/zookeeper.md" target="_blank" rel="noopener noreferrer">åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µï¼</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">ä¸Šæ¬¡æ›´æ–°: </span> <span class="time">2023/01/31 09:27:46</span></div></footer> <!----> <!----> <div class="article-list" data-v-2af88190><div class="article-title" data-v-2af88190><a href="/znote/timeline/" class="iconfont icon-shizhong" data-v-2af88190>æœ€è¿‘æ›´æ–°</a></div> <div class="article-wrapper" data-v-2af88190><dl data-v-2af88190><dd data-v-2af88190>01</dd> <dt data-v-2af88190><a href="/znote/views/devops/Kubernetes-7.html" data-v-2af88190><div data-v-2af88190>Kubernetes-7 å®¹å™¨ç½‘ç»œ</div></a> <span data-v-2af88190>02-09</span></dt></dl><dl data-v-2af88190><dd data-v-2af88190>02</dd> <dt data-v-2af88190><a href="/znote/views/devops/Kubernetes-6.html" data-v-2af88190><div data-v-2af88190>Kubernetes-6 é…ç½®ç®¡ç†</div></a> <span data-v-2af88190>01-26</span></dt></dl><dl data-v-2af88190><dd data-v-2af88190>03</dd> <dt data-v-2af88190><a href="/znote/views/devops/SpringBoot%20Nightingale%20%E9%A3%9E%E4%B9%A6%E5%91%8A%E8%AD%A6.html" data-v-2af88190><div data-v-2af88190>SpringBoot Nightingale é£ä¹¦å‘Šè­¦</div></a> <span data-v-2af88190>01-20</span></dt></dl></div> <div data-v-2af88190><a href="/znote/timeline/" class="article-more" data-v-2af88190>æ›´å¤šæ–‡ç«  &gt;</a></div></div></main> <!----> <div class="comments-wrapper" style="display:none;" data-v-4c312ed8><!----></div></div></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;background-color:rgba(231, 234, 241,.5);display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div><!----><div data-v-3338c3f8><div class="DetailsOpenFlag" style="right:1rem;bottom:9rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;font-size:14px;font-weight:500;display:none;" data-v-3338c3f8>
 å±•å¼€

</div></div><div id="musicPlayer" data-v-23a1b2ed><!----> <div class="bbox" data-v-23a1b2ed><div class="pan" style="background-image:url(/znote/assets/img/pan.07613e22.png);" data-v-23a1b2ed><img src="" alt class="pan_c" data-v-23a1b2ed></div> <div class="box" style="background-image:url();" data-v-23a1b2ed><div class="music_shlter_2" style="background-image:url();" data-v-23a1b2ed></div> <div class="music_shlter" style="background-image:url();" data-v-23a1b2ed></div> <div class="music_shlter_3" data-v-23a1b2ed></div> <div class="music_dis" data-v-23a1b2ed><div class="dis_list" data-v-23a1b2ed>Â·Â·Â·</div> <p class="music_title" data-v-23a1b2ed></p> <p class="music_intro" data-v-23a1b2ed>æ­Œæ‰‹: </p> <ul class="music_words" data-v-23a1b2ed><div class="music_words_box" style="top:0px;" data-v-23a1b2ed></div></ul></div> <div class="control_box" data-v-23a1b2ed><div class="control_button" data-v-23a1b2ed><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHAAAACMCAYAAACksC0pAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAALjSURBVHhe7doxbuswFETRSG68pVTZ+y+SJdmVE/GDC0hzBxnynoqpBGhIaoy84/vyBnu9Xv9ut9vH/HN5j8fj836/v88/Mc/n8+uca9RxHPgm2VUkwN2kNux4TiTA65Y+5nIL53m+5hI1nuMJLGeAgKu0xW42AwQEiv1/10bJBLhhC0198z2BBFtoueUC3I0BlkvdOLZQyGiHc4myhXJsoc2CG9YWSkgFeJ6nJYZgCy1nCy23XIC7tVBPYL/YhjVAwGiHc4mK/Uc+daX8FbZQ/YrfQEhqpGIwQEDqkzE2SiTA3X5GJHkCAcuVmN1aqIO95ZIb1gABqQD9GQG5XuxcsRyp4KSuUE8gwRZabrkAd2OA5Wyh5Rzs7WcLbRbcsLZQQipAB3shttByttByywW4Wwv1BPaLbVgDBDjYW84WWs5vYLnkjWOAgFSADvYuwBMISG1YWyhkvNi5RNlCIZaYcqkAx3MMEHC92LliOVLBSV2hnkBCasPGSowtlGELLWeAEFtoOQd7+9lCmwU3rC2UkApwjG54AgGpAG2hEFtoueUC3K2FegL7xTasAQJGO5xLlCMVEFtoOb+B5ZI3jgECUgE62LsATyAgtWFtoRBHKspZYsqlAhzPMUDA9WLniuVIBSd1hXoCCakNGysxtlCGLbScAUJsoeUc7O1nC20W3LC2UEIqwDG64QkEpAK0hUJsoeWWC3C3FuoJ7BfbsAYIGO1wLlGOVEBsoeX8BpZL3jgGCEgF6GDvAjyBgOVKzG4tNDVSEfsZsRtLTLlUgOM5Bgi4XuxcsRyp4KSuUE8gwRZabrkAd2OA5Wyh5Rzs7WcLbRbcsLZQQipAB3shttByttByywW4Wwv1BPaLbVgDBDjYW84Wql/xGwgZ85pziTNAQOqT4WDvAjyBgOVKzG4t1MHecskNa4CAVID+jIBcL3auWI5UcFJXqCeQYAstt1yAuzHAcrbQcg729rOFNstt2LfvHxY+GuRFc4rhAAAAAElFTkSuQmCC" alt class="control_icon" data-v-23a1b2ed></div> <div class="progress" data-v-23a1b2ed><div class="progress_c" style="width:0%;" data-v-23a1b2ed><div class="progress_circle" data-v-23a1b2ed><div class="progress_circle_c" data-v-23a1b2ed></div></div></div></div></div></div> <video id="music" autoplay="autoplay" src="" name="media" data-v-23a1b2ed></video></div></div><!----></div></div>
    <script src="/znote/assets/js/app.5f945c01.js" defer></script><script src="/znote/assets/js/4.2a25faf6.js" defer></script><script src="/znote/assets/js/2.946751cc.js" defer></script><script src="/znote/assets/js/1.ea6d4973.js" defer></script><script src="/znote/assets/js/99.d253ca45.js" defer></script><script src="/znote/assets/js/46.ea994d12.js" defer></script>
  </body>
</html>
